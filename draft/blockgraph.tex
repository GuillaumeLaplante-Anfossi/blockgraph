\documentclass{amsart}

\usepackage[T1]{fontenc}
\usepackage{amsmath, amsfonts, amssymb, amsthm, mathrsfs, wasysym, graphics, graphicx, xcolor, url, hyperref, hypcap, xargs, multicol, pdflscape, multirow, hvfloat, array, ae, aecompl, pifont, mathtools, a4wide, float, blkarray, overpic, nicefrac}
\usepackage[shortlabels, inline]{enumitem}%shortlabels to have same syntax as enumerate package, inline gives inline option with *
\usepackage{bbm}%allows for \mathbbm{1}
\usepackage[noabbrev,capitalise]{cleveref}
\usepackage[normalem]{ulem}
\usepackage{marginnote}
\hypersetup{colorlinks=true, citecolor=darkblue, linkcolor=darkblue}
\usepackage[all]{xy}
\usepackage{tikz}
\usepackage{tikz-cd}
%\usepackage{tkz-graph}
\usetikzlibrary{trees, decorations, decorations.pathmorphing, decorations.markings, decorations.shapes, shapes, arrows, matrix, calc, fit, intersections, patterns, angles}
\graphicspath{{figures/}{figures/diagonals/}{figures/walks/}{figures/tubes/}{figures/blocks/}}
\makeatletter\def\input@path{{figures/}}\makeatother
\usepackage{caption}
\captionsetup{width=\textwidth}
\usepackage[export]{adjustbox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% STANDARD

% theorems
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem*{theorem*}{Theorem}%[section]

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{question}[theorem]{Question}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{convention}[theorem]{Convention}

\crefname{equation}{Equation}{Equations}

% math special letters
\newcommand{\R}{\mathbb{R}} % reals
\newcommand{\Q}{\mathbb{Q}} % rationals
\newcommand{\N}{\mathbb{N}} % naturals
\newcommand{\Z}{\mathbb{Z}} % integers
\newcommand{\C}{\mathbb{C}} % complex
\newcommand{\I}{\mathbb{I}} % set of integers
\newcommand{\K}{k} % field
\newcommand{\bb}[1]{{\mathbb{#1}}} % mathbb letters
\newcommand{\f}[1]{{\mathfrak{#1}}} % mathfrak letters
\renewcommand{\c}[1]{{\mathcal{#1}}} % call letters
\renewcommand{\b}[1]{{\boldsymbol{#1}}} % bold letters
\newcommand{\h}{\widehat} % hat letters

% math commands
\newcommand{\set}[2]{\left\{ #1 \;\middle|\; #2 \right\}} % set notation
\newcommand{\bigset}[2]{\big\{ #1 \;\big|\; #2 \big\}} % big set notation
\newcommand{\Bigset}[2]{\Big\{ #1 \;\Big|\; #2 \Big\}} % Big set notation
\newcommand{\setangle}[2]{\left\langle #1 \;\middle|\; #2 \right\rangle} % set notation
\newcommand{\ssm}{\smallsetminus} % small set minus
\newcommand{\dotprod}[2]{\langle \, #1 \; | \; #2 \, \rangle} % dot product
\newcommand{\bigdotprod}[2]{\big\langle \, #1 \; \big| \; #2 \, \big\rangle} % dot product
\newcommand{\symdif}{\,\triangle\,} % symmetric difference
\newcommand{\one}{\mathbbm{1}} % the all one vector
\newcommandx{\ones}[1][1=n]{\one_{#1}} % the all one vector of length n
\newcommand{\eqdef}{\mbox{\,\raisebox{0.2ex}{\scriptsize\ensuremath{\mathrm:}}\ensuremath{=}\,}} % :=
\newcommand{\defeq}{\mbox{~\ensuremath{=}\raisebox{0.2ex}{\scriptsize\ensuremath{\mathrm:}} }} % =:
\newcommand{\simplex}{\triangle} % simplex
\renewcommand{\implies}{\Rightarrow} % imply sign
\newcommand{\transpose}[1]{{#1}^T} % transpose matrix
\newcommand{\truth}[1]{\left[ #1 \right]} % truth (kronecker delta)

% operators
\DeclareMathOperator{\conv}{conv} % convex hull
\DeclareMathOperator{\vect}{vect} % linear span
\DeclareMathOperator{\cone}{cone} % cone hull
\DeclareMathOperator{\colim}{colim} % colimit

% others
\newcommand{\ie}{\textit{i.e.}~} % id est
\newcommand{\eg}{\textit{e.g.}~} % exempli gratia
\newcommand{\Eg}{\textit{E.g.}~} % exempli gratia
\newcommand{\apriori}{\textit{a priori}} % a priori
\newcommand{\viceversa}{\textit{vice versa}} % vice versa
\newcommand{\versus}{\textit{vs.}~} % versus
\newcommand{\aka}{\textit{a.k.a.}~} % also known as
\newcommand{\perse}{\textit{per se}} % per se
\newcommand{\ordinal}{\textsuperscript{th}} % th for ordinals
\newcommand{\ordinalst}{\textsuperscript{st}} % st for ordinals
\definecolor{darkblue}{rgb}{0,0,0.7} % darkblue color
\definecolor{green}{RGB}{57,181,74} % green color
\definecolor{violet}{RGB}{147,39,143} % violet color
\newcommand{\red}{\color{red}} % red command
\newcommand{\blue}{\color{blue}} % blue command
\newcommand{\orange}{\color{orange}} % orange command
\newcommand{\green}{\color{green}} % green command
\newcommand{\darkblue}{\color{darkblue}} % darkblue command
\newcommand{\defn}[1]{\textsl{\darkblue #1}} % emphasis of a definition
\newcommand{\para}[1]{\medskip\noindent\uline{\textit{#1.}}} % paragraph
\renewcommand{\topfraction}{1} % possibility to have one page of pictures
\renewcommand{\bottomfraction}{1} % possibility to have one page of pictures
\newcommand{\shade}[1]{{\color{cyan} #1}}
\newcommand{\as}{{\scriptstyle \text{\rm !`}}} %Antischrieck
\tikzset{inner sep=0.4mm}

% marginal comments
\usepackage{todonotes}
\newcommand{\guillaume}[1]{\todo[color=orange!30]{#1 --- G.}}
\newcommand{\vincent}[1]{\todo[color=blue!30]{#1 \\ \hfill --- V.}}

% formating the part command
\makeatletter
\def\part{\@startsection{part}{1}%
\z@{.7\linespacing\@plus\linespacing}{.8\linespacing}%
{\LARGE\sffamily\centering}}
%\@addtoreset{section}{part}
\makeatother
\renewcommand{\thepart}{\Roman{part}}
%\renewcommand{\thesection}{\arabic{part}.\arabic{section}}

% formating the table of contents
\setcounter{tocdepth}{4}
\makeatletter
\def\l@section{\@tocline{1}{5pt}{0pc}{}{}}
\makeatother
\let\oldtocpart=\tocpart
\renewcommand{\tocpart}[2]{\sc\large\oldtocpart{#1}{#2}}
\let\oldtocsection=\tocsection
\renewcommand{\tocsection}[2]{\bf\oldtocsection{#1}{#2}}
\let\oldtocsubsubsection=\tocsubsubsection
\renewcommand{\tocsubsubsection}[2]{\quad\oldtocsubsubsection{#1}{#2}}

% drapeau europ√©en
\usepackage{graphicx,calc}
\newlength\myheight
\newlength\mydepth
\settototalheight\myheight{Xygp}
\settodepth\mydepth{Xygp}
\setlength\fboxsep{0pt}
\newcommand*\inlinegraphics[1]{%
  \settototalheight\myheight{Xygp}%
  \settodepth\mydepth{Xygp}%
  \raisebox{-\mydepth}{\includegraphics[height=\myheight]{#1}}%
}

% SPECIFIC BLOCK GRAPH PERMUTREES

% COMBINATORICS

% decorations
\newcommandx{\Maple}[1][1=M]{#1} % maple tree
\newcommandx{\decoratedMaple}[1][1=\Maple]{\b{#1}} % maple tree
\newcommandx{\Graph}[1][1=G]{#1} % graph
\newcommandx{\decoratedGraph}[1][1=\Graph]{\b{#1}} % decorated graph
\newcommandx{\vertexSet}[1][1=V]{#1} %vertex set
\newcommandx{\cliqueSet}[1][1=W]{#1} %clique set
\newcommandx{\edgeSet}[1][1=E]{#1} %edge set
\newcommand{\decoration}{\delta}
\newcommandx{\Up}[2][1=v, 2=\decoration]{\smash{\overline #2}(#1)} 
\newcommandx{\Down}[2][1=v, 2=\decoration]{\smash{\underline #2}(#1)} 
\newcommandx{\up}[1][1=v]{\overline{#1}} 
\newcommandx{\down}[1][1=v]{\underline{#1}} 
\newcommandx{\updown}[1][1=v]{\overline{\underline{#1}}} 
% source and target
\newcommandx{\so}[1][1=i]{\textsc{s}_{#1}} % source set
\newcommandx{\ta}[1][1=o]{\textsc{t}_{#1}} % target set
% spines
\newcommandx{\spine}[1][1=S]{#1} % spine
\newcommandx{\almostSpine}[1][1=S]{\smash{\widetilde{#1}}} % spine
\newcommandx{\spines}[1][1=\decoratedGraph]{\mathcal{S}(#1)} % set of spines
\newcommandx{\spinePoset}[1][1=\decoratedGraph]{\mathcal{P}_{#1}} % spine poset
\newcommand{\blossom}{\text{\ding{96}}} % blossom
\newcommand{\labeling}{\lambda} % labels in blossoming trees
\newcommandx{\equivalenceSpines}[2][1=\decoratedGraph_\circ, 2=\decoratedGraph_\bullet]{\equiv_{#1 \to #2}} % equivalence relation on spines
% nested complex
\newcommandx{\chunk}[1][1=C]{#1} % chunck
\newcommandx{\nested}[1][1=N]{#1} % nested set
\newcommand{\negNested}{\preceq} % negative nested
\newcommand{\posNested}{\succeq} % positive nested
\newcommand{\negDisjoint}{\perp} % negative disjoint
\newcommand{\posDisjoint}{\;\top\;} % positive disjoint
\newcommandx{\nestedComplex}[1][1=\decoratedGraph]{\mathcal{N}_{#1}} % nested complex
% maps
\newcommand{\spineToNested}{\mathsf{N}} % spine to nested set
\newcommand{\nestedToSpine}{\mathsf{S}} % nested set to spine
\newcommand{\partitionToSpine}{\mathsf{S}} % partition to spine
\newcommandx{\surjectionSpines}[2][1=\decoratedGraph_\circ, 2=\decoratedGraph_\bullet]{\Phi_{#1 \to #2}} % spine to spine
\newcommand{\nodeSurj}[2]{\smash{n_{#1}^{#2}}} % node surjection
\newcommand{\arcSurj}[2]{\smash{\varepsilon_{#1}^{#2}}} % arc surjection
% insertion
\newcommand{\insertion}[2]{#1 \ll #2} % insertion

% GEOMETRY

% fans
\newcommand{\primalCone}{\mathsf{C}^\star} % primal cone
\newcommand{\normalCone}{\mathsf{C}} % normal cone
\newcommandx{\braidFan}[1][1=\Graph]{\mathcal{F}_{#1}} % braid fan
\newcommandx{\sylvesterFan}[1][1=\Graph]{\mathcal{T}_{#1}} % sylvester fan
\newcommandx{\graphicalFan}[1][1=\Graph]{\mathcal{G}_{#1}} % graphical fan
\newcommandx{\spineFan}[1][1=\decoratedGraph]{\mathcal{S}_{#1}} % spine fan
% polytopes
\newcommand{\polytope}[1]{\mathsf{#1}} % font polytopes
\newcommandx{\Perm}[2][1=\Graph,2=\weight]{\polytope{Perm}^{#2}_{#1}} % permutahedron
\newcommandx{\Asso}[2][1=\Graph,2=\weight]{\polytope{Asso}^{#2}_{#1}} % associahedron
\newcommandx{\Spin}[2][1=\decoratedGraph,2=\weight]{\polytope{Spin}^{#2}_{#1}} % spine polytope
\newcommandx{\Zono}[2][1=\Graph,2=\weight]{\mathsf{Zono}^{#2}_{#1}} % zonotope
\newcommandx{\point}[2][1=\spine,2=\weight]{\b{a}^{#2}_{#1}} % point
\newcommand{\weight}{\omega} % weight
\newcommandx{\boundary}[1][1=\pi]{\partial#1} % endpoints of a path
\newcommandx{\peaks}[1][1=\pi]{\wedge#1} % top of a path
\newcommandx{\valleys}[1][1=\pi]{\vee#1} % bottom of a path
\newcommandx{\Hyp}[1][1=\weight]{\mathbf{H}^{= #1}} % hyperplane
\newcommandx{\HS}[1][1=\weight]{\mathbf{H}^{\ge #1}} % halfspace
\newcommand{\monombinom}[1]{\big\{\!\begin{smallmatrix} #1 \\ 2 \end{smallmatrix}\!\big\}}

% ALGEBRA

\newcommand{\dioperad}{\mathcal{D}} % dioperad

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Spine polytopes}

\author{Guillaume Laplante-Anfossi}
\address[Guillaume Laplante-Anfossi]{Universit\'e Sorbonne Paris Nord, Laboratoire Analyse, G\'eom\'etrie et Applications, CNRS, UMR 7539, F-93430 Villetaneuse, France}
\email{laplante-anfossi@math.univ-paris13.fr}
\urladdr{\url{https://www.math.univ-paris13.fr/~laplante-anfossi/}}

\author{Vincent Pilaud}
\address[Vincent Pilaud]{CNRS \& LIX, \'Ecole Polytechnique, Palaiseau}
\email{vincent.pilaud@lix.polytechnique.fr}
\urladdr{\url{http://www.lix.polytechnique.fr/~pilaud/}}

%\date{\today}

\subjclass[2010]{Primary 52B11; Secondary 18M70} 

%\keywords{Polytopes...}

\thanks{The first author was supported by the European Union's Horizon 2020 research and innovation program under the Marie Sklodowska-Curie grant agreement No 754362 \inlinegraphics{EU.png}, by the Natural Sciences and Engineering Research Council of Canada (NSERC) and by the ANR-20-CE40-0016 Higher Algebra, Geometry and Topology. The second author is supported by the French ANR grants CAPPS~17\,CE40\,0018, and CHARMS~19\,CE40\,0017 and by the French\,--\,Austrian project PAGCAP (ANR~21\,CE48\,0020 \& FWF I 5788).}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\begin{abstract}
TBC
\end{abstract}

\maketitle

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section*{Introduction}

Common generalization of \cite{Pilaud-signedTreeAssociahedra, LangePilaud, PilaudPons-permutrees, Laplante-diagonalOperahedra}.
It is the maximal generalization, according to \cite{Pilaud-removahedra}.

\guillaume{dioperads and string topology}
\guillaume{our dioperad might be initial in some operadic / Feynman / moment category}
\vincent{Block graphs already appear in our context: exactly the graphs whose graphical zonotope is simple, and exactly the graphs whose graph associahedra are removahedra. Btw, this is already a reason for the construction not working beyond block graphs.}
\vincent{Line graphs of trees are exactly claw-free block graphs.}

\begin{remark}
  All the results in this section hold if and only if $\Graph$ is a block graph. 
  \vincent{Not the right place...}
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{Combinatorics: spine poset and chunk nested complex}
\label{sec:combinatorics}

This section is dedicated to the combinatorics of spines on decorated block graphs.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Maple trees and block graphs}
\label{subsec:MapleTreesBlockGraphs}

We start by defining the ground sets of our constructions.
We will use both maple trees and block graphs, which essentially encode the same information.

\begin{definition}
  A \defn{maple tree} is a tree whose vertices are properly colored (\ie no monochromatic edge) in red and blue such that all leaves are red.
  The \defn{tapping} of a maple tree consists in replacing each red vertex by a clique on its blue neighbors.
  A \defn{maple subtree} is an induced subtree which is also a maple tree.
\end{definition}

\begin{definition}
  \label{def:blockgraph}
  A \defn{block graph} is a connected graph~$\Graph$ satisfying the following equivalent conditions:
  \begin{itemize}
    \item every biconnected component of~$\Graph$ is a clique,
    \item any cycle in~$\Graph$ induces a clique,
    \item the intersection of two connected subgraphs of~$\Graph$ is a connected subgraph of~$\Graph$,
    \item the intersection of two paths in~$\Graph$ induces a path in~$\Graph$,
    \item there is a unique induced path connecting every pair of vertices,
    \item the graph~$\Graph$ is obtained by tapping a maple tree.
  \end{itemize}
\end{definition}

Note that a block graph is obtained by tapping different maple trees. For instance, one can arbitrarily add red leaves to the blue vertices.
In this paper, we start from a maple tree~$\Maple$ and consider the block graph~$\Graph$ obtained by tapping~$\Maple$.
We denote by~$\vertexSet$ the vertex set of~$\Graph$ (equivalently the set of blue vertices of~$\Maple$).
We use the block graph~$\Graph$ when we only need to manipulate its vertices, and the maple tree~$\Maple$ when we really need to manipulate both the vertices and the cliques of~$\Graph$.
Maple trees will also be fundamental for operadic constructions in \cref{sec:algebra}.

For convenience, in a maple tree, we label the blue vertices by digits (or numbers) and the red vertices by letters (or words).
Consequently, in a block graph, we label the vertices by digits (or numbers) and the cliques by letters (or words).
In this paper, we consider the following additional decorations.

\begin{definition}
  A \defn{decoration} of a set~$\vertexSet$ is a map~$\decoration : \vertexSet \to \{\circ, \up[\circ], \down[\circ], \updown[\circ]\}$.
  For~$U \subseteq \vertexSet$, we define
  \[
    \Up[U] \eqdef \bigset{u \in U}{\decoration(u) \in \{\up[\circ], \updown[\circ]\}}
    \qquad\text{and}\qquad
    \Down[U] \eqdef \bigset{u \in U}{\decoration(u) \in \{\down[\circ], \updown[\circ]\}}.
  \]
  A \defn{decorated maple tree} is a pair~$\decoratedMaple \eqdef (\Maple, \decoration)$ where~$M$ is a maple tree and $\decoration$ is a decoration on the set of blue vertices of~$M$.
  A \defn{decorated block graph} is a pair~$\decoratedGraph \eqdef (\Graph, \decoration)$ where~$\Graph$ is a block graph and $\decoration$ is a decoration on the vertex set of~$\Graph$.
\end{definition}

\begin{example}
  \label{exm:specialGraphs}
  Our results will be illustrated with the following special cases:
  \begin{enumerate}[(i)]
    \item special block graphs: complete graphs, trees, or paths.
    \item special decorations: undecorated ($\Down[\vertexSet] = \Up[\vertexSet] = \varnothing$), down decorated ($\Down[\vertexSet] = \vertexSet$ and~${\Up[\vertexSet] = \varnothing}$), up-down decorated ($\Down[\vertexSet] \sqcup \Up[\vertexSet] = \vertexSet$), and fully decorated ($\Down[\vertexSet] = \Up[\vertexSet] = \vertexSet$).
    \item toy example: the maple tree and block graph of \cref{fig:mapleBlock}.
    \item low-dimensional examples: the four decorated tripod graphs of \cref{fig:tripods}.
  \end{enumerate}
  \vincent{todo: more details and picture}
\end{example}

\begin{remark}
  \label{rem:irrelevantDecorations}
  Note that part of the data of a decorated block graph is actually irrelevant to the structures of this paper.
  In order to make this statement precise, we define for a decorated block graph~$\decoratedGraph \eqdef (\Graph, \decoration)$ two other decorated block graphs:
  \begin{itemize}
    \item $\decoratedGraph^\star \eqdef (\Graph, \decoration^\star)$ where~$\decoration^\star(v) = \circ$ if~$\Graph \ssm \{v\}$ is connected and~$\decoration^\star(v) = \decoration(v)$ otherwise,
    \item $\decoratedGraph^\# \eqdef (\Graph^\#, \decoration)$ where~$\Graph^\#$ is obtained from~$\Graph$ by adding a clique on the neighbors of each vertex~$v$ with~$\decoration(v) = \circ$.
  \end{itemize}
  As stated in \cref{rem:irrelevantDecorationsSpines,rem:irrelevantDecorationsSpinePreorders,rem:irrelevantDecorationsSpinePosets,rem:irrelevantDecorationsNestedComplexes,rem:irrelevantDecorationsSpineFans,rem:irrelevantDecorationsSpinePolytopes}, the structures defined on this paper on~$\decoratedGraph$, $\decoratedGraph^\star$ and~$\decoratedGraph^\#$ are precisely the same.
\end{remark}

\begin{figure}
  \centerline{
  \begin{tikzpicture}[scale=.7]  
    \node (1) at (-4, 4) {$\blue 1$};
    \node (2) at (0, 4) {$\blue \updown[2]$};
    \node (3) at (2, 4) {$\blue 3$};
    \node (4) at (-4, 2) {$\blue 4$};
    \node (5) at (-2, 2) {$\blue \up[5]$};
    \node (6) at (2, 2) {$\blue 6$};
    \node (7) at (-4, 0) {$\blue \down[7]$};
    \node (8) at (0, 0) {$\blue 8$};
    \node (9) at (2, 0) {$\blue \up[9]$};
    %
    \node (a) at (-5, 4) {$\red a$};
    \node (b) at (1, 4) {$\red b$};
    \node (c) at (3, 4) {$\red c$};
    \node (d) at (-3, 3) {$\red d$};
    \node (e) at (-5, 2) {$\red e$};
    \node (f) at (0, 2) {$\red f$};
    \node (g) at (3, 2) {$\red g$};
    \node (h) at (-3, 1) {$\red h$};
    \node (i) at (-5, 0) {$\red i$};
    \node (j) at (1, 0) {$\red j$};
    \node (k) at (3, 0) {$\red k$};
    %
    \draw[-] (a)--(1)--(d)--(4)--(e); 
    \draw[-] (d)--(5)--(h)--(7)--(i); 
    \draw[-] (5)--(f)--(6)--(g); 
    \draw[-] (c)--(3)--(b)--(2)--(f)--(8)--(j)--(9)--(k); 
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}[scale=.7]  
    \node (1) at (-4, 4) {$\blue 1$};
    \node (2) at (0, 4) {$\blue \updown[2]$};
    \node (3) at (2, 4) {$\blue 3$};
    \node (4) at (-4, 2) {$\blue 4$};
    \node (5) at (-2, 2) {$\blue \up[5]$};
    \node (6) at (2, 2) {$\blue 6$};
    \node (7) at (-4, 0) {$\blue \down[7]$};
    \node (8) at (0, 0) {$\blue 8$};
    \node (9) at (2, 0) {$\blue \up[9]$};
    %
    \draw[-] (1)--(4)--(5)--(1); 
    \draw[-] (2)--(6)--(8)--(5); 
    \draw[-] (7)--(5)--(2)--(3); 
    \draw[-] (2)--(8)--(9); 
    \draw[-] (5)--(6); 
  \end{tikzpicture}
  }
  \caption{A decorated maple tree and its associated decorated block graph.}
  \label{fig:mapleBlock}
\end{figure} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Spines and spine preorders}
\label{subsec:spines}

We now define the main objects studied in this paper.

\begin{definition}
  \label{def:sourceTargetSets}
%  Consider an arc~$\gamma$ in a directed tree~$\spine$ whose nodes are sets.
%  The \defn{source set}~$\so[\gamma]$ (resp.~\defn{target set}~$\ta[\gamma]$) of~$\gamma$ is the union of the nodes in the connected component of~$\spine \ssm \{\gamma\}$ containing the source (resp.~target)~of~$\gamma$.
  In a directed tree~$\spine$ whose nodes are sets,
  \begin{itemize}
    \item the \defn{source set}~$\so[\gamma]$ (resp.~\defn{target set}~$\ta[\gamma]$) of an arc~$\gamma$ is the union of the nodes in the connected component of $\spine \ssm \{\gamma\}$ containing the source (resp.~the target) of~$\gamma$,
    \item the \defn{source set}~$\so[X]$ (resp.~\defn{target set}~$\ta[X]$) of a node~$X$ is the union of the source sets~$\so[\alpha]$ of all incoming arcs~$\alpha$ (resp.~of the target sets~$\ta[\beta]$ of all outgoing arcs~$\beta$) of~$X$~in~$\spine$.
  \end{itemize}
\end{definition}

\begin{definition}
  \label{def:spine}
  A \defn{spine} on a decorated block graph $\decoratedGraph \eqdef (\Graph,\decoration)$ is a directed tree $\spine$ such that
  \begin{enumerate}
    \item the nodes of~$\spine$ form a partition of the vertex set~$\vertexSet$ of~$\Graph$, and 
    \item at each node~$X$ of~$\spine$, the source sets $\so[\alpha]$ of the incoming arcs $\alpha$ are contained in distinct connected components of $\Graph \ssm \Down[X]$, and the target sets $\ta[\beta]$ of the outgoing arcs $\beta$ are contained in distinct connected components of $\Graph \ssm \Up[X]$.
  \end{enumerate}
\end{definition}

\begin{figure}[h!]
  \centerline{
  \begin{tikzpicture}[baseline=0]
    \node (256) at (0,0) {$\blue \updown[2] \up[5] 6$};
    \node (14) at (-1, 2) {$\blue 1 4$};
    \node (9) at (1, 2) {$\blue \up[9]$};
    \node (78) at (-1, -2) {$\blue \down[7] 8$};
    \node (3) at (1, -2) {$\blue 3$};
    %
    \draw[->] (256)--(14); 
    \draw[->] (256)--(9); 
    \draw[->] (78)--(256); 
    \draw[->] (3)--(256);
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}[baseline=0]
    \node (1) at (-0.5, 1) {$\blue 1$};
    \node (3) at (0.5, -1) {$\blue 3$};
    \node (4) at (-1, 2) {$\blue 4$};
    \node (25) at (0, 0) {$\blue \updown[2] \up[5]$};
    \node (6) at (0.5, 1) {$\blue 6$};
    \node (7) at (-.5, -1) {$\blue \down[7]$};
    \node (8) at (-1, -2) {$\blue 8$};
    \node (9) at (1, 2) {$\blue \up[9]$};
    %
    \draw[->] (8)--(7); 
    \draw[->] (7)--(25); 
    \draw[->] (3)--(25); 
    \draw[->] (25)--(1); 
    \draw[->] (1)--(4); 
    \draw[->] (25)--(6); 
    \draw[->] (6)--(9); 
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}[baseline=.5]
    \node (1) at (-0.5, 1.5) {$\blue 1$};
    \node (2) at (-0.5, -0.5) {$\blue \updown[2]$};
    \node (3) at (0, -1.5) {$\blue 3$};
    \node (4) at (-1, 2.5) {$\blue 4$};
    \node (5) at (0, 0.5) {$\blue \up[5]$};
    \node (6) at (0.5, 1.5) {$\blue 6$};
    \node (7) at (-1, -1.5) {$\blue \down[7]$};
    \node (8) at (-1.5, -2.5) {$\blue 8$};
    \node (9) at (1, 2.5) {$\blue \up[9]$};
    %
    \draw[->] (8)--(7); 
    \draw[->] (7)--(2); 
    \draw[->] (3)--(2); 
    \draw[->] (2)--(5); 
    \draw[->] (5)--(1); 
    \draw[->] (1)--(4); 
    \draw[->] (5)--(6); 
    \draw[->] (6)--(9); 
  \end{tikzpicture}
  }
  \caption{Three spines~$\spine_1, \spine_2, \spine_3$ on the decorated block graph~$\decoratedGraph$ of \cref{fig:mapleBlock}. We have ${\spine_1 < \spine_2 \lessdot \spine_3}$ in the spine poset~$\spinePoset$, and~$\spine_3$ is maximal (see \cref{subsec:spinePoset}).}
  \label{fig:spines}
\end{figure} 

\begin{example}
  \label{exm:spines}
  For instance, the spines correspond to:
  \vincent{todo: other ideas?}
  \begin{enumerate}[(i)]
    \item the \defn{ordered partitions} of~$\vertexSet$ when $\decoratedGraph$ is complete or undecorated.
    \item the \defn{$\Graph$-trees} studied in~\cite{Postnikov} when~$\decoratedGraph$ is down decorated (in particular the classical \defn{Schr\"oder trees} when~$\decoratedGraph$ is a down decorated path).
    \item the \defn{$\Graph$-ordered partitions}~\cite{Pilaud-acyclicReorientationLattices} (\ie pairs~$(p,o)$ where~$p$ is a partition of~$\vertexSet$ into connected subgraphs of~$\Graph$, and~$o$ is an acyclic orientation of the quotient graph~$\Graph/p$) when~$\decoratedGraph$ is fully decorated.
    \item the \defn{Schr\"oder permutrees} of~\cite{PilaudPons-permutrees} when~$\Graph$ is a path.
  \end{enumerate}
\end{example}

\begin{remark}
  \label{rem:irrelevantDecorationsSpines}
  Using the notations of \cref{rem:irrelevantDecorations}, note that the spines on~$\decoratedGraph$, on $\decoratedGraph^\star$ and on~$\decoratedGraph^\#$ are precisely the same.
\end{remark}

For later purposes, it will convenient to see a spine as a preorder on the vertex set~$\vertexSet$ of~$\Graph$.
Let us first recall the definition of a preorder, and next give two definitions of the preorders arising in the context of spines, that will actually be shown to be equivalent.

\begin{definition}
  \label{def:preorder}
  A \defn{preorder} on~$\vertexSet$ is a reflexive and transitive binary relation~$\preccurlyeq$ on~$\vertexSet$.
  For instance, an \defn{equivalence relation} is a symmetric preorder and a \defn{partial order} is an antisymmetric preorder.
  Any preorder~$\preccurlyeq$ decomposes into an equivalence relation~$\equiv \eqdef \set{(x,y) \in {\preccurlyeq}}{(y,x) \in {\preccurlyeq}}$ together with a partial order~${\le} \eqdef {\preccurlyeq}/{\equiv}$ on the equivalence classes of~$\equiv$.
  We call \defn{Hasse diagram} of~$\preccurlyeq$ the directed graph whose nodes are the equivalence classes of~$\equiv$ and whose arcs are the cover relations of~$\le$.
\end{definition}

\begin{definition}
  \label{def:spinePreorder1}
  Any spine~$\spine$ on~$\decoratedGraph$ defines a preorder~$\preccurlyeq_{\spine}$ on~$\vertexSet$ by $x \preccurlyeq_{\spine} y$ if and only if there is a directed path in~$\spine$ from the node containing~$x$ ot the node containing~$y$ (in particular, $x \equiv_{\spine} y$ if $x$~and~$y$ belong to the same node of~$\spine$).
\end{definition}

\begin{definition}
  \label{def:spinePreorder2}
  A \defn{spine preorder} on~$\decoratedGraph$ is a preorder~$\preccurlyeq$ on~$\vertexSet$ such that~$x,y \in \vertexSet$ are comparable in~$\preccurlyeq$ (\ie $x \preccurlyeq y$, or~$x \succcurlyeq y$, or both) if and only if there is no subsequence~$x = z_i, z_{i+1}, \dots, z_j = y$ with~$i + 1 < j$ of the sequence of nodes along the unique induced path joining~$x$ to~$y$ in~$\Graph$ such~that
  \begin{itemize}
    \item $z_k \in \Down[\vertexSet]$ and~$z_{k-1} \prec z_k \succ z_{k+1}$ for all~$i < k < j$ odd, and
    \item $z_k \in \Up[\vertexSet]$ and~$z_{k-1} \succ z_k \prec z_{k+1}$ for all~$i < k < j$ even.
  \end{itemize}
\end{definition}

\begin{example}
  \label{exm:spinePreorder}
  For instance, the spine preorders on~$\decoratedGraph$ are:
  \begin{enumerate}[(i)]
    \item \defn{complete preorders} on~$\vertexSet$ (\ie $x \preccurlyeq y$ or $x \succcurlyeq y$ or both for any~$x,y \in \vertexSet$) when~$\decoratedGraph$ is complete or undecorated,
    \item \defn{Schr\"oder preorders} when~$\decoratedGraph$ is a down decorated path, \ie preorders on~$[n]$ in which any~$1 \le i < k \le n$ are comparable (\ie~$i \preccurlyeq k$ or $i \succcurlyeq k$ or both) if and only if there is no~$i < j < k$ such that~$i \prec j \succ k$.
  \end{enumerate}
\end{example}

\begin{remark}
  \label{rem:irrelevantDecorationsSpinePreorders}
  Using the notations of \cref{rem:irrelevantDecorations}, note that the spine preorders on~$\decoratedGraph$, on $\decoratedGraph^\star$ and on~$\decoratedGraph^\#$ are precisely the same.
\end{remark}

The following two technical lemmas connect the preorders of spines of \cref{def:spinePreorder1} with the spine preorders of \cref{def:spinePreorder2}.

\begin{lemma}
  \label{lem:spinePreorder1}
  The preorder~$\preccurlyeq_{\spine}$ of any spine~$\spine$ on~$\decoratedGraph$ is a spine preorder on~$\decoratedGraph$.
\end{lemma}

\begin{proof}
%  Consider first a spine~$\spine$ on~$\decoratedGraph$ and its associated preorder~$\preccurlyeq_{\spine}$.
  Let~$x, y \in \vertexSet$ and~$\pi$ be the (possibly empty, possibly undirected) path in~$\spine$ joining the node containing~$x$ to the node containing~$y$.
  By \cref{def:spinePreorder1}, $x$ and~$y$ are comparable in~$\preccurlyeq_{\spine}$ if and only if~$\pi$ is a directed path.
  We thus just need to check that~$\pi$ is not a directed path if and only if there is a subsequence~$z_i, \dots, z_j$ satisfying the conditions of \cref{def:spinePreorder2}.
  
  Assume first that~$\pi$ is not a directed path and consider the nodes of~$\pi$ where~$\pi$ has no incoming or no outgoing arc.
  Label these nodes by~$Z_i, \dots, Z_j$ in order along the path~$\pi$ such that~$x \in Z_i$, $y \in Z_j$ and~$\pi$ has two incoming (resp.~outgoing) arcs at~$Z_k$ for $i < k < j$ odd (resp.~even).
  By \cref{def:spine}, $Z_{k-1}$ and~$Z_{k+1}$ are separated in~$\Graph$ by some~$z_k \in \Down[Z_k]$ (resp.~$\Up[Z_k]$) for each~${i < k < j}$ odd (resp.~even).
  The subsequence~$x, z_{i+1}, \dots, z_{j-1}, y$ thus satisfies the conditions of \cref{def:spinePreorder2}.

  Conversely, assume that there is a subsequence~$z_i, \dots, z_j$ satisfying the conditions of \cref{def:spinePreorder2}.
  Let~$Z_i, \dots, Z_j$ denote the nodes of~$\spine$ containing~$z_i, \dots, z_j$ respectively.
  By \cref{def:spinePreorder1}, there is a directed path joining~$Z_{k+1}$ to~$Z_k$ (resp.~$Z_k$ to~$Z_{k+1}$) for any~$i \le k < j$ odd (resp.~even).
  Hence, the path~$\pi$ passes through the nodes~$Z_i, \dots, Z_j$, and has two incoming (resp.~outgoing) arcs at each~$Z_k$ with~$i < k < j$ odd (resp.~even).
  Therefore, $\pi$ is not a directed path.
\end{proof}

\begin{lemma}
  \label{lem:spinePreorder2}
  The Hasse diagram of any spine preorder~$\preccurlyeq$ on~$\decoratedGraph$ is a spine on~$\decoratedGraph$.
\end{lemma}

\begin{proof}
  Let~$H$ be the Hasse diagram of~$\preccurlyeq$ and~$\pi$ be an undirected path in~$H$.
  Consider the nodes of~$\pi$ where~$\pi$ has no incoming or no outgoing arc, and label these nodes by~$Z_i, \dots, Z_j$ in order along the path~$\pi$ such that~$\pi$ has two incoming (resp.~outgoing) arcs at~$Z_k$ for $i < k < j$ odd~(resp.~even).
  We say that~$\pi$ is \defn{proper} if the union of the nodes of~$\pi$ before~$Z_k$ and the union of the nodes of~$\pi$ after~$Z_k$ belong to distinct connected components of~$\Graph \ssm \Down[Z_k]$ (resp.~$\Graph \ssm \Up[Z_k]$) for all~$i < k < j$ odd (resp.~even).
%  We say that~$\pi$ is \defn{proper} if~$\Down[Z_k]$ (resp.~$\Up[Z_k]$) separates in~$\Graph$ the union of the nodes of~$\pi$ before~$Z_k$ from the union of the nodes of~$\pi$ after~$Z_k$ for all~$i < k < j$ odd (resp.~even).
  
  We claim that the following assertions are equivalent for~$x,y \in \vertexSet$ contained in nodes~$X,Y$ of~$H$:
  \begin{enumerate}[(i)]
    \item $x,y$ are incomparable in~$\preccurlyeq$,
    \item there is a proper undirected path between~$X$ and~$Y$ in~$H$,
    \item there is an undirected path between~$X$ and~$Y$ in~$H$.
  \end{enumerate}
  The equivalence (i)\,$\Leftrightarrow$\,(ii) immediately follows from \cref{def:spinePreorder2}, and the implication (ii)\,$\Rightarrow$\,(iii) is tautological.
  Assume now that there is an undirected path~$\pi$ between~$X$ and~$Y$ in~$H$, and keep the labeling by~$Z_i, \dots, Z_j$ as before.
  For any~$i < k < j$ odd, consider the node~$X_k$ preceding~$Z_k$ and the node~$Y_k$ following~$Z_k$ along~$\pi$.
  Since~$X_k \rightarrow Z_k \leftarrow Y_k$ in the Hasse diagram~$H$, the nodes~$X_k$ and~$Y_k$ are incomparable in~$\preccurlyeq$, so that there is a proper undirected path~$\pi'$ joining~$X_k$ to~$Y_k$.
  If~$\pi'$ is incoming at~$X_k$, then denoting by~$Z'$ the first node of~$\pi'$ with two outgoing arcs, we have~$Z' \prec X_k \prec Z_k$ so that~$X_k$ and~$Z_k$ belong to the same connected component of~$\Graph \ssm \Up[Z']$.
  Hence, $Z_k\pi$ is a proper undirected path joining~$Z_k$ to~$Y_k$, contradicting that~$Z_k$ is comparable to~$Y_k$ in~$\preccurlyeq$.
  By symmetry, we thus obtain that $\pi'$ is outgoing at both~$X_k$ and~$Y_k$.
  We can thus replace~$X_k \rightarrow Z_k \leftarrow Y_k$ by the path~$\pi'$ in~$\pi$.
  With this substitution, we can thus assume that~$X_k$ from~$Y_k$ belong to distinct connected components of~$\Graph \ssm \Down[Z_k]$.
  But~$Z_{k-1}$ and~$X_k$ (resp.~$Z_{k+1}$ and~$Y_k$) belong to the same connected component of~$\Graph \ssm \Down[Z_k]$ since~$Z_{k-1} \prec X_k \prec Z_k$ (resp.~since~$Z_k \succ Y_k \succ Z_{k+1}$).
  By symmetry, we can thus assume that~$Z_{k-1}$ from~$Z_{k+1}$ belong to distinct connected components of~$\Graph \ssm \Down[Z_k]$ (resp.~$\Up[Z_k]$) for all~$i < k < j$ odd (resp.~even), which implies that~$\pi$ is proper.
  This concludes the proof that (i)\,$\Leftrightarrow$\,(ii)\,$\Leftrightarrow$\,(iii).
  
  We now conclude from this claim that~$H$ is a spine:
  \begin{itemize}
    \item $H$ is connected: Any two elements~$x,y$ are connected by a directed path in~$H$ if they are comparable in~$\preccurlyeq$, and by an undirected path in~$H$ otherwise.
    \item $H$ is acyclic: If it contained a cycle~$C$, then for an arbitrary arc~$(x,y) \in C$, we would have an undirected path between~$x$ and~$y$ whose endpoints are comparable in~$\preccurlyeq$.
    \item the nodes of~$H$ partition~$\vertexSet$: They are the classes of the equivalence relation~$\equiv_{\spine}$.
    \item each node of~$H$ satisfies the local condition of \cref{def:spine}: For any node~$X$ of~$H$, any two incoming arcs~$\alpha, \alpha'$ at~$Y$ and any nodes~$Y \in \so[\alpha]$ and~$Y' \in \so[\alpha']$, the unique path (since~$H$ is a connected acyclic) from~$Y$ to~$Y'$ in~$H$ has two incoming arrows at~$X$. Since this path is proper, $Y$ from~$Y'$ belong to distinct connected components of~$\Graph \ssm \Down[X]$. The argument is symmetric for outgoing arcs.
    \qedhere
  \end{itemize}
\end{proof}

\begin{proposition}
  \label{prop:spinePreorder}
  The map~$\spine \mapsto {\preccurlyeq_{\spine}}$ is a bijection from the spines on~$\decoratedGraph$ to the spine preorders~on~$\decoratedGraph$.
\end{proposition}

\begin{proof}
  Observe first that the map~$\spine \mapsto {\preccurlyeq_{\spine}}$ is injective.
  Indeed, the nodes of~$\spine$ are the classes of the equivalence relation~$\equiv_{\spine}$ defined by~$x \equiv_{\spine} y$ if and only if~$x \preccurlyeq_{\spine} y$ and~$y \preccurlyeq_{\spine} x$, and~$\spine$ is the Hasse digram of the poset~${\preccurlyeq_{\spine}} / {\equiv_{\spine}}$ (this holds since~$\spine$ is transitively reduced because it is a directed tree).
  Hence~$\spine \mapsto {\preccurlyeq_{\spine}}$ is a bijection on its image, which is precisely the set of spine preorders on~$\decoratedGraph$ by \cref{lem:spinePreorder1,lem:spinePreorder2}.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Spine poset}
\label{subsec:spinePoset}

We now consider a natural partial order on the spines of \cref{def:spine}.
This relation is easier to define on the spine preorders of \cref{def:spinePreorder1,def:spinePreorder2}.

\begin{definition}
  \label{def:extensionPreorders}
  For two preorders~$\preccurlyeq, \preccurlyeq'$ on~$\vertexSet$, we say that~$\preccurlyeq$ \defn{extends}~$\preccurlyeq'$ when ${\preccurlyeq} \supseteq {\preccurlyeq'}$ as subsets of~$\vertexSet \times \vertexSet$.
  For two spines~$\spine$ on~$\decoratedGraph$ and~$\spine'$ on~$\decoratedGraph'$, we say that~$\spine$ \defn{extends}~$\spine'$ if~$\preccurlyeq_{\spine}$ extends~$\preccurlyeq_{\spine'}$.
\end{definition}

\begin{definition}
  \label{def:spinePoset}
  The \defn{spine poset}~$\spinePoset$ is the poset on spines on~$\decoratedGraph$ defined by~$\spine \le \spine'$ if and only if~$\spine$ extends~$\spine'$.
\end{definition}

\begin{remark}
  \label{rem:irrelevantDecorationsSpinePosets}
  Using the notations of \cref{rem:irrelevantDecorations}, note that the spine posets on~$\decoratedGraph$, on $\decoratedGraph^\star$ and on~$\decoratedGraph^\#$ are precisely the same.
\end{remark}

To understand the spine poset and its cover relations, we now introduce two natural operations on spines: arc contraction and node splitting.
These operations are illustrated in \cref{fig:contractionSplitting}.

\begin{figure}[h!]
  \centerline{
  \begin{tikzpicture}[scale=1.6, baseline=0]
    \node (N0) at (-0.5,-0.5) {\small $X$};
    \node (N1) at (0.5,0.5) {\small $Y$};
    %
    \node (o1) at (-1.2,0.6) {\small $\beta_1$};
    \node (od) at (-0.8,0.6) {\small $\dots$};
    \node (oj) at (-0.3,0.6) {\small $\beta_k$};
    %
    \node (oj1) at (0,1.62) {\small $\beta_{k+1}$};
    \node (ojd) at (0.5,1.6) {\small $\dots$};
    \node (ol) at (1,1.6) {\small $\beta_\ell$};
    %
    \node (i1) at (-1,-1.6) {\small $\alpha_1$};
    \node (id) at (-0.5,-1.6) {\small $\dots$};
    \node (im) at (0,-1.6) {\small $\alpha_i$};
    %
    \node (im1) at (0.3,-0.62) {\small $\alpha_{i+1}$};
    \node (imd) at (0.8,-0.6) {\small $\dots$};
    \node (ik) at (1.2,-0.6) {\small $\alpha_j$};
    %
    \draw[->] (N0)--(o1); 
    \draw[->] (N0)--(od);
    \draw[->] (N0)--(oj);
    %
    \draw[->] (N0)--(N1) node[midway,left] {$\gamma$} ; 
    \draw[->] (N1)--(oj1); 
    \draw[->] (N1)--(ojd);
    \draw[->] (N1)--(ol);
    %
    \draw[->] (i1)--(N0);
    \draw[->] (id)--(N0);
    \draw[->] (im)--(N0); 
    %
    \draw[->] (im1)--(N1); 
    \draw[->] (imd)--(N1);
    \draw[->] (ik)--(N1);
  \end{tikzpicture}
  %
  \qquad 
  %
  \begin{tikzpicture}[scale=1.2, baseline=0]
    \draw[->] (0,0.1)--(1,0.1); 
    \draw[->] (1,-0.1)--(0,-0.1); 
  \end{tikzpicture}
  %
  \qquad 
  %
  \begin{tikzpicture}[scale=1.2, baseline=0]
    \node (N1) at (0,0) {\small $X \cup Y$};
    %
    \node (oj1) at (-0.6,1.5) {\small $\beta_1$};
    \node (ojd) at (0,1.5) {\small $\dots$};
    \node (ol) at (0.6,1.5) {\small $\beta_\ell$};
    %
    \node (im1) at (-0.6,-1.5) {\small $\alpha_1$};
    \node (imd) at (0,-1.5) {\small $\dots$};
    \node (ik) at (0.6,-1.5) {\small $\alpha_j$};
    %
    \draw[->] (N1)--(oj1); 
    \draw[->] (N1)--(ojd);
    \draw[->] (N1)--(ol);
    %
    \draw[->] (im1)--(N1); 
    \draw[->] (imd)--(N1);
    \draw[->] (ik)--(N1);
  \end{tikzpicture}
  }
  \caption{Arc contraction and node splitting on spines.}
  \label{fig:contractionSplitting}
\end{figure} 

\begin{definition}
  \label{def:arccontraction}
  Let~$\gamma$ be an arc of a spine~$\spine$ on $\decoratedGraph$, joining a node~$X$ to a node~$Y$.
  The \defn{contraction} of~$\gamma$ in~$\spine$ is the directed tree obtained from~$\spine$ by replacing the nodes~$X$ and~$Y$ by a single node~$Z \eqdef X \cup Y$ and attaching to~$Z$ all arcs incident to either~$X$~or~$Y$.
  See \cref{fig:contractionSplitting}.
\end{definition}

\begin{proposition}
  \label{prop:arccontraction}
  The contraction of any arc in any spine on~$\decoratedGraph$ is a spine on~$\decoratedGraph$.
\end{proposition}

\begin{proof} 
  Let $\spine'$ be a directed tree obtained by contracting an arc $\gamma$ joining~$X$ to~$Y$ in a spine $\spine$ on~$\decoratedGraph$.
  We clearly just need to prove the local condition of \cref{def:spine} around the node~$Z \eqdef X \cup Y$ of~$\spine'$.
  We give the argument for the incoming arcs; the argument for the outgoing arcs is symmetric. 

  To prove that the source set~$\so[\alpha]$ of each incoming arc~$\alpha$ of~$Z$ is contained in a connected component of~$\Graph \ssm \Down[Z]$, we distinguish two cases:
  \begin{itemize}
    \item If~$\alpha$ is an incoming arc of~$X$ in~$\spine$, then its source set~$\so[\alpha]$ is contained in a connected component $C_1$ of $\Graph \ssm \Down[X]$ and also in a connected component $C_2$ of $\Graph \ssm \Down[Y]$. Thus, it is in $C_1 \cap C_2$. By \cref{def:blockgraph}, the subgraph induced by the vertices of $C_1 \cap C_2$ is a connected component of $(\Graph \ssm \Down[X]) \cap (\Graph \ssm \Down[Y]) = \Graph \ssm \Down[Z]$.
    \item If~$\alpha$ is an incoming arc of~$Y$ in~$\spine$, then its source set $\so[\alpha]$ is in a connected component of $\Graph \ssm \Down[Y]$ that does not contain $X$, hence in a connected component of $\Graph \ssm \Down[Z]$.
  \end{itemize}

  To prove that the source sets~$\so[\alpha]$ and~$\so[\alpha']$ of two distinct incoming arcs~$\alpha$ and~$\alpha'$ of~$Z$ are contained in two distinct connected components of~$\Graph \ssm \Down[Z]$, we distinguish two cases:
  \begin{itemize}
    \item If~$\alpha$ and~$\alpha'$ are both incoming arcs of~$X$ (resp.~of~$Y$) in~$\spine$, then their source sets~$\so[\alpha]$ and~$\so[\alpha']$ live in two distinct connected components of $\Graph \ssm \Down[X]$ (resp.~of~$\Graph \ssm \Down[Y]$), hence in two distinct connected components of $\Graph \ssm \Down[Z]$.
    \item If~$\alpha$ is an incoming arc of~$X$ in~$\spine$ while~$\alpha'$ is an incoming arc of~$Y$ in~$\spine$, then their source sets~$\so[\alpha] \subset \so[\gamma]$ and~$\so[\alpha']$ live in two distinct connected components of $\Graph \ssm \Down[Y]$, hence in two distinct connected components of $\Graph \ssm \Down[Z]$.
    \qedhere
  \end{itemize}
\end{proof}

To define the reverse operation of node splitting, we first need the following notion.

\begin{definition}
  \label{def:splittable}
  Let~$Z$ be a subset of vertices of~$\Graph$.
  A \defn{$\decoratedGraph$-splittable partition} is an ordered partition~$X \sqcup Y = Z$ such that~$X \ne \varnothing$ is contained in a connected component of~$\Graph \ssm \Down[Y]$ and $Y \ne \varnothing$ is contained in a connected component of~$\Graph \ssm \Up[X]$.
\end{definition}

\begin{proposition}
  \label{prop:splittablePartitions}
  Any subset $Z$ of vertices of~$\Graph$ with $|Z| \ge 2$ admits a $\decoratedGraph$-splittable partition.
\end{proposition}

\begin{proof} 
  Consider a spanning tree~$T$ of~$\Graph$, and an edge~$e$ of~$T$ such that both connected components~$C$ and~$D$ of~$T \ssm \{e\}$ intersect~$Z$ (this exists since~$|Z| \ge 2$).
  Let~$X \eqdef Z \cap C$ and~$Y \eqdef Z \cap D$.
  Then~$X \ne \varnothing$ is contained in a connected component of~$T \ssm D$, thus in a connected component of~$\Graph \ssm \Down[Y]$ (since~$T \subseteq \Graph$ and~$\Down[Y] \subseteq D$).
  Similarly $Y \ne \varnothing$ is contained in a connected component of~$T \ssm C$, thus in a connected component of~$\Graph \ssm \Up[X]$.
\end{proof}

\begin{definition}
  \label{def:nodeSplitting} 
  %Let $\spine$ be a spine on $\decoratedGraph$, let~$Z$ be a node of~$\spine$, and let~$X \sqcup Y = Z$ be a splittable partition of~$Z$.
  Let~$X \sqcup Y = Z$ be a splittable partition of a node~$Z$ of a spine~$\spine$ on~$\decoratedGraph$.
  The \defn{splitting} of~$X \sqcup Y$ in~$\spine$ is the directed tree obtained from~$\spine$ by replacing the node~$Z$ by an arc~$\gamma$ connecting a node~$X$ to a node~$Y$,~and
  \begin{itemize}
    \item connecting each incoming arc~$\alpha$ of~$Z$ to~$X$ if its source set~$\so[\alpha]$ is contained in a connected component of $\Graph \ssm \Down[Z]$ adjacent to $\Down[X]$, and to~$Y$ otherwise, 
    \item connecting each outgoing arc~$\beta$ of~$Z$ to~$Y$ if its target set~$\ta[\beta]$ is contained in a connected component of $\Graph \ssm \Up[Z]$ adjacent to $\Up[Y]$, and to~$X$ otherwise.
  \end{itemize}
  See \cref{fig:contractionSplitting}.
\end{definition}

\begin{proposition}
  \label{prop:nodeSplitting} 
  The splitting of any splittable partition in any spine on~$\decoratedGraph$ is a spine on~$\decoratedGraph$.
\end{proposition}

\begin{proof}
  Let~$\spine'$ be a directed tree obtained by splitting a splittable partition~$X \sqcup Y = Z$ of a node~$Z$ in a spine $\spine$ on~$\decoratedGraph$.
  We clearly just need to prove the local condition of \cref{def:spine} around the nodes~$X$ and~$Y$ of~$\spine'$.
  We give the argument for~$X$; the argument for~$Y$ is symmetric.
  
  We start with the incoming arcs of~$X$.
  First, each incoming arc~$\alpha$ of~$X$ is an incoming arc of~$Z$, hence~$\so[\alpha]$ is contained in a connected component of~$\Graph \ssm \Down[Z]$, hence in a connected component of~$\Graph \ssm \Down[X]$.
  Moreover, any two distinct incoming arcs~$\alpha$ and~$\alpha'$ of~$X$ are distinct incoming arcs of~$Z$. Thus~$\so[\alpha]$ and~$\so[\alpha']$ are contained in distinct connected components of~$\Graph \ssm \Down[Z]$, hence in distinct connected components of~$\Graph \ssm \Down[X]$, since~$X$ is contained in a connected component of~$\Graph \ssm \Down[Y]$.

  We now consider the outgoing arcs of~$X$.
  To prove that the target set of each outgoing arc~$\beta$ of~$X$ is contained in a connected component of~$\Graph \ssm \Up[X]$, we distinguish two cases:
  \begin{itemize}
    \item If~$\beta \ne \gamma$, then~$\beta$ is an outgoing arc of~$Z$, hence~$\ta[\beta]$ is contained in a connected component of~$\Graph \ssm \Up[Z]$, hence in a connected component of~$\Graph \ssm \Up[X]$.
    \item If~$\beta = \gamma$, then~$\ta[\gamma]$ is the union of~$Y$ with~$\so[\alpha']$ for all incoming arcs~$\alpha'$ of~$Y$ and~$\ta[\beta']$ for all outgoing arcs~$\beta'$ of~$Y$. We next prove that all these sets are contained in the same connected component of~$\Graph \ssm \Up[X]$.
    \begin{itemize}
      \item By \cref{def:nodeSplitting}, $Y$ is contained in a connected component~$C$ of~$\Graph \ssm \Up[X]$. 
      \item Consider an incoming arc~$\alpha'$ of~$Y$. The set~$\so[\alpha']$ is contained in a connected component~$D$ of~$\Graph \ssm \Down[Z]$, and in a connected component~$E$ of~$\Graph \ssm \Down[Y]$, with~$D \subseteq E$. By \cref{def:nodeSplitting}, $D$ is not adjacent to~$\Down[X]$. By \cref{def:splittable}, $E$ is thus disjoint from~$X$. This implies on the one hand that~$D$ is disjoint from~$\Up[X]$, thus connected in~$\Graph \ssm \Up[X]$, and on the other hand that~$D$ is adjacent to~$\Down[Y]$, hence contained in~$C$. 
      \item Consider an outgoing arc~$\beta'$ of~$Y$. By \cref{def:nodeSplitting}, the set $\ta[\beta']$ is contained in a connected component of~$\Graph \ssm \Up[Z]$ adjacent to~$Y$, hence $\ta[\beta']$ is contained in~$C$.
    \end{itemize}
  \end{itemize}
  To prove that the target sets of two distinct outgoing arcs~$\beta$ and~$\beta'$ of~$X$ are contained in two distinct connected components of~$\Graph \ssm \Up[X]$, we distinguish two cases:
  \begin{itemize}
  \item Assume that~$\beta$ and~$\beta'$ are both distinct from~$\gamma$. Let~$C$ be the connected component of~$\Graph \ssm \Up[X]$ containing~$Y$, and let~$D$ and~$D'$ (resp.~$E$ and~$E'$) the connected components of $\Graph \ssm \Up[Z]$ (resp.~$\Graph \ssm \Up[X]$) containing~$\ta[\beta]$ and $\ta[\beta']$. By \cref{def:nodeSplitting}, $D$ and~$D'$ are not adjacent to~$\Up[Y]$. By \cref{def:splittable}, $E$ and~$E'$ are thus disjoint from~$Y$. This implies that~$E = D$ and~$E' = D'$ are distinct.
  \item Assume that~$\beta' = \gamma$. As before, the connected component of~$\Graph \ssm \Up[X]$ containing~$\ta[\beta]$ is disjoint from~$Y$, thus is distinct from that containing~$\ta[\gamma]$.
  \qedhere
  \end{itemize}
\end{proof}

We now connect arc contractions, node splittings, and the spine poset.

\begin{theorem}
  \label{thm:spinePoset}
  The following conditions are equivalent for two spines~$\spine, \spine'$ on~$\decoratedGraph$:
  \begin{enumerate}[(i)]
  \item $\spine \le \spine'$ in the spine poset~$\spinePoset$,
  \item $\spine$ is obtained from~$\spine'$ by a sequence of arc contractions,
  \item $\spine'$ is obtained from~$\spine$ by a sequence of node splittings.
  \end{enumerate}
  Hence, the spines covered (resp.~covering) a spine~$\spine$ in the spine poset~$\spinePoset$ are precisely the spines obtained by an arc contraction (resp.~a node splitting) in~$\spine$.
\end{theorem}

\begin{proof}
  It is clear that if~$\spine'$ is the splitting of~$X \sqcup Y$ in~$\spine$, then~$\spine$ is the contraction of the arc joining~$X$ to~$Y$ in~$\spine'$.
  Conversely, if~$\spine$ is the contraction of an arc joining~$X$ to~$Y$ in~$\spine'$, then the partition~$X \sqcup Y$ is splittable by \cref{def:spine}, and~$\spine'$ is the splitting of~$X \sqcup Y$~in~$\spine$.
  This shows that arc contraction and node splitting are inverse operations, which by iteration proves the equivalence between (ii) and (iii).
  Moreover, it immediately follows from \cref{def:spinePreorder1} that (ii) or (iii) imply that~$\spine$ extends~$\spine'$, which is (i).
  We thus just need to check that (i) implies (ii).

  Assume by contradiction that~$\spine \ne \spine'$, that~$\spine$ extends~$\spine'$, and that there is no contraction in~$\spine'$ that preserves this property.
  Since~$\spine \ne \spine'$ and~$\spine$ extends~$\spine'$, there are vertices~$x, y \in \vertexSet$ such that~$x \preccurlyeq_{\spine} y$ while~$x \not\preccurlyeq_{\spine'} y$.
  Consider such a pair~$\{x,y\}$ whose distance in~$\Graph$ is minimal.
  Let~$X$ and~$Y$ be the nodes of~$\spine$ containing~$x$ and~$y$ respectively, and let~$\pi$ be the path joining~$X$ to~$Y$ in~$\spine$, and define similarly~$X'$, $Y'$ and~$\pi'$~in~$\spine'$.

  Note that~$\pi'$ is not fully directed from~$X'$ to~$Y'$ since~$x \not\preccurlyeq_{\spine'} y$.
  Assume now that~$\pi'$ is fully directed from~$Y'$ to~$X'$.
  For any~$z \in \vertexSet$ contained in a node along~$\pi'$, we have~$y \preccurlyeq_{\spine'} z \preccurlyeq_{\spine'} x$, which implies that~$y \preccurlyeq_{\spine} z \preccurlyeq_{\spine} x$ (since~$\spine$ extends~$\spine'$), so that~$x \equiv_{\spine} y \equiv_{\spine} z$ (since~$x \preccurlyeq_{\spine} y$).
  Said differently, all vertices of~$\vertexSet$ that appear in the nodes along~$\pi'$ are equivalent for~$\equiv_{\spine}$.
  Hence, contracting any arc of~$\spine'$ along the path~$\pi'$ yields a spine which is still extended by~$\spine$, contradicting our assumption.
  
  We can thus now assume that~$\pi'$ is not a directed path, so that there is a node of~$\spine'$ where~$\pi'$ has either two incoming or two outgoing arcs.
  Let~$Z'$ be the closest such node from~$X'$.
  We now distinguish two cases:
  \begin{enumerate}[(i)]
    \item Assume first that~$\pi'$ has two outgoing arcs at~$Z'$.
    Since~$x$ and~$y$ belong to the target sets of two distinct outgoing arcs of~$Z'$, there is~$z \in \Up[Z']$ which separates~$x$ and~$y$ in~$\Graph$.
    Denote by~$Z$ the node of~$\spine$ containing~$z$.
    Since~$z \preccurlyeq_{\spine'} x$ and~$\spine$ extends~$\spine'$, we have~$z \preccurlyeq_{\spine} x \preccurlyeq_{\spine} y$.
    This implies that~$x$ and~$y$ appear in the target set of the same outgoing arc at~$Z$, even if they are separated by~$z \in \Up[Z]$, so that~$\spine$ fails the local condition around~$Z$ to be a spine~on~$\decoratedGraph$.
    %
    \item Assume now that~$\pi'$ has two incoming arcs at~$Z'$.
    Since~$x$ and~$y$ belong to the source sets of two distinct incoming arcs of~$Z'$, there is~$z \in \Down[Z']$ which separates~$x$ and~$y$ in~$\Graph$.
    Denote by~$Z$ the node of~$\spine$ containing~$z$.
    Since~$x \preccurlyeq_{\spine'} z$ and~$\spine$ extends~$\spine'$, we have~$x \preccurlyeq_{\spine} z$.
    Since~$z \not\preccurlyeq_{\spine'} y$ and~$y$ is closer to~$z$ than to~$x$ in~$\Graph$, our choice of~$\{x,y\}$ ensures that~$z \not\preccurlyeq_{\spine} y$.
    Hence, $Z$ does not appear along the path~$\pi$.
    This implies that~$x$ and~$y$ appear in the source set of the same incoming arc at~$Z$, even if they are separated by~$z \in \Down[Z]$, so that~$\spine$ fails the local condition around~$Z$ to be a spine~on~$\decoratedGraph$.
    \qedhere
  \end{enumerate}
\end{proof}

\begin{corollary} 
  The spine poset~$\spinePoset$ is graded by the number of nodes minus one and
  \begin{itemize}
    \item the unique rank $0$ (\ie minimal) element is the spine with a single node, 
    \item the rank~$1$ elements are the spines with precisely two nodes, 
    \item the corank~$1$ elements are the spines where the nodes are all singletons except one pair,
    \item the corank~$0$ (\ie maximal) elements are the spines where the nodes are all singletons.
  \end{itemize}
\end{corollary}

\begin{proof}
  By \cref{thm:spinePoset}, the cover relations in the spine poset correspond to single contractions (or conversely single node splittings), which decrements (resp.~increment) the number of nodes of the spine.
  Hence, the number of nodes is a rank function for the spine poset, and the other assertions immediately follow.
\end{proof}

\begin{corollary}
  \label{coro:simplicialPoset}
  The spine poset is a simplicial poset: any interval is a boolean lattice.
\end{corollary}

\begin{proof}
  Consider~$\spine \le \spine'$ in the spine poset.
  By \cref{thm:spinePoset}, $\spine$ is obtained by contracting a subset~$A$ of arcs in~$\spine'$, and the interval~$[\spine, \spine']$ of the spine poset is precisely the set of spines obtained by contracting a subset of~$A$ in~$\spine'$.
\end{proof}

\begin{remark}
  In the spine poset:
  \begin{itemize}
    \item a spine with~$a$ arcs covers~$a$ spines, and is larger than precisely $\binom{a}{b}$ spines with~$b$ arcs,
    \item a spine with~$k$ nodes of cardinality~$n_1, \dots, n_k$ is covered by at least~$2^{|\set{i \in [k]}{n_i \ge 2}|}$ and at most~$\prod_{i \in [k]} 2^{n_i}-2$ spines. In particular, a corank~$1$ spine is covered by precisely $2$ maximal~spines.
  \end{itemize}
\end{remark}

\begin{corollary}
  \label{coro:splittablePartitions}
  For any arc arc~$\gamma$ of a spine~$\spine$ on~$\decoratedGraph$, the sets~$\so[\gamma]$ and~$\ta[\gamma]$ form a $\decoratedGraph$-splittable partition of the vertex set of~$\Graph$.
\end{corollary}

\begin{proof}
  Consider the rank~$1$ spine~$\spine'$ on~$\decoratedGraph$ obtained by contracting all arcs in~$\spine$ except~$\gamma$. 
  By \cref{thm:spinePoset}, $\spine$ is obtained from the rank~$0$ spine by a node splitting. 
  Hence, $\so[\gamma]$ and~$\ta[\gamma]$ form a $\decoratedGraph$-splittable partition of the vertex set of~$\Graph$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Chunk nested complex}
\label{subsec:nestedComplex}

We have observed in~\cref{coro:simplicialPoset} that the spine poset is a simplicial poset.
We next show that the spine poset is actually isomorphic to the inclusion poset of a flag simplicial complex.

\begin{definition}
  \label{def:chunk}
  A \defn{chunk} of~$\decoratedGraph$ is a subset~$\chunk$ of vertices of~$\Graph$ such that~$\chunk$ and its complement~$\vertexSet \ssm \chunk$ form a $\decoratedGraph$-splittable partition of the vertex set~$\vertexSet$ (see \cref{def:splittable}).
\end{definition}

\begin{definition}
  \label{def:compatibleChunks}
  Let~$\chunk$ and~$\chunk'$ be two chunks of~$\decoratedGraph$.
  We write:
  \begin{itemize}
    \item $\chunk \negDisjoint \chunk'$ when $\chunk \cap \chunk' = \varnothing$ and $\chunk \cup \chunk'$ is not a chunk of~$\decoratedGraph$,
    \item $\chunk \posDisjoint \chunk'$ when $\chunk \cup \chunk' = \vertexSet$ and~$\chunk \cap \chunk'$ is not a chunk of~$\decoratedGraph$.
  \end{itemize}
  We say that~$\chunk$ and~$\chunk'$ are \defn{compatible} if $\chunk \subseteq \chunk'$, or $\chunk \supseteq \chunk'$, or $\chunk \negDisjoint \chunk'$, or $\chunk \posDisjoint \chunk'$.
\end{definition}

\begin{definition}
  \label{def:nestedComplex}
  A \defn{chunk nested set} on~$\decoratedGraph$ is a set of pairwise compatible chunks of~$\decoratedGraph$.
  The \defn{chunk nested complex}~$\nestedComplex$ is the simplicial complex of chunk nested sets on~$\decoratedGraph$.
  In other words, it is the clique complex of the compatibility relation on chunks of~$\decoratedGraph$.
\end{definition}

\begin{example}
  \label{exm:nestedComplex}
  For instance, the chunk nested sets are:
  \begin{enumerate}[(i)]
    \item the sets~$\chunk_1 \subsetneq \chunk_2 \subsetneq \dots \subsetneq \chunk_k$ of nested subsets of~$\vertexSet$ when $\decoratedGraph$ is complete or undecorated.
    \item the \defn{$\Graph$-nested trees} studied in~\cite{CarrDevadoss} when~$\decoratedGraph$ is down decorated.
  \end{enumerate}
\end{example}

\begin{remark}
  \label{rem:irrelevantDecorationsNestedComplexes}
  Using the notations of \cref{rem:irrelevantDecorations}, note that the chunk nested complexes on~$\decoratedGraph$, on $\decoratedGraph^\star$ and on~$\decoratedGraph^\#$ are precisely the same.
\end{remark}

\begin{theorem}
  \label{thm:spineToNested}
  The map~$\spineToNested$ defined by~$\spineToNested(\spine) \eqdef \set{\so[\gamma]}{\gamma \text{ arc of } \spine}$ is a poset isomorphism from the spine poset~$\spinePoset$ to the face poset of the chunk nested complex~$\nestedComplex$.
\end{theorem}

\begin{corollary}
  The chunk nested complex~$\nestedComplex$ is a pure and flag simplicial complex.
\end{corollary}

\begin{proof}[Proof of \cref{thm:spineToNested}]
  We prove that the map~$\spineToNested$ is well-defined, injective, surjective, and order-preserving.
  
  \para{Well-defined}
  Observe that for any spine~$\spine$ on~$\decoratedGraph$:
  \begin{itemize}
    \item For any arc~$\gamma$ of~$\spine$, the source set~$\so[\gamma]$ is a chunk of~$\decoratedGraph$ by \cref{coro:splittablePartitions}. 
    \item For any two arcs~$\gamma$ and~$\gamma'$ of~$\spine$, the chunks~$\so[\gamma]$ and~$\so[\gamma']$ of~$\decoratedGraph$ are compatible. 
    Indeed, since the spine~$\spine$ is a tree, there is a unique path~$\pi$ joining~$\gamma$ to~$\gamma'$ in~$\spine$.
    As illustrated in \cref{fig:sourceSetsCompatible}, we observe that:
    \begin{itemize}
      \item If $\pi$ connects the target of~$\gamma$ to the source of~$\gamma'$, then~$\so[\gamma] \subseteq \so[\gamma']$.
      \item If $\pi$ connects the source of~$\gamma$ to the target of~$\gamma'$, then~$\so[\gamma] \supseteq \so[\gamma']$.
      \item If $\pi$ connects the sources of~$\gamma$ and~$\gamma'$, then $\so[\gamma] \negDisjoint \so[\gamma]'$.
      Indeed, there is at least one node~$X$ of~$\spine$ where~$\pi$ has two incoming arcs~$\alpha, \alpha'$.
      By \cref{def:spine}, $\so[\alpha]$ and~$\so[\alpha']$ belong to two distinct connected components of~$\Graph \ssm \Down[X]$.
      Hence, we obtain that~${\so[\gamma] \subseteq \so[\alpha]}$ and~${\so[\gamma] \subseteq \so[\alpha']}$ belong to distinct connected components of~$\Graph \ssm \Down[X]$ hence of~${\Graph \ssm \Down[{\vertexSet \ssm (\so[\gamma] \cup \so[\alpha'])}]}$.
      \item Similarly, if $\pi$ connects the targets of~$\gamma$ and~$\gamma'$, then $\so[\gamma] \posDisjoint \so[\gamma]'$.
    \end{itemize}
    %
    \begin{figure}[h]
      \capstart
      \centerline{
        \begin{tabular}{c@{\hspace{1cm}}c@{\hspace{1cm}}c@{\hspace{1cm}}c}
          \raisebox{.3cm}{\includegraphics[scale=.8]{positiveNested}} & \raisebox{.3cm}{\includegraphics[scale=.8]{negativeNested}} & \includegraphics[scale=.8]{negativeDisjoint} & \includegraphics[scale=.8]{positiveDisjoint} \\[.2cm]
          $\so[\gamma] \subseteq \so[\gamma']$ & $\so[\gamma] \supseteq \so[\gamma']$ & $\so[\gamma] \negDisjoint \so[\gamma']$ & $\so[\gamma] \posDisjoint \so[\gamma']$
        \end{tabular}
      }
      \caption{The relative position of two arcs~$\gamma$ and~$\gamma'$ in a signed spine~$\spine$ determines the compatibility relation between their source label sets~$\so[\gamma]$ and~$\so[\gamma]$.}
      \label{fig:sourceSetsCompatible}
    \end{figure}
  \end{itemize}

  \para{Injective}
  To see the injectivity of~$\spineToNested$, we prove that we can reconstruct a spine~$\spine$ from the source sets of its arcs.
  First the the nodes of~$\spine$ are the equivalence classes under the relation~$v \equiv w$ if there is no arc~$\gamma$ of~$\spine$ such that~$|\{v,w\} \cap \so[\gamma]| = 1$.
  Second, the leaves of~$\spine$ correspond to the source sets containing either only one or all but one node of~$\spine$. 
  We can then delete one leaf~$\ell$ of~$\spine$, and reconstruct by induction the tree~$\spine \ssm \{\ell\}$. 
  Finally the only possible node of~$\spine \ssm \{\ell\}$ to which the leaf~$\ell$ can be glued is the unique node which is in the intersection of all source sets~$\chunk$ of~$\spine \ssm \{\ell\}$ such that~$\chunk \cup \ell$ is a source set of~$\spine$, but not in the union of all source sets~$\chunk$ of~$\spine \ssm \{\ell\}$ such that~$\chunk \cup \ell$ is not a source set of~$\spine$.

  \para{Surjective}
  To see the surjectivity of~$\spineToNested$, we prove that for any chunk nested set~$\nested$ on~$\decoratedGraph$,
\begin{enumerate}[(a)]
\item there exists a spine~$\spine$ on~$\decoratedGraph$ such that~$\spineToNested(\spine) = \nested$, and
\item for any chunk~$\chunk$ of~$\decoratedGraph$ compatible with all chunks of~$\nested$, there exists a node~$X$ of~$\spine$ such that the partition~$X = (X \cap \chunk) \sqcup (X \ssm \chunk)$ is splittable (see \cref{def:splittable}).
\end{enumerate}
  These properties are proved by induction on the size of~$\nested$.  
  To initialize, observe that the rank~$0$ spine (with a single node~$\vertexSet$) is sent to the empty chunk nested set for which Property~(b) above holds by \cref{def:chunk}.

  Assume now that these properties hold for a given chunk nested set~$\nested$ and consider a bigger chunk nested set~$\nested' \eqdef \nested \cup \{\chunk\}$.
  Let~$\spine$ be the spine such that~$\spineToNested(\spine) = \nested$ and let~$X$ be a node of~$\spine$ such that the partition~$X = (X \cap \chunk) \sqcup (X \ssm \chunk)$ is splittable.
  Let~$\spine'$ denote the spine obtained by the splitting of~$(X \cap \chunk) \sqcup (X \ssm \chunk)$ in~$\spine$.
  We claim that $\spine$ satisfies Properties (a) and (b) above.
  
  Consider first an incoming arc~$\alpha$ of~$X$ in~$\spine$.
  Since~$\chunk$ is compatible with~$\so[\alpha]$, and both~$X \cap \chunk$ and~$X \ssm \chunk$ are non-empty, we obtain that~$\so[\alpha] \subseteq \chunk$ or~$\so[\alpha] \negDisjoint \chunk$.
  Moreover, by \cref{def:nodeSplitting}, the arc~$\alpha$ is connected to the node~$X \cap \chunk$ of~$\spine'$ if~$\so[\alpha] \subseteq \chunk$, and to the node~$X \ssm \chunk$ of~$\spine'$ if~$\so[\alpha] \negDisjoint \chunk$.
  Similarly, for any outgoing arc~$\beta$ of~$X$ in~$\spine$, we have~$\so[\beta] \supseteq \chunk$ or~$\so[\alpha] \posDisjoint \chunk$, and the arc~$\beta$ is connected to the node~$X \ssm \chunk$ of~$\spine'$ if~$\so[\beta] \supseteq \chunk$, and to the node~$X \cap \chunk$ of~$\spine'$ if~$\so[\beta] \posDisjoint \chunk$.
  In particular, we have~$\so[\alpha] \subseteq \chunk$ for each incoming arc~$\alpha$ of~$X \cap \chunk$ in~$\spine'$, and~$\ta[\beta] \subseteq \chunk$ for each outgoing arc~$\beta$ of~$X \cap \chunk$ in~$\spine'$ (since~$\so[\beta] \posDisjoint \chunk$ implies $\so[\beta] \cup \chunk = \vertexSet$ hence $\ta[\beta] = \vertexSet \ssm \so[\beta] \subseteq \chunk$).
  We thus obtain that~$\so[\gamma] \subseteq \chunk$, and similarly that~$\ta[\gamma] \subseteq \vertexSet \ssm \chunk$, from which we conclude that $\so[\gamma] = \chunk$.
  Since~$\spine'$ is obtained by splitting a node of~$\spine$ into an arc~$\gamma$, we have~$\spineToNested(\spine') = \spineToNested(\spine) \cup \{\so[\gamma]\} = N \cup \{\chunk\} = N '$.

  Consider now another chunk~$\chunk'$ of~$\decoratedGraph$ compatible with all chunks of~$N'$.
  Since~$\chunk'$ is compatible with~$N \subseteq N'$, there is a node~$X'$ of~$\spine$ such that the partition~$X' = (X' \cap \chunk') \sqcup (X' \ssm \chunk')$ is splittable.
  If~$X \ne X'$, then~$X'$ is still a node of~$\spine'$ so that there is nothing to prove.
  If~$X = X'$, then the node~$X \cap \chunk$ of~$\spine'$ suits if~$\chunk \supseteq \chunk'$ or~$\chunk \negDisjoint \chunk'$, while the node~$X \ssm \chunk$ of~$\spine'$  suits if~$\chunk \subseteq \chunk'$ or~$\chunk \posDisjoint \chunk'$.
  \vincent{Check that, maybe add a sentence...}

  \para{Order-preserving}
  Finally, $\spineToNested$ is clearly order preserving as contracting one arc of a spine~$\spine$ removes the corresponding chunk of the chunk nested set~$\spineToNested(\spine)$.
\end{proof}

\begin{remark}
  \label{rem:nestedToSpine}
  From the proof of \cref{thm:spineToNested}, we can give a direct description of the inverse map~$\nestedToSpine$ of the map~$\spineToNested$.
  Namely, consider a chunk nested set~$N$ and two chunks~$\chunk, \chunk'$ of~$N$, and let~$\gamma, \gamma'$ denote the arcs of~$\spine \eqdef \nestedToSpine(N)$ such that~$\so[\gamma] = \chunk$ and~$\so[\gamma'] = \chunk'$.
  Then
  \begin{enumerate}[(i)]
    \item the target of~$\gamma$ and the source of~$\gamma'$ coincide iff~$\chunk \subseteq \chunk'$ and~$\nexists \, \chunk'' \in \nested$ with~$\chunk \subseteq \chunk'' \subseteq \chunk'$ or~$\chunk \negDisjoint \chunk'' \posDisjoint \chunk'$,
    \item the targets of~$\gamma$ and~$\gamma'$ coincide iff~$\chunk \negDisjoint \chunk'$ and~$\nexists \, \chunk'' \in \nested$ with~$\chunk \subseteq \chunk'' \negDisjoint \chunk'$ or~${\chunk \negDisjoint \chunk'' \supseteq \chunk'}$,
\item the sources of~$\gamma$ and~$\gamma'$ coincide iff~$\chunk \posDisjoint \chunk'$ and~$\nexists \, \chunk'' \in \nested$ with~$\chunk \posDisjoint \chunk'' \subseteq \chunk'$ or~${\chunk \supseteq \chunk'' \posDisjoint \chunk'}$.
\end{enumerate}
This gives a description of the nodes of the spine~$\nestedToSpine(\nested)$ in terms of equivalence classes of chunks of~$\nested$ (by the relations above). It also gives a direct definition of the directed graph underlying~$\nestedToSpine(\nested)$ as a quotient of a collection of disjoint arcs labeled by~$\nested$ by identification of some of their endpoints. Finally, each node of~$\nestedToSpine(\nested)$ with incoming arcs~$A$ and outgoing arcs~$\chunk$ is given by
\[
\bigg( \bigcap_{\beta \in \chunk} \so[\beta] \bigg) \ssm \bigg( \bigcup_{\alpha \in A} \so[\alpha] \bigg) = \vertexSet \ssm \bigg( \bigcup_{\alpha \in A} \so[\alpha] \cup \bigcup_{\beta \in \chunk} \ta[\beta] \bigg).
\]
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Flips}
\label{subsec:flips}

In this section, we introduce an elementary local operation on spines on~$\decoratedGraph$, motivated by the following statement.

\begin{proposition}
  \label{prop:pseudomanifold}
  Any corank~$1$ spine is covered by exactly two corank~$0$ spines in~$\spinePoset$.
  Hence, the chunk nested complex~$\nestedComplex$ is a closed pseudo-manifold.
\end{proposition}

\begin{proof}
  Let~$\spine$ be a corank~$1$ spine on~$\decoratedGraph$.
  Then all nodes of~$\spine$ are singletons, except one which is a pair~$Z \eqdef \{x,y\}$.
  This pair admits two non-trivial ordered partitions~${\{x\} \sqcup \{y\} = Z}$ and~${\{y\} \sqcup \{x\} = Z}$ which are both $\decoratedGraph$-splittable.
  Hence, $\spine$ is covered by precisely two corank~$0$ spines according from \cref{prop:nodeSplitting,thm:spinePoset}.
\end{proof}

This motivates to consider the dual graph of the chunk nested complex.
Here, we define it directly on spines.
See \cref{fig:generalFlip,fig:flip}.

\begin{figure}[h!]
  \centerline{
  \begin{tikzpicture}[scale=1.6, baseline=0]
    \node (N0) at (-0.5,-0.5) {\small $x$};
    \node (N1) at (0.5,0.5) {\small $y$};
    %
    \node (o1) at (-1.2,0.6) {\small $\beta_1$};
    \node (od) at (-0.8,0.6) {\small $\dots$};
    \node (oj) at (-0.3,0.6) {\small $\beta_k$};
    %
    \node (oj1) at (0,1.62) {\small $\beta_{k+1}$};
    \node (ojd) at (0.5,1.6) {\small $\dots$};
    \node (ol) at (1,1.6) {\small $\beta_\ell$};
    %
    \node (2) at (1.5,1.6) {\small $\boldsymbol{\beta}$};
    %
    \node (1) at (-1.5,-1.6) {\small $\boldsymbol{\alpha}$};
    %
    \node (i1) at (-1,-1.6) {\small $\alpha_1$};
    \node (id) at (-0.5,-1.6) {\small $\dots$};
    \node (im) at (0,-1.6) {\small $\alpha_i$};
    %
    \node (im1) at (0.3,-0.62) {\small $\alpha_{i+1}$};
    \node (imd) at (0.8,-0.6) {\small $\dots$};
    \node (ik) at (1.2,-0.6) {\small $\alpha_j$};
    %
    \draw[->,thick] (1)--(N0); 
    \draw[->,thick] (N1)--(2); 
    %
    \draw[->] (N0)--(o1); 
    \draw[->] (N0)--(od);
    \draw[->] (N0)--(oj);
    %  
    \draw[->] (N0)--(N1) node[midway, left] {$\gamma$} ; 
    \draw[->] (N1)--(oj1); 
    \draw[->] (N1)--(ojd);
    \draw[->] (N1)--(ol);
    %
    \draw[->] (i1)--(N0);
    \draw[->] (id)--(N0);
    \draw[->] (im)--(N0); 
    %
    \draw[->] (im1)--(N1); 
    \draw[->] (imd)--(N1);
    \draw[->] (ik)--(N1);
  \end{tikzpicture}
  %
  \begin{tikzpicture}[scale=1.2, baseline=0]
    \draw[->] (0,0)--(1,0); 
  \end{tikzpicture}
  %
  \begin{tikzpicture}[scale=1.6, baseline=0]
    \node (N0) at (-0.5,0.5) {\small $x$};
    \node (N1) at (0.5,-0.5) {\small $y$};
    %  
    \node (o1) at (-1,1.6) {\small $\beta_1$};
    \node (od) at (-0.5,1.6) {\small $\dots$};
    \node (oj) at (0,1.6) {\small $\beta_k$};
    %  
    \node (oj1) at (0.3,0.62) {\small $\beta_{k+1}$};
    \node (ojd) at (0.8,0.6) {\small $\dots$};
    \node (ol) at (1.2,0.6) {\small $\beta_\ell$};
    %
    \node (i1) at (-1.2,-0.6) {\small $\alpha_1$};
    \node (id) at (-0.8,-0.6) {\small $\dots$};
    \node (im) at (-0.3,-0.6) {\small $\alpha_i$};
    %  
    \node (im1) at (0,-1.62) {\small $\alpha_{i+1}$};
    \node (imd) at (0.5,-1.6) {\small $\dots$};
    \node (ik) at (1,-1.6) {\small $\alpha_j$};
    %
    \node (2) at (-1.5,1.6) {\small $\boldsymbol{\beta}$};
    %
    \node (1) at (1.5,-1.6) {\small $\boldsymbol{\alpha}$};
    %
    \draw[->,thick] (1)--(N1); 
    \draw[->,thick] (N0)--(2); 
    %  
    \draw[->] (N0)--(o1); 
    \draw[->] (N0)--(od);
    \draw[->] (N0)--(oj);
    %    
    \draw[->] (N1)--(N0) node[midway, right] {$\gamma$} ; 
    \draw[->] (N1)--(oj1); 
    \draw[->] (N1)--(ojd);
    \draw[->] (N1)--(ol);
    %  
    \draw[->] (i1)--(N0);
    \draw[->] (id)--(N0);
    \draw[->] (im)--(N0); 
    %  
    \draw[->] (im1)--(N1); 
    \draw[->] (imd)--(N1);
    \draw[->] (ik)--(N1);
  \end{tikzpicture}
  }
  \caption{Spine flip.}
  \label{fig:generalFlip}
\end{figure}

\begin{figure}[h!]
  \centerline{
  \begin{tikzpicture}[baseline=0]
    \node (1) at (-0.5, 1.5) {$\blue 1$};
    \node (2) at (-0.5, -0.5) {$\blue \updown[2]$};
    \node (3) at (0, -1.5) {$\blue 3$};
    \node (4) at (-1, 2.5) {$\blue 4$};
    \node (5) at (0, 0.5) {$\blue \up[5]$};
    \node (6) at (0.5, 1.5) {$\blue 6$};
    \node (7) at (-1, -1.5) {$\blue \down[7]$};
    \node (8) at (-1.5, -2.5) {$\blue 8$};
    \node (9) at (1, 2.5) {$\blue \up[9]$};
  %
    \draw[->] (8)--(7); 
    \draw[->] (7)--(2); 
    \draw[->] (3)--(2); 
    \draw[->] (2)--(5) node[midway, left] {$\gamma$}; 
    \draw[->] (5)--(1); 
    \draw[->] (1)--(4); 
    \draw[->] (5)--(6); 
    \draw[->] (6)--(9); 
  \end{tikzpicture}
  %
  \begin{tikzpicture}[scale=1.2, baseline=0]
    \draw[->] (0,0)--(1,0); 
  \end{tikzpicture}
  %
  \begin{tikzpicture}[baseline=0]
    \node (1) at (0.5, 0.5) {$\blue 1$};
    \node (2) at (-0.5, 0.5) {$\blue \updown[2]$};
    \node (3) at (-1, -0.5) {$\blue 3$};
    \node (4) at (1, 1.5) {$\blue 4$};
    \node (5) at (0, -0.5) {$\blue \up[5]$};
    \node (6) at (-1, 1.5) {$\blue 6$};
    \node (7) at (0.5, -1.5) {$\blue \down[7]$};
    \node (8) at (1, -2.5) {$\blue 8$};
    \node (9) at (-1.5, 2.5) {$\blue \up[9]$};
    %
    \draw[->] (8)--(7); 
    \draw[->] (7)--(5); 
    \draw[->] (3)--(2); 
    \draw[->] (5)--(2) node[midway, right] {$\gamma$};  
    \draw[->] (5)--(1); 
    \draw[->] (1)--(4); 
    \draw[->] (2)--(6); 
    \draw[->] (6)--(9); 
  \end{tikzpicture}
  }
  \caption{Two maximal spines on the decorated block graph~$\decoratedGraph$ of \cref{fig:mapleBlock}, related by a flip. These are the two spines on~$\decoratedGraph$ that cover the middle spine of \cref{fig:spines}.}
  \label{fig:flip}
\end{figure} 

\begin{definition}
  \label{def:flip}
  Let $\decoratedGraph$ be a decorated block graph and let $\spine$ be a maximal spine on~$\decoratedGraph$.
  Consider two vertices $X = \{x\}$ and $Y = \{y\}$ of $\spine$ related by an arc $\gamma$. 
  Let $\alpha$ be the incoming arc of $X$ such that~$\so[\alpha]$ and~$Y$ are contained in the same connected component of $\Graph \ssm \Down[X]$, and let $\beta$ be the outgoing arc of $Y$ such that~$\ta[\beta]$ and~$X$ are contained in the same connected component of $\Graph \ssm \Up[Y]$.
  We define $\spine'$ to be the spine obtained from $\spine$ by reversing the orientation of~$\gamma$, grafting the arc~$\alpha$ to~$Y$ and the arc~$\beta$ to~$X$.
  We say that $\spine'$ is obtained from $\spine$ by \defn{flipping} the arc~$\gamma$. 
\end{definition}

\begin{lemma}
  Two corank~$0$ spines on~$\decoratedGraph$ are related by a flip if and only if they cover the same corank~$1$ spine on~$\decoratedGraph$.
\end{lemma}

\begin{proof}
  Let~$\spine,\spine'$ be two spines on~$\decoratedGraph$.
  If~$\spine$ and~$\spine$ are related by the flip of~$\gamma$, then contracting $\gamma$ in either $\spine$ or $\spine'$ clearly yields the same spine~$\spine''$.
  Conversely, assume that~$\spine$ and~$\spine'$ cover the same spine~$\spine''$, and let~$\gamma$ denote the arc contracted in~$\spine$ to obtain~$\spine''$.
  Then~$\spine'$ is obtained by flipping~$\gamma$ in~$\spine$, since otherwise we would obtain three distinct spines on~$\decoratedGraph$ covering~$\spine''$, which would contradict \cref{prop:pseudomanifold}.
\end{proof}

\begin{definition}
  \label{def:flipGraph}
  The \defn{flip graph} is the graph whose vertices are the maximal spines on~$\decoratedGraph$ and whose egdes are the flips between them.
  In other words, it is the dual graph of the chunk nested complex~$\nestedComplex$.
\end{definition}

Finally, we mention the following natural ways to orient the flip graph.

\begin{definition}
  \label{def:increasingFlip}
  Fix a total order~$\prec$ on~$\vertexSet$.
  The flip from~$\spine$ to~$\spine'$ in \cref{def:flip} is \defn{$\prec$-incresing} if~$x \prec y$ and \defn{$\prec$-decreasing} if $x \succ y$.
  The \defn{$\prec$-increasing flip graph} is the directed graph whose vertices are the maximal spines on~$\decoratedGraph$ and whose arcs are the increasing flips between them.
  The \defn{$\prec$-increasing flip poset} is the transitive closure of the $\prec$-increasing flip graph.
\end{definition}

For instance, the flip of \cref{fig:flip} is increasing with respect to the natural order on $V$.

\begin{example}
  \label{exm:flipPosets}
  For instance, the increasing flip poset is (isomorphic to):
  \begin{enumerate}[(i)]
    \item the \defn{weak order} on permutations of~$\vertexSet$ when $\decoratedGraph$ is complete or undecorated.
    \item the \defn{flip poset on maximal tubings} of~$\Graph$ studied in~\cite{BarnardMcConville} when~$\decoratedGraph$ is down decorated (in particular the classical \defn{Tamari lattice}~\cite{Tamari, HuangTamari} when~$\decoratedGraph$ is a down decorated path).
    \item the \defn{acyclic reorientation lattice} of~$\Graph$~\cite{Pilaud-acyclicReorientationLattices} when~$\decoratedGraph$ is fully decorated (in particular the \defn{boolean lattice} when~$\decoratedGraph$ is a fully decorated tree).
    \item the various \defn{permutree lattices} of~\cite{PilaudPons-permutrees} when~$\Graph$ is a path (in particular the various type~$A$ \defn{Cambrian lattices}~\cite{Reading-CambrianLattices} for up-down decorated paths).
  \end{enumerate}
\end{example}

\begin{remark}
  The question of whether or not the increasing flip poset is a lattice is a difficult question. It depends on the decoration $\decoration$. We know that if $\Graph$ is a path, it is always the case \cite{PilaudPons-permutrees}, for $\Graph$ a block graph it is generally not true. See \cite{BarnardMcConville}. \guillaume{Nos calculs?; donner un exemple, un contre-exemple}\vincent{improve this remark.}
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Labeled spines and blossoming spines}
\label{subsec:blossomingSpines}

For later purposes, we now add further information to a spine on~$\decoratedGraph$.
Here, we need to manipulate both the vertices and the cliques of~$\Graph$, thus we consider a maple tree~$\Maple$ corresponding to the block graph~$\Graph$.

\begin{definition}
  \label{def:labeledSpine}
  Let~$\decoratedMaple \eqdef (\Maple, \decoration)$ be a decorated maple tree and~$\decoratedGraph \eqdef (\Graph, \decoration)$ be the decorated block graph obtained by tapping~$\Maple$.
  In a spine~$\spine$ on~$\decoratedGraph$, we label
  \begin{itemize}
    \item each node~$X$ by the connected component~$\labeling(X)$ of~$\Maple \ssm \big( \Up[{\so[X]}] \cup \Down[{\ta[X]}] \big)$ containing~$X$,
%    \item each arc~$\gamma$ by the intersection~$\labeling(\gamma)$ of the connected component of~$\Maple \ssm \Up[{\so[\gamma]}]$ containing~$\ta[\gamma]$ with the connected component of~$\Maple \ssm \Down[{\ta[\gamma]}]$ containing~$\so[\gamma]$.
    \item each arc~$\gamma$ by the connected component~$\labeling(\gamma)$ of~$\Maple \ssm \big( \Up[{\so[\gamma]}] \cup \Down[{\ta[\gamma]}] \big)$ containing the red vertices of~$\Maple$ adjacent to both~$\so[\gamma]$ and~$\ta[\gamma]$. \guillaume{ce ne sont pas tous les sommets de $\Maple$?}
  \end{itemize}
  We say that the spine~$\spine$ with its labeling~$\labeling$ is a \defn{labeled spine}.
\end{definition}

\begin{remark}
  \label{rem:labeledSpine1}
  By definition, the labels of \cref{def:labeledSpine} are some maple subtrees of~$\Maple$.
  Note that a maple subtree of~$\Maple$ is completely determined by its leaves, hence by its red vertices.
  We thus simplify all pictures of labeled spines by writing only the red (letters) vertices of each label.
  For instance, \cref{fig:labeledSpines} illustrates this labeling for the two spines of \cref{fig:spines}.
%
\begin{figure}[h!]
  \centerline{
  \begin{tikzpicture}[baseline=0]
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (256) at (0,0) {$\blue \updown[2] \up[5] 6$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (14) at (-1, 2) {$\blue 1 4$};
    \node[label=east:{\scriptsize \red \textit{fgjk}}] (9) at (1, 2) {$\blue \up[9]$};
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (78) at (-1, -2) {$\blue \down[7] 8$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (1, -2) {$\blue 3$};
    %
    \draw[->] (256)--(14) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (256)--(9) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
    \draw[->] (78)--(256) node[midway, left] {\scriptsize \red \textit{adefghijk}}; 
    \draw[->] (3)--(256) node[midway, right] {\scriptsize \red \textit{bc}}; 
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}[baseline=0]
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (-0.5, 1) {$\blue 1$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (0.5, -1) {$\blue 3$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (4) at (-1, 2) {$\blue 4$};
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (25) at (0, 0) {$\blue \updown[2] \up[5]$};
    \node[label=east:{\scriptsize \red \textit{fgjk}}] (6) at (0.5, 1) {$\blue 6$};
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (7) at (-0.5, -1) {$\blue \down[7]$};
    \node[label=west:{\scriptsize \red \textit{adefghjk}}] (8) at (-1, -2) {$\blue 8$};
    \node[label=east:{\scriptsize \red \textit{jgjk}}] (9) at (1, 2) {$\blue \up[9]$};
    %
    \draw[->] (8)--(7) node[midway, left] {\scriptsize \red \textit{adefghjk}}; 
    \draw[->] (7)--(25) node[midway, left] {\scriptsize \red \textit{adefghijk}}; 
    \draw[->] (3)--(25) node[midway, right] {\scriptsize \red \textit{bc}}; 
    \draw[->] (25)--(1) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (1)--(4) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (25)--(6) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
    \draw[->] (6)--(9) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}[baseline=0]
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (-0.5, 1.5) {$\blue 1$};
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (2) at (-0.5, -0.5) {$\blue \updown[2]$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (0, -1.5) {$\blue 3$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (4) at (-1, 2.5) {$\blue 4$};
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (5) at (0, 0.5) {$\blue \up[5]$};
    \node[label=east:{\scriptsize \red \textit{fgjk}}] (6) at (0.5, 1.5) {$\blue 6$};
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (7) at (-1, -1.5) {$\blue \down[7]$};
    \node[label=west:{\scriptsize \red \textit{adefghjk}}] (8) at (-1.5, -2.5) {$\blue 8$};
    \node[label=east:{\scriptsize \red \textit{jgjk}}] (9) at (1, 2.5) {$\blue \up[9]$};
    %
    \draw[->] (8)--(7) node[midway, left] {\scriptsize \red \textit{adefghjk}}; 
    \draw[->] (7)--(2) node[midway, left] {\scriptsize \red \textit{adefghijk}}; 
    \draw[->] (3)--(2) node[midway, right] {\scriptsize \red \textit{bc}}; 
    \draw[->] (2)--(5) node[midway, left] {\scriptsize \red \textit{adefghijk}}; 
    \draw[->] (5)--(1) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (1)--(4) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (5)--(6) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
    \draw[->] (6)--(9) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
  \end{tikzpicture}
  }
  \caption{The labeled versions of the three spines of \cref{fig:spines}. We only write the red vertices of each label (see \cref{rem:labeledSpine1}).}
  \label{fig:labeledSpines}
\end{figure} 
\end{remark}

\begin{remark}
  \label{rem:labeledSpine2}
  The labeling~$\labeling$ of \cref{def:labeledSpine} can be described alternatively using \cref{coro:splittablePartitions}.
  For any arc~$\gamma$ in a spine~$\spine$, denote by~$C_\gamma$ the connected component of~$\Maple \ssm \Up[{\so[\gamma]}]$ containing~$\ta[\gamma]$ and by~$C^\gamma$ the connected component of~$\Maple \ssm \Down[{\ta[\gamma]}]$ containing~$\so[\gamma]$.
%  For any arc~$\gamma$ in a spine~$\spine$, denote by~$C_\gamma$ (resp.~$C^\gamma$) the connected component of~$\Maple \ssm \Up[{\so[\gamma]}]$ (resp.~$\Maple \ssm \Down[{\ta[\gamma]}]$) containing~$\ta[\gamma]$ (resp.~$\so[\gamma]$).
  Then 
  \begin{itemize}
    \item $\labeling(X) = \bigcap_\alpha C_\alpha \; \cap \; \bigcap_\beta C^\beta$ where $\alpha$ (resp.~$\beta$) runs over incoming (resp.~outgoing) arcs~of~$X$,
    \item $\labeling(\gamma) = C_\gamma \cap C^\gamma$.
  \end{itemize}     
\end{remark}

\begin{lemma}
  \label{lem:labeledSpine}
%  We have~$\labeling(\alpha) \cap \labeling(\alpha') = \varnothing$ for two incoming arcs~$\alpha, \alpha'$ at the same node~$X$ of~$\spine$.
  We have~$\labeling(\gamma) \cap \labeling(\gamma') = \varnothing$ for any two distinct arcs~$\gamma, \gamma'$ incoming at (resp.~outgoing from) the same node of~$\spine$.
\end{lemma}

\begin{proof}
  Assume for instance that~$\alpha, \alpha'$ are distinct incoming arcs at a node~$X$ of~$\spine$.
  By \cref{def:spine}, the source sets~$\so[\alpha]$ and~$\so[\alpha']$ belong to distinct connected components~$C$ and~$C'$ of~$\Maple \ssm \Down[X]$.
  Moreover, $\labeling(\alpha) \subseteq C$ since~$X \subseteq \ta[\alpha]$ and similarly~$\labeling(\alpha') \subseteq C'$.
  Hence~$\labeling(\alpha) \cap \labeling(\alpha') = \varnothing$.
\end{proof}

We now add a little more to a labeled spine.
This is not strictly needed for the purposes of the next section, but it enlightens the picture and will simplify some proofs in later sections.
\vincent{also needed for the operad part...}

\begin{definition}
  \label{def:blossomingTree}
  A \defn{directed blossoming tree} is a directed tree~$\spine$ with some additional 
  \begin{itemize}
    \item \defn{incoming blossoms} (arcs joining an empty node to a normal node) and 
    \item \defn{outgoing blossoms} (arcs joining a normal node to an empty node).
  \end{itemize}
  A \defn{cut} of a directed blossoming tree~$\spine$ is a set~$\Gamma$ of nodes, arcs and blossoms of~$\spine$ such that any directed path joining the source of an incoming blossom of~$\spine$ to the target of an outgoing blossom of~$\spine$ contains precisely one element of~$\Gamma$.
  When the nodes of~$\spine$ are sets, the \defn{source set}~$\so[\Gamma]$ (resp.~\defn{target set}~$\ta[\Gamma]$) of~$\Gamma$ is the union of the nodes of all connected components of~$\spine \ssm \Gamma$ which contain the source (resp.~target) of an incoming blossom.
  For instance, the set of incoming (resp.~outgoing) blossoms is a cut of~$\spine$ whose source (resp.~target) set is empty and whose target (resp.~source) set is the union of the nodes of~$\spine$.
\end{definition}

\begin{definition}
  \label{def:blossomingSpine}
  Let~$\decoratedMaple \eqdef (\Maple, \decoration)$ be a decorated maple tree, let~$\decoratedGraph \eqdef (\Graph, \decoration)$ be the decorated block graph obtained by tapping~$\Maple$, and let~$\spine$ be a spine on~$\decoratedGraph$.
  The \defn{blossoming spine}~$\spine^\blossom$ is the labeled blossoming tree obtained from the labeled spine~$\spine$ by a adding at each node~$X$ of~$\spine$ an incoming (resp.~outgoing) blossom labeled by~$C$ for each connected component~$C$ of~$\Maple \ssm \Down[\vertexSet]$ (resp.~of~$\Maple \ssm \Up[\vertexSet]$) adjacent to~$X$ such that there is no incoming arc~$\alpha$ (resp.~outgoing arc~$\beta$) of~$X$ with~$\so[\alpha]$ (resp.~$\ta[\beta]$) contained in~$C$.
\end{definition}

\begin{remark}
  \label{rem:blossomingSpine}
  As in \cref{rem:labeledSpine1}, it is sufficient in the pictures to write only the red vertices of each label.
  For instance, \cref{fig:blossomingSpines} illustrates the blossoming spines of the two spines of \cref{fig:spines}.
%
\begin{figure}[h!]
  \centerline{
  \begin{tikzpicture}[baseline=0]
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (256) at (0,0) {$\blue \updown[2] \up[5] 6$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (14) at (-1, 2) {$\blue 1 4$};
    \node[label=east:{\scriptsize \red \textit{fgjk}}] (9) at (1, 2) {$\blue \up[9]$};
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (78) at (-1, -2) {$\blue \down[7] 8$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (1, -2) {$\blue 3$};
    \node (i) at (-0.5, -3) {};
    \node (adefghjk) at (-1.5, -3) {};
    \node (bc) at (1.5, -3) {};
    \node (bc') at (.8, 0.7) {};
    \node (hi') at (0, 1) {};
    \node (ade') at (-1.5, 3) {};
    \node (fgj') at (0.5, 3) {};
    \node (k') at (1.5, 3) {};
    %
    \draw[->] (256)--(14) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (256)--(9) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
    \draw[->] (78)--(256) node[midway, left] {\scriptsize \red \textit{adefghijk}}; 
    \draw[->] (3)--(256) node[midway, right] {\scriptsize \red \textit{bc}}; 
    \draw[->] (i)--(78) node[midway, right] {\scriptsize \red \textit{i}}; 
    \draw[->] (adefghjk)--(78) node[midway, left] {\scriptsize \red \textit{adefghjk}};
    \draw[->] (bc)--(3) node[midway, right] {\scriptsize \red \textit{bc}}; 
    \draw[->] (9)--(k') node[midway, right] {\scriptsize \red \textit{k}}; 
    \draw[->] (9)--(fgj') node[midway, left] {\scriptsize \red \textit{fgj}};
    \draw[->] (14)--(ade') node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (256)--(bc') node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (256)--(hi') node[midway, left] {\scriptsize \red \textit{hi}};
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}[baseline=0]
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (-0.5, 1) {$\blue 1$};
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (25) at (0, 0) {$\blue \updown[2] \up[5]$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (0.5, -1) {$\blue 3$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (4) at (-1, 2) {$\blue 4$};
    \node[label=east:{\scriptsize \red \textit{fgjk}}] (6) at (0.5, 1) {$\blue 6$};
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (7) at (-.5, -1) {$\blue \down[7]$};
    \node[label=west:{\scriptsize \red \textit{adefghjk}}] (8) at (-1, -2) {$\blue 8$};
    \node[label=east:{\scriptsize \red \textit{jgjk}}] (9) at (1, 2) {$\blue \up[9]$};
    \node (adefghjk) at (-1.5, -3) {};
    \node (i) at (0, -2) {};
    \node (bc) at (1, -2) {};
    \node (bc') at (1.1, .1) {};
    \node (hi') at (1, .5) {};
    \node (ade') at (-1.5, 3) {};
    \node (fgj') at (0.5, 3) {};
    \node (k') at (1.5, 3) {};
    %
    \draw[->] (8)--(7) node[midway, left] {\scriptsize \red \textit{adefghjk}}; 
    \draw[->] (7)--(25) node[midway, left] {\scriptsize \red \textit{adefghijk}}; 
    \draw[->] (3)--(25) node[midway, right] {\scriptsize \red \textit{bc}}; 
    \draw[->] (25)--(1) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (1)--(4) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (25)--(6) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
    \draw[->] (6)--(9) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
    \draw[->] (4)--(ade') node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (9)--(fgj') node[midway, left] {\scriptsize \red \textit{fgj}}; 
    \draw[->] (9)--(k') node[midway, right] {\scriptsize \red \textit{k}}; 
    \draw[->] (adefghjk)--(8) node[midway, left] {\scriptsize \red \textit{adefghjk}}; 
    \draw[->] (i)--(7) node[midway, right] {\scriptsize \red \textit{i}}; 
    \draw[->] (bc)--(3) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (25)--(bc') node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (25)--(hi') node[midway, right] {\scriptsize \red \textit{hi}};
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}[baseline=0]
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (-0.5, 1.5) {$\blue 1$};
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (2) at (-0.5, -0.5) {$\blue \updown[2]$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (0, -1.5) {$\blue 3$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (4) at (-1, 2.5) {$\blue 4$};
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (5) at (0, 0.5) {$\blue \up[5]$};
    \node[label=east:{\scriptsize \red \textit{fgjk}}] (6) at (0.5, 1.5) {$\blue 6$};
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (7) at (-1, -1.5) {$\blue \down[7]$};
    \node[label=west:{\scriptsize \red \textit{adefghjk}}] (8) at (-1.5, -2.5) {$\blue 8$};
    \node[label=east:{\scriptsize \red \textit{jgjk}}] (9) at (1, 2.5) {$\blue \up[9]$};
    \node (adefghjk) at (-2, -3.5) {};
    \node (i) at (-0.5, -2.5) {};
    \node (bc) at (0.5, -2.5) {};
    \node (bc') at (.5, -.2) {};
    \node (hi') at (1, .8) {};
    \node (ade') at (-1.5, 3.5) {};
    \node (fgj') at (0.5, 3.5) {};
    \node (k') at (1.5, 3.5) {};
    %
    \draw[->] (8)--(7) node[midway, left] {\scriptsize \red \textit{adefghjk}}; 
    \draw[->] (7)--(2) node[midway, left] {\scriptsize \red \textit{adefghijk}}; 
    \draw[->] (3)--(2) node[midway, right] {\scriptsize \red \textit{bc}}; 
    \draw[->] (2)--(5) node[midway, left] {\scriptsize \red \textit{adefghijk}}; 
    \draw[->] (5)--(1) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (1)--(4) node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (5)--(6) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
    \draw[->] (6)--(9) node[midway, right] {\scriptsize \red \textit{fgjk}}; 
    \draw[->] (4)--(ade') node[midway, left] {\scriptsize \red \textit{ade}}; 
    \draw[->] (9)--(fgj') node[midway, left] {\scriptsize \red \textit{fgj}}; 
    \draw[->] (9)--(k') node[midway, right] {\scriptsize \red \textit{k}}; 
    \draw[->] (adefghjk)--(8) node[midway, left] {\scriptsize \red \textit{adefghjk}}; 
    \draw[->] (i)--(7) node[midway, right] {\scriptsize \red \textit{i}}; 
    \draw[->] (bc)--(3) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (2)--(bc') node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (5)--(hi') node[midway, right] {\scriptsize \red \textit{hi}};
  \end{tikzpicture}
  }
  \caption{The blossoming versions of the three spines of \cref{fig:spines}. We only write the red vertices of each label (see \cref{rem:blossomingSpine}). For any cut of these spines, the labels of the nodes, arcs and blossoms in this cut form a partition of \textit{abcdefghijk} (see \cref{prop:blossomingSpine}).}
  \label{fig:blossomingSpines}
\end{figure}
\end{remark}

\begin{proposition}
  \label{prop:blossomingSpine}
  Let~$\decoratedMaple \eqdef (\Maple, \decoration)$ be a decorated maple tree, let~$\decoratedGraph \eqdef (\Graph, \decoration)$ be the decorated block graph obtained by tapping~$\Maple$, and let~$\spine$ be a spine on~$\decoratedGraph$.
  For any cut~$\Gamma$ of~$\spine^\blossom$, the labels of the nodes, arcs and blossoms of~$\Gamma$ are precisely the connected components of~$\Maple \ssm \big( \Up[{\so[\Gamma]}] \cup \Down[{\ta[\Gamma]}] \big)$.
\end{proposition}

\begin{proof}
  We prove the result by sweeping the blossoming spine~$\spine^\blossom$.

  The base case is the cut~$\Gamma_\circ$ of~$\spine^\blossom$ consisting of all its incoming blossoms, which are labeled by the connected components of~$\Maple \ssm \Down[\vertexSet]$.
  Indeed, the label of any incoming blossom is a connected component of~$\Maple \ssm \Down[\vertexSet]$ by definition.
  Conversely, for any connected component~$C$ of~$\Maple \ssm \Down[\vertexSet]$, the set of nodes of~$\spine$ adjacent to~$C$ forms a chain in~$\spine$ by \cref{def:spine}, and~$C$ appears as an incoming blossom of the minimal node of~$\spine$ in this chain.
  
%  Consider now a node~$X$ of~$\spine^\blossom$, and let~$A$ denote its set of incoming arcs and blossoms.
  Consider now two cuts~$\Gamma$ and~$\Gamma'$ of~$\spine^\blossom$ such that~$\Gamma \ssm A = \Gamma' \ssm \{X\}$ where~$A$ is the set of incoming arcs and blossoms of a node~$X$ of~$\spine^\blossom$.
  Note that the sets~$\labeling(\alpha)$ for~$\alpha \in A$ are precisely the connected components of~$\Maple \ssm \big( \Up[{\so[\Gamma]}] \cup \Down[{\ta[\Gamma]}] \big)$ adjacent to~$X$, and that $\labeling(X)$ is the connected component of~$\Maple \ssm \big( \Up[{\so[\Gamma']}] \cup \Down[{\ta[\Gamma']}] \big)$ containing~$X$.
  We conclude that if the result holds for~$\Gamma$, then it also holds for~$\Gamma'$.
  The argument is symmetric for two cuts~$\Gamma$ and~$\Gamma'$ of~$\spine^\blossom$ such that~$\Gamma \ssm \{X\} = \Gamma' \ssm B$ where~$B$ is the set of outgoing arcs and blossoms of a node~$X$ of~$\spine^\blossom$.
  The result thus follows since any cut of~$\spine^\blossom$ can be obtained from the cut~$\Gamma_\circ$ by a sequence of such moves.
\end{proof}
%
%\begin{figure}[h!]
%  \begin{tikzpicture}
%    \node (0) at (0, 0) {$\updown[2] \up[5] 6$};
%    \node (1) at (-3, 1) {$ade$};
%    \node (2) at (-1, 1) {$hi$};
%    \node (3) at (1, 1) {$fgjk$};
%    \node (4) at (3, 1) {$bc$};
%    \node (5) at (3, 3) {$bc$};
%    \node (6) at (1.5, 3) {$k$};
%    \node (7) at (0.5, 3) {$fgj$};
%    \node (8) at (-1, 3) {$hi$};
%    \node (9) at (-3, 3) {$ade$};
%    \node (10) at (1, 2) {$\up[9]$};
%    \node (11) at (-3, 2) {$14$};
%    \node (12) at (-1, -1) {$adefghijk$};
%    \node (13) at (1, -1) {$bc$};
%    \node (14) at (-1, -2) {$\down[7] 8$};
%    \node (15) at (1, -2) {$3$};
%    \node (16) at (-2, -3) {$adefghjk$};
%    \node (17) at (0, -3) {$i$};
%    \node (18) at (1, -3) {$bc$};
%    \draw[->] (18)--(15);
%    \draw[->] (17)--(14);
%    \draw[->] (16)--(14);
%    \draw[->] (15)--(13);
%    \draw[->] (14)--(12);
%    \draw[->] (13)--(0);
%    \draw[->] (12)--(0);
%    \draw[->] (0)--(1);
%    \draw[->] (0)--(2);
%    \draw[->] (0)--(3);
%    \draw[->] (0)--(4);
%    \draw[->] (1)--(11);
%    \draw[->] (2)--(8);
%    \draw[->] (3)--(10);
%    \draw[->] (4)--(5);
%    \draw[->] (11)--(9);
%    \draw[->] (10)--(7);
%    \draw[->] (10)--(6);
%    \draw[dotted] (-5,-3)--(16)--(17)--(18)--(5,-3);
%    \draw[dashed] (-5,-2)--(14)--(15)--(5,-2);
%    \draw[dotted] (-5,-1)--(12)--(13)--(5,-1);
%    \draw[dashed] (-5,0)--(0)--(5,0);
%    \draw[dotted] (-5,1)--(1)--(2)--(3)--(4)--(5,1);
%    \draw[dashed] (-5,2)--(11)--(10)--(5,2);
%    \draw[dotted] (-5,3)--(9)--(8)--(7)--(6)--(5)--(5,3);
%    \node (20) at (5.5, -3) {$\down[2] \down[7]$};
%    \node (21) at (5.5, -2) {$\down[2]$};
%    \node (22) at (5.5, -1) {$\down[2]$};
%    \node (23) at (5.5, 0) {};
%    \node (24) at (5.5, 1) {$\up[2] \up[5]$};
%    \node (25) at (5.5, 2) {$\up[2] \up[5]$};
%    \node (26) at (5.5, 3) {$\up[2] \up[5] \up[9]$};
%  \end{tikzpicture}
%  \caption{A blossoming spine on the maple tree of \cref{fig:mapleBlock}, reconstructed from $\pi = 3 \down[7] 8 | \updown[2] \up[5] 6 | 149$.}
%  \label{fig:blossomingSpine}
%\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Refinement and surjection maps}
\label{subsec:surjectionMaps}

We now consider a natural refinement order on decorated block graphs and define natural surjections between the spines of refining decorated block graphs.

\begin{definition}
  \label{def:refinementDecoratedGraphs}
  For two decorations~$\decoration_\circ$ and~$\decoration_\bullet$ on a set~$\vertexSet$, we say that~$\decoration_\circ$ \defn{refines}~$\decoration_\bullet$ (and that $\decoration_\bullet$ \defn{coarsens} $\decoration_\circ$) if~$\Down[\vertexSet][\decoration_\circ] \subseteq \Down[\vertexSet][\decoration_\bullet]$ and $\Up[\vertexSet][\decoration_\circ] \subseteq \Up[\vertexSet][\decoration_\bullet]$.
  For two decorated block graphs~$\decoratedGraph_\circ \eqdef (\Graph_\circ, \decoration_\circ)$ and~$\decoratedGraph_\bullet \eqdef (\Graph_\bullet, \decoration_\bullet)$, we say that~$\decoratedGraph_\circ$ \defn{refines}~$\decoratedGraph_\bullet$ (and that $\decoratedGraph_\bullet$ \defn{coarsens} $\decoratedGraph_\circ$) if~$\Graph_\circ = \Graph_\bullet$ and~$\decoration_\circ$~refines~$\decoration_\bullet$.
\end{definition}

\begin{figure}
  \centerline{
  \begin{tikzpicture}[scale=.7]  
    \node (1) at (-4, 4) {$\blue 1$};
    \node (2) at (0, 4) {$\blue \down[2]$};
    \node (3) at (2, 4) {$\blue 3$};
    \node (4) at (-4, 2) {$\blue 4$};
    \node (5) at (-2, 2) {$\blue \up[5]$};
    \node (6) at (2, 2) {$\blue 6$};
    \node (7) at (-4, 0) {$\blue 7$};
    \node (8) at (0, 0) {$\blue 8$};
    \node (9) at (2, 0) {$\blue 9$};
    %
    \node (a) at (-5, 4) {$\red a$};
    \node (b) at (1, 4) {$\red b$};
    \node (c) at (3, 4) {$\red c$};
    \node (d) at (-3, 3) {$\red d$};
    \node (e) at (-5, 2) {$\red e$};
    \node (f) at (0, 2) {$\red f$};
    \node (g) at (3, 2) {$\red g$};
    \node (h) at (-3, 1) {$\red h$};
    \node (i) at (-5, 0) {$\red i$};
    \node (j) at (1, 0) {$\red j$};
    \node (k) at (3, 0) {$\red k$};
    %
    \draw[-] (a)--(1)--(d)--(4)--(e); 
    \draw[-] (d)--(5)--(h)--(7)--(i); 
    \draw[-] (5)--(f)--(6)--(g); 
    \draw[-] (c)--(3)--(b)--(2)--(f)--(8)--(j)--(9)--(k); 
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}[scale=.7]  
    \node (1) at (-4, 4) {$\blue 1$};
    \node (2) at (0, 4) {$\blue \updown[2]$};
    \node (3) at (2, 4) {$\blue 3$};
    \node (4) at (-4, 2) {$\blue 4$};
    \node (5) at (-2, 2) {$\blue \updown[5]$};
    \node (6) at (2, 2) {$\blue \up[6]$};
    \node (7) at (-4, 0) {$\blue \down[7]$};
    \node (8) at (0, 0) {$\blue \updown[8]$};
    \node (9) at (2, 0) {$\blue 9$};
    %
    \node (a) at (-5, 4) {$\red a$};
    \node (b) at (1, 4) {$\red b$};
    \node (c) at (3, 4) {$\red c$};
    \node (d) at (-3, 3) {$\red d$};
    \node (e) at (-5, 2) {$\red e$};
    \node (f) at (0, 2) {$\red f$};
    \node (g) at (3, 2) {$\red g$};
    \node (h) at (-3, 1) {$\red h$};
    \node (i) at (-5, 0) {$\red i$};
    \node (j) at (1, 0) {$\red j$};
    \node (k) at (3, 0) {$\red k$};
    %
    \draw[-] (a)--(1)--(d)--(4)--(e); 
    \draw[-] (d)--(5)--(h)--(7)--(i); 
    \draw[-] (5)--(f)--(6)--(g); 
    \draw[-] (c)--(3)--(b)--(2)--(f)--(8)--(j)--(9)--(k); 
  \end{tikzpicture}
  }
  \caption{The left decorated maple tree~$\decoratedMaple$ refines the right decorated maple tree~$\decoratedMaple'$.}
  \label{fig:refinementDecoratedGraphs}
\end{figure} 

\begin{figure}[h!]
  \centerline{    
  \begin{tikzpicture}
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (79) at (0,1) {$\blue 7 9$};
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (248) at (0,2) {$\blue \down[2] 4 8$};
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (35) at (0,3) {$\blue 3 \up[5]$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (-.5,4) {$\blue 1$};
    \node[label=east:{\scriptsize \red \textit{bcfgjk}}] (6) at (.5,4) {$\blue 6$};
    %
    \draw[->] (79)--(248) node[midway, left] {\scriptsize \red \textit{adefghijk}};
    \draw[->] (248)--(35) node[midway, left] {\scriptsize \red \textit{abcdefghijk}};
    \draw[->] (35)--(1) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (35)--(6) node[midway, right] {\scriptsize \red \textit{bcfgjk}};
  \end{tikzpicture}
  %
  \qquad
  %
  \begin{tikzpicture}
    \node[label=east:{\scriptsize \red \textit{hi}}] (7) at (1,1) {$\blue \down[7]$};
    \node[label=east:{\scriptsize \red \textit{jk}}] (9) at (3,1) {$\blue 9$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (4) at (0,2) {$\blue 4$};
    \node[label=east:{\scriptsize \red \textit{bcfgjk}}] (28) at (3,2) {$\blue \updown[2] \updown[8]$};
    \node[label=west:{\scriptsize \red \textit{adefghi}}] (5) at (1,3) {$\blue \updown[5]$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (4,3) {$\blue 3$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (0,4) {$\blue 1$};
    \node[label=east:{\scriptsize \red \textit{fg}}] (6) at (2,4) {$\blue \up[6]$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (e1) at (0,1) {$\blue \varnothing$};
    \node[label=west:{\scriptsize \red \textit{fg}}] (e2) at (2,1) {$\blue \varnothing$};
    \node[label=east:{\scriptsize \red \textit{hi}}] (e3) at (1,2) {$\blue \varnothing$};
    \node[label=west:{\scriptsize \red \textit{jk}}] (e4) at (3,3) {$\blue \varnothing$};
    \node[label=west:{\scriptsize \red \textit{jk}}] (e5) at (3,4) {$\blue \varnothing$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (e6) at (4,4) {$\blue \varnothing$};
    %
    \draw[->] (e1)--(4) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (7)--(e3) node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (e2)--(28) node[midway, left] {\scriptsize \red \textit{fg}};
    \draw[->] (9)--(28) node[midway, right] {\scriptsize \red \textit{jk}};
    \draw[->] (4)--(5) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (e3)--(5) node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (28)--(5) node[midway, right] {\scriptsize \red \textit{fg}};
    \draw[->] (28)--(e4) node[midway, left] {\scriptsize \red \textit{jk}};
    \draw[->] (28)--(3) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (5)--(1) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (5)--(6) node[midway, right] {\scriptsize \red \textit{fg}};
    \draw[->] (e4)--(e5) node[midway, left] {\scriptsize \red \textit{jk}};
    \draw[->] (3)--(e6) node[midway, right] {\scriptsize \red \textit{bc}};
  \end{tikzpicture}    
  %
  \qquad
  %
  \begin{tikzpicture}
    \node[label=east:{\scriptsize \red \textit{hi}}] (7) at (1,1) {$\blue \down[7]$};
    \node[label=east:{\scriptsize \red \textit{jk}}] (9) at (2.5,1) {$\blue 9$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (4) at (0,2) {$\blue 4$};
    \node[label=east:{\scriptsize \red \textit{bcfgjk}}] (28) at (2.5,2) {$\blue \updown[2] \updown[8]$};
    \node[label=west:{\scriptsize \red \textit{adefghi}}] (5) at (1,3) {$\blue \updown[5]$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (2.5,3) {$\blue 3$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (0,4) {$\blue 1$};
    \node[label=east:{\scriptsize \red \textit{fg}}] (6) at (2,4) {$\blue \up[6]$};
    %
    \draw[->] (7)--(5) node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (9)--(28) node[midway, right] {\scriptsize \red \textit{jk}};
    \draw[->] (4)--(5) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (28)--(5) node[midway, right] {\scriptsize \red \textit{fg}};
    \draw[->] (28)--(3) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (5)--(1) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (5)--(6) node[midway, right] {\scriptsize \red \textit{fg}};
  \end{tikzpicture}
  }
  \caption{A spine~$\spine_\circ$ on~$\decoratedMaple_\circ$ (left) and the spine~$\spine_\bullet = \surjectionSpines(\spine_\circ)$ on~$\decoratedMaple_\bullet$ (right) obtained by contracting the empty node in the directed tree~$\almostSpine_\bullet$ (middle) defined in \cref{def:refinementSpines}.}
  \label{fig:refinementSpines}
\end{figure} 

\begin{figure}[h!]
  \centerline{    
  \begin{tikzpicture}
    \node[label=west:{\scriptsize \red \textit{adefghijk}}] (79) at (0,1) {$\blue 7 9$};
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (248) at (0,2) {$\blue \down[2] 4 8$};
    \node[label=west:{\scriptsize \red \textit{abcdefghijk}}] (35) at (0,3) {$\blue 3 \up[5]$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (-1,4) {$\blue 1$};
    \node[label=east:{\scriptsize \red \textit{bcfgjk}}] (6) at (1,4) {$\blue 6$};
    \node (adefghijk) at (0,0) {};
    \node (bc) at (.8,1.2) {};
    \node (ade') at (-1,5) {};
    \node (hi') at (0,4) {};
    \node (bcfgjk') at (1,5) {};
    %
    \draw[->] (adefghijk)--(79) node[midway, left] {\scriptsize \red \textit{adefghijk}};
    \draw[->] (79)--(248) node[midway, left] {\scriptsize \red \textit{adefghijk}};
    \draw[->] (bc)--(248) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (248)--(35) node[midway, left] {\scriptsize \red \textit{abcdefghijk}};
    \draw[->] (35)--(1) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (35)--(6) node[midway, right] {\scriptsize \red \textit{bcfgjk}};
    \draw[->] (35)--(hi') node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (1)--(ade') node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (6)--(bcfgjk') node[midway, right] {\scriptsize \red \textit{bcfgjk}};
  \end{tikzpicture}
  %
  \quad
  %
  \begin{tikzpicture}
    \node[label=east:{\scriptsize \red \textit{hi}}] (7) at (1.5,1) {$\blue \down[7]$};
    \node[label=east:{\scriptsize \red \textit{jk}}] (9) at (4,1) {$\blue 9$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (4) at (0,2) {$\blue 4$};
    \node[label=east:{\scriptsize \red \textit{bcfgjk}}] (28) at (4,2) {$\blue \updown[2] \updown[8]$};
    \node[label=west:{\scriptsize \red \textit{adefghi}}] (5) at (1.5,3) {$\blue \updown[5]$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (5,3) {$\blue 3$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (0.5,4) {$\blue 1$};
    \node[label=east:{\scriptsize \red \textit{fg}}] (6) at (2.5,4) {$\blue \up[6]$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (e1) at (0,1) {$\blue \varnothing$};
    \node[label=west:{\scriptsize \red \textit{fg}}] (e2) at (3,1) {$\blue \varnothing$};
    \node[label=east:{\scriptsize \red \textit{hi}}] (e3) at (1.5,2) {$\blue \varnothing$};
    \node[label=west:{\scriptsize \red \textit{jk}}] (e4) at (4,3) {$\blue \varnothing$};
    \node[label=west:{\scriptsize \red \textit{jk}}] (e5) at (4,4) {$\blue \varnothing$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (e6) at (5,4) {$\blue \varnothing$};
    \node (ade) at (0,0) {};
    \node (h) at (1,0) {};
    \node (i) at (2,0) {};
    \node (fg) at (3,0) {};
    \node (jk) at (4,0) {};
    \node (bc) at (4.8,1.2) {};
    \node (ade') at (0.5,5) {};
    \node (f') at (2,5) {};
    \node (g') at (3,5) {};
    \node (jk') at (4,5) {};
    \node (bc') at (5,5) {};
    \node (hi') at (1.5,4) {};
    %
    \draw[->] (ade)--(e1) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (h)--(7) node[midway, left] {\scriptsize \red \textit{h}};
    \draw[->] (i)--(7) node[midway, right] {\scriptsize \red \textit{i}};
    \draw[->] (fg)--(e2) node[midway, left] {\scriptsize \red \textit{fg}};
    \draw[->] (jk)--(9) node[midway, right] {\scriptsize \red \textit{jk}};
    \draw[->] (e1)--(4) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (7)--(e3) node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (e2)--(28) node[midway, left] {\scriptsize \red \textit{fg}};
    \draw[->] (9)--(28) node[midway, right] {\scriptsize \red \textit{jk}};
    \draw[->] (bc)--(28) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (4)--(5) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (e3)--(5) node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (28)--(5) node[midway, right] {\scriptsize \red \textit{fg}};
    \draw[->] (28)--(e4) node[midway, left] {\scriptsize \red \textit{jk}};
    \draw[->] (28)--(3) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (5)--(1) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (5)--(hi') node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (5)--(6) node[midway, right] {\scriptsize \red \textit{fg}};
    \draw[->] (e4)--(e5) node[midway, left] {\scriptsize \red \textit{jk}};
    \draw[->] (3)--(e6) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (1)--(ade') node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (6)--(f') node[midway, right] {\scriptsize \red \textit{f}};
    \draw[->] (6)--(g') node[midway, right] {\scriptsize \red \textit{g}};
    \draw[->] (e5)--(jk') node[midway, left] {\scriptsize \red \textit{jk}};
    \draw[->] (e6)--(bc') node[midway, right] {\scriptsize \red \textit{bc}};
  \end{tikzpicture}    
  %
  \quad
  %
  \begin{tikzpicture}
    \node[label=east:{\scriptsize \red \textit{hi}}] (7) at (1,1) {$\blue \down[7]$};
    \node[label=east:{\scriptsize \red \textit{jk}}] (9) at (3,1) {$\blue 9$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (4) at (0,2) {$\blue 4$};
    \node[label=east:{\scriptsize \red \textit{bcfgjk}}] (28) at (3,2) {$\blue \updown[2] \updown[8]$};
    \node[label=west:{\scriptsize \red \textit{adefghi}}] (5) at (1,3) {$\blue \updown[5]$};
    \node[label=east:{\scriptsize \red \textit{bc}}] (3) at (4,3) {$\blue 3$};
    \node[label=west:{\scriptsize \red \textit{ade}}] (1) at (0,4) {$\blue 1$};
    \node[label=east:{\scriptsize \red \textit{fg}}] (6) at (2,4) {$\blue \up[6]$};
    \node (ade) at (0,1) {};
    \node (h) at (.5,0) {};
    \node (i) at (1.5,0) {};
    \node (fg) at (2,1) {};
    \node (jk) at (3,0) {};
    \node (bc) at (3.8,1.2) {};
    \node (ade') at (0,5) {};
    \node (f') at (1.5,5) {};
    \node (g') at (2.5,5) {};
    \node (jk') at (3,3) {};
    \node (bc') at (4,4) {};
    \node (hi') at (1,4) {};
    %
    \draw[->] (ade)--(4) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (h)--(7) node[midway, left] {\scriptsize \red \textit{h}};
    \draw[->] (i)--(7) node[midway, right] {\scriptsize \red \textit{i}};
    \draw[->] (fg)--(28) node[midway, left] {\scriptsize \red \textit{fg}};
    \draw[->] (jk)--(9) node[midway, right] {\scriptsize \red \textit{jk}};
    \draw[->] (7)--(5) node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (9)--(28) node[midway, right] {\scriptsize \red \textit{jk}};
    \draw[->] (bc)--(28) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (4)--(5) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (28)--(5) node[midway, right] {\scriptsize \red \textit{fg}};
    \draw[->] (28)--(jk') node[midway, left] {\scriptsize \red \textit{jk}};
    \draw[->] (28)--(3) node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (5)--(1) node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (5)--(hi') node[midway, right] {\scriptsize \red \textit{hi}};
    \draw[->] (5)--(6) node[midway, right] {\scriptsize \red \textit{fg}};
    \draw[->] (3)--(bc') node[midway, right] {\scriptsize \red \textit{bc}};
    \draw[->] (1)--(ade') node[midway, left] {\scriptsize \red \textit{ade}};
    \draw[->] (6)--(f') node[midway, right] {\scriptsize \red \textit{f}};
    \draw[->] (6)--(g') node[midway, right] {\scriptsize \red \textit{g}};
  \end{tikzpicture}
  }
  \caption{A blossoming spine~$\spine_\circ^\blossom$ on~$\decoratedMaple_\circ$ (left) and the blossoming spine~$\spine_\bullet^\blossom = \surjectionSpines(\spine_\circ^\blossom)$ on~$\decoratedMaple_\bullet$ (right) obtained by contracting the empty node in the directed tree~$\almostSpine_\bullet^\blossom$ (middle) defined in \cref{def:refinementSpines,rem:refinementBlossomingSpine}.}
  \label{fig:refinementBlossomingSpines}
\end{figure} 

Throughout this section, we assume that $\decoratedGraph_\circ$ refines~$\decoratedGraph_\bullet$.
Our objective is to define and describe a natural surjection~$\surjectionSpines$ from the spines on~$\decoratedGraph_\circ$ to the spines on~$\decoratedGraph_\bullet$.
The key property of~$\surjectionSpines$ is given in \cref{thm:alternativeDescriptionRefinementSpines}, and should morally be considered as the definition of~$\surjectionSpines$.
However, proving this property requires the following explicit combinatorial description of~$\surjectionSpines$, which is illustrated in \cref{fig:refinementSpines}.
Note that in contrast to~\cite{Pilaud-signedTreeAssociahedra}, this description does not anymore require a sweeping algorithm.
Instead, it is based on the labeling~$\labeling$ of the nodes and arcs of the spines described in \cref{def:labeledSpine}.

\begin{definition}
  \label{def:refinementSpines}
  Let~$\Maple$ be a maple tree and~$\Graph$ be the block graph obtained by tapping~$\Maple$.
  Consider two decorations~$\decoration_\circ, \decoration_\bullet$ on~$\vertexSet$ such that~$\decoration_\circ$ refines~$\decoration_\bullet$.
  To a spine~$\spine_\circ$ on~$\decoratedGraph_\circ \eqdef (\Graph, \decoration_\circ)$, we associate the spine~$\spine_\bullet$ on~$\decoratedGraph_\bullet \eqdef (\Graph, \decoration_\bullet)$ obtained by contracting the empty nodes in the directed tree~$\almostSpine_\bullet$~with
  \begin{itemize}
    \item a node~$\nodeSurj{X}{D} \eqdef X \cap D$ for each node~$X$ of~$\spine_\circ$ and each connected component~$D$ of \linebreak ${\Maple \ssm \big( \Up[{\so[X]}][\decoration_\bullet] \cup \Down[{\ta[X]}][\decoration_\bullet] \big)}$ contained in~$\labeling(X)$,
    \item an arc~$\arcSurj{\gamma}{C}$ joining the unique node~$\nodeSurj{X}{D}$ with~$C \subseteq D$ to the unique node~$\nodeSurj{Y}{E}$~with~${C \subseteq E}$ for each arc~$\gamma$ of~$\spine_\circ$ joining~$X$ to~$Y$ and each connected component~$C$ of~$\Maple \ssm \big( \Up[{\so[\gamma]}][\decoration_\bullet] \cup \Down[{\ta[\gamma]}][\decoration_\bullet] \big)$ contained in~$\labeling(\gamma)$.
  \end{itemize}
  We denote by~$\surjectionSpines$ the map that sends the spine $\spine_\circ$ on~$\decoratedGraph_\circ$ to the spine~$\spine_\bullet$ on~$\decoratedGraph_\bullet$.
\end{definition}

\begin{remark}
  \label{rem:refinementBlossomingSpine}
  A similar construction sends a blossoming spine~$\spine_\circ^\blossom$ on~$\decoratedGraph_\circ$ to a blossoming spine~$\spine_\bullet^\blossom$ on~$\decoratedGraph_\bullet$, and is illustrated in \cref{fig:refinementBlossomingSpines}.
  Namely, we just need to complete the directed tree~$\almostSpine_\bullet$ described in \cref{def:refinementSpines} into a blossoming directed tree~$\almostSpine_\bullet^\blossom$ by adding:
  \begin{itemize}
    \item an incoming (resp.~outgoing) blossom~$\arcSurj{\gamma}{C}$ attached to the unique node~$\nodeSurj{X}{D}$ with~$C \subseteq D$ for each incoming (resp.~outgoing) blossom~$\gamma$ of~$\spine_\circ^\blossom$ attached to node~$X$ and each connected component~$C$ of~$\Maple \ssm \big( \Up[{\so[\gamma]}][\decoration_\bullet] \cup \Down[{\ta[\gamma]}][\decoration_\bullet] \big)$ contained in~$\labeling(\gamma)$.
  \end{itemize}
\end{remark}

Our next four statements aim at showing the correctness of \cref{def:refinementSpines}, meaning that~$\spine_\bullet$ is indeed a spine on~$\decoratedGraph_\bullet$.
\vincent{Maybe first need to prove that ``unique node'' is correct.}
% For an arc~$\gamma$ of~$\spine_\circ$ joining~$X$ to~$Y$ and a connected component~$C$ of~$\Maple \ssm \big( \Up[{\so[\gamma]}][\decoration_\bullet] \cup \Down[{\ta[\gamma]}][\decoration_\bullet] \big)$ there is a unique connected component~$D$ of ${\Maple \ssm \big( \Up[{\so[X]}][\decoration_\bullet] \cup \Down[{\ta[X]}][\decoration_\bullet] \big)}$ containing~$C$, and a unique connected component~$E$ of ${\Maple \ssm \big( \Up[{\so[Y]}][\decoration_\bullet] \cup \Down[{\ta[Y]}][\decoration_\bullet] \big)}$ containing~$C$. Indeed... todo.
For this, we first study the directed tree~$\almostSpine_\bullet$ described in \cref{def:refinementSpines} before contraction of the empty nodes.

\begin{lemma}
  \label{lem:refinementSpines1}
  The map~$\nodeSurj{X}{D} \mapsto X$ is a directed graph morphism from~$\almostSpine_\bullet$ to~$\spine_\circ$.
\end{lemma}

\begin{proof}
  This immediately follows from the definition, since any arc~$\arcSurj{\gamma}{C}$ joining~$\nodeSurj{X}{D}$ to~$\nodeSurj{Y}{E}$ in~$\almostSpine_\bullet$ comes from an arc~$\gamma$ joining~$X$ to~$Y$ in~$\spine_\circ$.
\end{proof}

\begin{lemma}
  \label{lem:refinementSpines2}
  For any arc~$\arcSurj{\gamma}{C}$ joining~$\nodeSurj{X}{D}$ to~$\nodeSurj{Y}{E}$ in~$\almostSpine_\bullet$, any (non-directed) path~$\pi$ in~$\almostSpine_\bullet$ containing~$\arcSurj{\gamma}{C}$, and any node~$\nodeSurj{Z}{F}$ in the connected component of~$\pi \ssm \arcSurj{\gamma}{C}$ containing~$\nodeSurj{X}{D}$ (resp.~$\nodeSurj{Y}{E}$), the set~$F$ is contained in the connected component of~$\Maple \ssm \Down[\nodeSurj{Y}{E}][\decoration_\bullet]$ (resp.~of~$\Maple \ssm \Up[\nodeSurj{X}{D}][\decoration_\bullet]$) containing~$C$.
\end{lemma}

\begin{proof}
  We prove this statement simultaneously on all arcs of~$\almostSpine_\bullet$, by induction on the length of~$\pi$.
  By symmetry, we only treat the case when~$\nodeSurj{Z}{F}$ is in the connected component of~$\pi \ssm \arcSurj{\gamma}{C}$ containing~$\nodeSurj{X}{D}$.
  
  We start with the base case of the induction when~$\pi$ is just the arc~$\arcSurj{\gamma}{C}$.
  Observe first that since~$\gamma$ joins~$X$ to~$Y$, the set~$Y$ is contained in both~$\ta[\gamma]$ and~$\ta[X]$.
  Since~$\nodeSurj{Y}{E} \subseteq Y$, it follows that both~$C$ and~$D$ are contained in a connected component of~$\Maple \ssm \Down[\nodeSurj{Y}{E}][\decoration_\bullet]$.
  Since~$C \subseteq D$, we conclude that~$D$ is contained in the connected component of~$\Maple \ssm \Down[\nodeSurj{Y}{E}][\decoration_\bullet]$ containing~$C$.
%  By symmetry, $E$ is contained in the connected component of~$\Maple \ssm \Up[\nodeSurj{X}{D}][\decoration_\bullet]$ containing~$C$.
  
  Consider now an arbitrary path~$\pi$ containing~$\arcSurj{\gamma}{C}$ and a node~$\nodeSurj{Z}{F}$ in the connected component of~$\pi \ssm \arcSurj{\gamma}{C}$ containing~$\nodeSurj{X}{D}$.
%  By induction, we can assume that~$\nodeSurj{Z}{F}$ is an endpoint of~$\pi$, and we denote by~$\arcSurj{\eta}{\Graph}$ the arc of~$\pi$ incident to~$\nodeSurj{Z}{F}$, and by~$\nodeSurj{W}{H}$ the other endpoint of~$\arcSurj{\eta}{\Graph}$.
  We distinguish two situations:
  \begin{itemize}
    \item If~$\pi$ has a node~$\nodeSurj{W}{\Graph}$ with two outgoing arcs in between~$\nodeSurj{Y}{E}$ and~$\nodeSurj{Z}{F}$, then the induction hypothesis ensures that~$E$ and~$F$ are contained in distinct connected components of~${\Maple \ssm \Up[\nodeSurj{W}{\Graph}][\decoration_\bullet]}$ and that~$\Graph$ is contained in the connected component of~$\Maple \ssm \Down[\nodeSurj{Y}{E}][\decoration_\bullet]$ containing~$C$. This implies that~$F$ is contained in the connected component of~$\Maple \ssm \Down[\nodeSurj{Y}{E}][\decoration_\bullet]$ containing~$C$.
    \item Otherwise, the path~$\pi$ has a directed subpath from~$\nodeSurj{Z}{F}$ to~$\nodeSurj{Y}{E}$. Let~$\nodeSurj{W}{\Graph}$ denote the node after~$\nodeSurj{Z}{F}$ and~$\arcSurj{\eta}{H}$ the arc joining~$\nodeSurj{Z}{F}$ to~$\nodeSurj{W}{\Graph}$. By induction, $\Graph$ is contained in the connected component of~$\Maple \ssm \Down[\nodeSurj{Y}{E}][\decoration_\bullet]$ containing~$C$. Since~$\nodeSurj{Y}{E} \subseteq Y \subseteq \ta[Z]$, the set~$F$ is contained in the connected component of~$\Maple \ssm \Down[\nodeSurj{Y}{E}][\decoration_\bullet]$. Since~$H$ is a subset of both~$F$ and~$\Graph$, we thus obtain that~$F$ is contained in the connected component of~$\Maple \ssm \Down[\nodeSurj{Y}{E}][\decoration_\bullet]$ containing~$C$. \qedhere
  \end{itemize}
%  We conclude by symmetry if~$\nodeSurj{Z}{F}$ in the connected component of~$\pi \ssm \arcSurj{\gamma}{C}$ containing~$\nodeSurj{Y}{F}$.
\end{proof}

\begin{lemma}
  \label{lem:refinementSpines3}
  The graph~$\almostSpine_\bullet$ is indeed a directed tree.
\end{lemma}

\begin{proof}
  We first prove that~$\almostSpine_\bullet$ is connected.
  Consider an edge~$\{u,v\}$ of~$\Graph$.
  Since~$u$ and~$v$ belong to the same connected component of~$\Graph \ssm U$ for any subset~$U$ of~$\vertexSet$, there is a directed path~$\pi$ in~$\spine$ between the node containing~$u$ and the node containing~$v$.
  For any node~$X$ (resp.~arc~$\gamma$) in the interior of this path, $u$ and~$v$ also belong to the same connected component~$D_\star$~of~${\Maple \ssm \big( \Up[{\so[X]}][\decoration_\bullet] \cup \Down[{\ta[X]}][\decoration_\bullet] \big)}$ (resp.~$C_\star$~of~$\Maple \ssm \big( \Up[{\so[\gamma]}][\decoration_\bullet] \cup \Down[{\ta[\gamma]}][\decoration_\bullet] \big)$).
  The corresponding nodes~$\nodeSurj{X}{D_\star}$ and arcs~$\arcSurj{\gamma}{C_\star}$ along the path~$\pi$ thus form a path in~$\almostSpine_\bullet$ between the node containing~$u$ and the node containing~$v$.
  The connectedness of~$\Graph$ thus implies the connectedness of~$\almostSpine_\bullet$.
  
  We now prove that~$\almostSpine_\bullet$ is acyclic.
  Assume that~$\almostSpine_\bullet$ contains a (non-directed) cycle~$\sigma_\bullet$.
  By \cref{lem:refinementSpines1}, the corresponding arcs in~$\spine_\circ$ also form a (non-directed, with possible edge repetitions) cycle~$\sigma_\circ$.
  Since~$\spine_\circ$ is a directed tree, $\sigma_\circ$ has two incoming arcs at the same node. Hence, $\sigma_\bullet$ also has two incoming arcs at the same node.
  Therefore, there are two paths in~$\almostSpine_\bullet$ starting at the same node and arriving to the same node through different incoming arcs, contradicting \cref{lem:refinementSpines2}.
\end{proof}

\begin{lemma}
  \label{lem:refinementSpines4}
  The graph~$\spine_\bullet$ is indeed a spine on~$\decoratedGraph_\bullet$.
\end{lemma}

\begin{proof}
  First, $\spine_\bullet$ is a directed tree as it is obtained by contractions in~$\almostSpine_\bullet$ which is a directed tree by \cref{lem:refinementSpines3}.
  We thus just need to check the two conditions of \cref{def:spine}.

  First, since any node~$X$ of~$\spine_\circ$ is contained both in~$\labeling(X)$ and in ${\Maple \ssm \big( \Up[{\so[X]}][\decoration_\bullet] \cup \Down[{\ta[X]}][\decoration_\bullet] \big)}$, the non-empty nodes~$\nodeSurj{X}{D}$ partition the node~$X$.
  Hence, since the nodes of~$\spine_\circ$ partition~$\vertexSet$, the nodes of~$\spine_\bullet$ partition~$\vertexSet$. This shows the global condition of \cref{def:spine}.

  Second, consider two incoming arcs~$\arcSurj{\alpha}{C}$ and~$\arcSurj{\alpha'}{C'}$ of a node~$\nodeSurj{X}{D}$ in~$\almostSpine_\bullet$.
  By \cref{lem:refinementSpines2}, the source sets $\so[\arcSurj{\alpha}{C}]$ and~$\so[\arcSurj{\alpha'}{C'}]$ are contained in distinct connected components of~$\Graph \ssm \Down[\nodeSurj{X}{D}][\decoration_\bullet]$.
  By symmetry, we thus conclude that~$\almostSpine_\bullet$, and thus~$\spine_\bullet$, satisfies the local condition of \cref{def:spine}.
\end{proof}

We now describe the surjection map~$\surjectionSpines$ in terms of the spine extensions of \cref{def:extensionPreorders}.
So far, we have used spine extensions to define the spine poset in \cref{def:spinePoset}.
Here, we use spine extensions to compare the spines on~$\decoratedGraph_\circ$ with the spines on~$\decoratedGraph_\bullet$.
The next statement should morally be though as the definition of~$\surjectionSpines$, but its proof requires the explicit combinatorial description of \cref{def:refinementSpines}.

\begin{theorem}
  \label{thm:alternativeDescriptionRefinementSpines}
  The spine~$\surjectionSpines(\spine_\circ)$ is the unique extension maximal spine on~$\decoratedGraph_\bullet$ extended~by~$\spine_\circ$.
\end{theorem}

\begin{proof}
  The spines on~$\decoratedGraph_\bullet$ extended by~$\spine_\circ$ clearly form a lower ideal~$I$ of the extension order.
  Observe that~$\surjectionSpines(\spine_\circ)$ belongs to~$I$ by \cref{lem:refinementSpines1}, and that~$\surjectionSpines(\spine_\circ)$ is extension maximal in~$I$ since each node of~$\spine_\circ$ is the disjoint union of incomparable nodes in~$\surjectionSpines(\spine_\circ)$ by \cref{def:refinementSpines}.
  To conclude, we thus just need to prove that~$I$ has a unique maximal element.
  This proof is similar but slightly more subtle than the proof of \cref{thm:spinePoset}.
  
  Assume by contradiction that there are two distinct extension maximal spines~$\spine_\bullet, \spine_\bullet'$ on~$\decoratedGraph_\bullet$ extended by~$\spine_\circ$.
  Hence, there are vertices~$x,y \in \vertexSet$ such that~$x \preccurlyeq_{\spine_\bullet} y$ while~$x \not\preccurlyeq_{\spine_\bullet'} y$, or~$x \not\preccurlyeq_{\spine_\bullet} y$ while~$x \preccurlyeq_{\spine_\bullet'} y$.
  Consider such a pair~$\{x,y\}$ whose distance in~$\Graph$ is minimal, and assume for instance that~$x \preccurlyeq_{\spine_\bullet} y$ while~$x \not\preccurlyeq_{\spine_\bullet'} y$.
  Let~$X$ and~$Y$ be the nodes of~$\spine_\bullet$ containing~$x$ and~$y$ respectively, and let~$\pi$ be the path joining~$X$ to~$Y$ in~$\spine_\bullet$, and define similarly~$X'$, $Y'$ and~$\pi'$ in~$\spine_\bullet'$.

  Note that~$\pi'$ is not fully directed from~$X'$ to~$Y'$ since~$x \not\preccurlyeq_{\spine_\bullet'} y$.
  Assume now that~$\pi'$ is fully directed from~$Y'$ to~$X'$.
  For any~$z \in \vertexSet$ contained in a node along~$\pi'$, we have~$y \preccurlyeq_{\spine_\bullet'} z \preccurlyeq_{\spine_\bullet'} x$, which implies that~$y \preccurlyeq_{\spine_\circ} z \preccurlyeq_{\spine_\circ} x$ (since~$\spine_\circ$ extends~$\spine_\bullet'$), so that~$x \equiv_{\spine_\circ} y \equiv_{\spine_\circ} z$ (since~$x \preccurlyeq_{\spine_\circ} y$).
  Said differently, all vertices of~$\vertexSet$ that appear in the nodes along~$\pi'$ are equivalent for~$\equiv_{\spine_\circ}$.
  Hence, contracting any arc of~$\spine_\bullet'$ along the path~$\pi'$ yields a spine which is still extended by~$\spine_\circ$, contradicting our assumption.

  We can thus now assume that~$\pi'$ is not a directed path, so that is a node of~$\spine_\bullet'$ where~$\pi'$ has either two incoming or two outgoing arcs.
  Let~$Z'$ be the closest such node from~$X'$.
  We now distinguish two cases:
  \begin{enumerate}[(i)]
    \item Assume first that~$\pi'$ has two outgoing arcs at~$Z'$.
    Since~$x$ and~$y$ belong to the target sets of two distinct outgoing arcs of~$Z'$, there is~$z \in \Up[Z'][\decoration_\bullet]$ which separates~$x$ and~$y$ in~$\Graph$.
    Denote by~$Z$ the node of~$\spine_\bullet$ containing~$z$.
    Since~$z \preccurlyeq_{\spine_\bullet'} x$ and~$x$ is closer to~$z$ than to~$y$ in~$\Graph$, our choice of~$\{x,y\}$ ensures that either~$x \preccurlyeq_{\spine_\bullet} z$ or~$z \preccurlyeq_{\spine_\bullet} x$.
    If~$x \preccurlyeq_{\spine_\bullet} z$, we obtain that~$x \preccurlyeq_{\spine_\circ} z \preccurlyeq_{\spine_\circ} x$ (since~$\spine_\circ$ extends both~$\spine_\bullet$ and~$\spine_\bullet'$), which contradicts the maximality of~$\spine_\bullet'$ (the spine obtained by contracting the path joining~$Z'$ to~$X'$ in~$\spine_\bullet'$ would still be extended by~$\spine_\circ$).
    We thus obtain that~$z \prec_{\spine_\bullet} x \preccurlyeq_{\spine_\bullet} y$.
    This implies that~$x$ and~$y$ appear in the target set of the same outgoing arc at~$Z$, even if they are separated by~$z \in \Up[Z][\decoration_\bullet]$, so that~$\spine_\bullet$ fails the local condition around~$Z$ to be a spine on~$\decoratedGraph_\bullet$.
    %
    \item Assume now that~$\pi'$ has two incoming arcs at~$Z'$.
    Since~$x$ and~$y$ belong to the source sets of two distinct incoming arcs of~$Z'$, there is~$z \in \Down[Z'][\decoration_\bullet]$ which separates~$x$ and~$y$ in~$\Graph$.
    Denote by~$Z$ the node of~$\spine_\bullet$ containing~$z$.
    Since~$x \preccurlyeq_{\spine_\bullet'} z$ and~$x$ is closer to~$z$ than to~$y$ in~$\Graph$, our choice of~$\{x,y\}$ ensures that either~$x \preccurlyeq_{\spine_\bullet} z$ or~$z \preccurlyeq_{\spine_\bullet} x$.
    If~$z \preccurlyeq_{\spine_\bullet} x$, we obtain that~$x \preccurlyeq_{\spine_\circ} z \preccurlyeq_{\spine_\circ} x$ (since~$\spine_\circ$ extends both~$\spine_\bullet$ and~$\spine_\bullet'$), which contradicts the maximality of~$\spine_\bullet'$ (the spine obtained by contracting the path joining~$X'$ to~$Z'$ in~$\spine_\bullet'$ would still be extended by~$\spine_\circ$).
    We thus obtain that~$x \prec_{\spine_\bullet} z$.
    If~$z$ does not appear along the path~$\pi$, we obtain that~$x$ and~$y$ appear in the source set of the same incoming arc at~$Z$, even if they are separated by~$z \in \Down[Z][\decoration_\bullet]$, so that~$\spine_\bullet$ fails the local condition around~$Z$ to be a spine on~$\decoratedGraph_\bullet$.
    Otherwise, since~$z \preccurlyeq_{\spine_\bullet} y$ and~$y$ is closer to~$z$ than to~$x$ in~$\Graph$, our choice of~$\{x,y\}$ ensures that either~$z \preccurlyeq_{\spine_\bullet'} y$ or~$y \preccurlyeq_{\spine_\bullet'} z$.
    If~$y \preccurlyeq_{\spine_\bullet'} z$, we obtain that~$y \preccurlyeq_{\spine_\circ} z \preccurlyeq_{\spine_\circ} y$ (since~$\spine_\circ$ extends both~$\spine_\bullet$ and~$\spine_\bullet'$), which contradicts the maximality of~$\spine_\bullet$ (the spine obtained by contracting the path joining~$Z$ to~$Y$ in~$\spine_\bullet$ would still be extended by~$\spine_\circ$).
    We thus obtain that~$x \preccurlyeq_{\spine_\bullet'} z \preccurlyeq_{\spine_\bullet'} y$, contradicting our assumption that~$x \not\preccurlyeq_{\spine_\bullet'} y$.
    \qedhere
  \end{enumerate}
\end{proof}

We now explore some key properties of the map~$\surjectionSpines$.

\begin{proposition}
  \label{prop:orderPreservingRefinementSpines}
  The map~$\surjectionSpines$ is order-preserving, meaning that $\spine_\circ \le \spine_\circ'$ in~$\spinePoset[\decoratedGraph_\circ]$ implies that $\surjectionSpines(\spine_\circ) \le \surjectionSpines(\spine_\circ')$ in~$\spinePoset[\decoratedGraph_\bullet]$.
\end{proposition}

\begin{proof}
  Let~$\spine_\circ$ and~$\spine_\circ'$ be two spines on~$\decoratedGraph_\circ$ and let~$\spine_\bullet \eqdef \surjectionSpines(\spine_\circ)$ and~$\spine_\bullet' \eqdef \surjectionSpines(\spine_\circ')$ be the corresponding spines on~$\decoratedGraph_\bullet$.
  If~${\preccurlyeq_{\spine_\circ}} \supseteq {\preccurlyeq_{\spine_\circ'}}$, then \cref{thm:alternativeDescriptionRefinementSpines} ensures that~${\preccurlyeq_{\spine_\circ}} \supseteq {\preccurlyeq_{\spine_\circ'}} \supseteq {\preccurlyeq_{\spine_\bullet'}}$ (because~$\spine_\circ'$ extends~$\spine_\bullet'$) so that~${\preccurlyeq_{\spine_\bullet}} \supseteq {\preccurlyeq_{\spine_\bullet'}}$ (because~$\preccurlyeq_{\spine_\bullet}$ is extension maximal among the spines of~$\decoratedGraph_\bullet$ extending~$\preccurlyeq_{\spine_\circ}$).
  Hence $\spine_\circ \le \spine_\circ'$  in~$\spinePoset[\decoratedGraph_\circ]$ implies $\spine_\bullet \le \spine_\bullet'$ in~$\spinePoset[\decoratedGraph_\bullet]$.
\end{proof}

\begin{proposition}
  \label{prop:filteredRefinementSpines}
  The nodes of~$\spine_\circ$ are partitioned by the nodes of~$\surjectionSpines(\spine_\circ)$.
\end{proposition}

\begin{proof}
  There are two possible approaches.
  The first is the explicit combinatorial description of~$\surjectionSpines(\spine_\circ)$ given in \cref{def:refinementSpines}.
  The second is to observe that the nodes of a spine~$\spine$ are the classes of the equivalence relation~$\equiv_{\spine}$ defined by~$x \equiv_{\spine} y$ if $x \preccurlyeq_{\spine} y$ and~$y \preccurlyeq_{\spine} x$, and to observe that~${\preccurlyeq_{\spine_\circ}} \supseteq {\preccurlyeq_{\spine_\bullet}}$ implies that~$\equiv_{\spine_\circ}$ refines~$\equiv_{\spine_\bullet}$.
\end{proof}

\begin{corollary}
  \label{coro:filteredRefinementSpines}
  The map~$\surjectionSpines$ has the following properties:
  \begin{enumerate}[(i)]
  \item The rank of~$\spine_\circ$ in~$\spinePoset[\decoratedGraph_\circ]$ is at most the rank of~$\surjectionSpines(\spine_\circ)$ in~$\spinePoset[\decoratedGraph_\bullet]$.
  \item If~$\spine_\circ$ is maximal in~$\spinePoset[\decoratedGraph_\circ]$ then~$\surjectionSpines(\spine_\circ)$ is maximal in~$\spinePoset[\decoratedGraph_\bullet]$.
  \item If~$\spine_\circ$ refines~$\spine_\bullet$ and~$\spine_\circ$ and~$\spine_\bullet$ have the same rank, then~$\surjectionSpines(\spine_\circ) = \spine_\bullet$ and the nodes of~$\spine_\circ$ coincide with the nodes of~$\spine_\bullet$.
  \end{enumerate}
\end{corollary}

\begin{proof}
  Point (i) follows from \cref{prop:filteredRefinementSpines} and the fact that the rank of a spine in~$\spinePoset$ is its number of nodes minus one.
  Point (ii) is a direct consequence of Point (i).
  Finally, if~$\spine_\circ$ refines~$\spine_\bullet$ and~$\spine_\circ$ and~$\spine_\bullet$ have the same rank, then any spine strictly extended by~$\spine_\bullet$ has rank smaller than the rank of~$\spine_\circ$ and thus cannot be~$\surjectionSpines(\spine_\circ)$, which implies that~$\surjectionSpines(\spine_\circ) = \spine_\bullet$.
  This implies that the nodes of~$\spine_\circ$ coincide with the nodes of~$\surjectionSpines(\spine_\circ)$, as the former are partitioned by (by \cref{prop:filteredRefinementSpines}) and equinumerous (same rank) with the latter.
\end{proof}

\begin{proposition}
  \label{prop:refinementSpines}
  For any spine~$\spine_\bullet$ on~$\decoratedGraph_\bullet$, there exists at least one spine~$\spine_\circ$ on~$\decoratedGraph_\circ$ such that ${\surjectionSpines(\spine_\circ) = \spine_\bullet}$ and the nodes of~$\spine_\circ$ coincide with the nodes of~$\spine_\bullet$.
  Hence, the map~$\surjectionSpines$ is a surjection from the spines on~$\decoratedGraph_\circ$ to the spines on~$\decoratedGraph_\bullet$.
\end{proposition}

\begin{proof}
  The proof works by induction on the rank of~$\spine_\bullet$.
  To initialize the induction, observe that the tree with a single node~$\vertexSet$ is a spine on both~$\decoratedGraph_\circ$ and~$\decoratedGraph_\bullet$ and is its own image by~$\surjectionSpines$.
  Consider now two spines~$\spine_\bullet, \spine_\bullet'$ on~$\decoratedGraph_\bullet$ such that~$\spine_\bullet'$ is obtained by splitting a $\decoratedGraph_\bullet$-splittable partition~$X \sqcup Y$ of a node~$Z$ in~$\spine_\bullet$.
  Assume that we know a spine~$\spine_\circ$ on~$\decoratedGraph_\circ$ such that~${\surjectionSpines(\spine_\circ) = \spine_\bullet}$ and the nodes of~$\spine_\circ$ coincide with the nodes of~$\spine_\bullet$.
  Therefore, $Z$ is also a node of~$\spine_\circ$, and the partition~$X \sqcup Y$ is also~$\decoratedGraph_\circ$-splittable since it is $\decoratedGraph_\bullet$-splittable and~$\decoration_\circ$ refines~$\decoration_\bullet$.
  Let~$\spine_\circ'$ denote the spine obtained by splitting the  $\decoratedGraph_\circ$-splittable partition~$X \sqcup Y$ of the node~$Z$ in~$\spine_\circ$.
  By construction, the nodes of~$\spine_\circ'$ coincide with the node of~$\spine_\bullet'$.
  We thus just need to show that~$\spine_\circ$ extends~$\spine_\bullet$, which will prove that~${\surjectionSpines(\spine_\circ') = \spine_\bullet'}$ by \cref{coro:filteredRefinementSpines}.
  For this, consider~$x,y \in \vertexSet$ and denote by~$\pi_\circ$ and~$\pi_\circ'$ the unique paths joining the node containing~$x$ to the node containing~$y$ in~$\spine_\circ$ and~$\spine_\circ'$ respectively.
  Note that the paths~$\pi_\circ$ and~$\pi_\bullet$ are obtained from~$\pi_\circ'$ by contracting the arc joining~$X$ to~$Y$ (if it appears in~$\pi_\circ'$).
  If~$x \preccurlyeq_{\spine_\bullet'} y$, then~$x \preccurlyeq_{\spine_\circ} y$ since~${\preccurlyeq_{\spine_\circ}} \supseteq {\preccurlyeq_{\spine_\bullet}} \supseteq {\preccurlyeq_{\spine_\bullet'}}$, so that the path~$\pi_\circ$ is a directed path.
  If~$x \not\preccurlyeq_{\spine_\circ'} y$, then the path~$\pi_\circ'$ is not an oriented path, so that it must pass from~$Y$ to~$X$. %$\pi_\circ'$ must be directed from the node containing~$x$ to~$Y$, then pass from~$Y$ to~$X$, and then be directed from~$X$ to the node containing~$y$.
  Hence, there is~$\up[x] \in \Up[X][\decoration_\circ]$ and~$\down[y] \in \Down[Y][\decoration_\circ]$ such that~$x \preccurlyeq_{\spine_\circ'} \down[y] \succcurlyeq_{\spine_\circ'} \up[x] \preccurlyeq_{\spine_\circ'} y$ and~$x, \down[y], \up[x], y$ appear in this order along the unique induced path joining~$x$ to~$y$ in~$\Graph$.
  Since~$\decoration_\circ$ refines $\decoration_\bullet$, we have~$\up[x] \in \Up[X][\decoration_\bullet]$ and~$\down[y] \in \Down[Y][\decoration_\bullet]$.
  If~$x \not\preccurlyeq_{\spine_\bullet} \down[y]$ (resp.~$\up[x] \not\preccurlyeq_{\spine_\bullet} y$), then consider the sequence $x = z_i, \dots, z_j = \down[y]$ (resp.~$\up[x] = t_k, \dots, t_\ell = y$) given by \cref{def:spinePreorder2} and set~$j' \eqdef j$ if~$j$ is odd and~$j' \eqdef j-1$ if~$j$ is even (resp.~$k' \eqdef k$ if~$k$ is even and~$k' \eqdef j+1$ if~$k$ is odd).
  Otherwise set~$z_i \eqdef x$ and $z_{j'} \eqdef y$ with~$i+1 = j'$ odd (resp.~$z'_{k'} \eqdef \up[x]$ and~$z'_\ell \eqdef y$ with~$k' = \ell-1$ even).
  Up to a global shift, we can moreover assume that~$j' = k'-1$.
  Note that by construction~$z_{j'} \succcurlyeq_{\spine_\bullet'} \down[y] \succ_{\spine_\bullet'} \up[x] \succcurlyeq_{\spine_\bullet'} t_{k'}$.
  Hence, the sequence~$x = z_i, \dots z_{j'}, t_{k'}, \dots, t_\ell = y$ satisfies the conditions of \cref{def:spinePreorder2}, so that~$x \not\preccurlyeq_{\spine_\bullet'} y$, which contradicts our assumption.
\end{proof}

We now consider the equivalence relation defined by the fibers of the surjection~$\surjectionSpines$.

\begin{definition}
  \label{def:equivalenceRelation}
  We denote by~$\equivalenceSpines$ the equivalence relation on the spines on~$\decoratedGraph_\circ$ defined by $\spine_\circ \equivalenceSpines \spine_\circ'$ if and only if~$\surjectionSpines(\spine_\circ) = \surjectionSpines(\spine_\circ')$.
\end{definition}

\begin{proposition}
  \label{prop:equivalenceRelation}
  The relation~$\equivalenceSpines$ is the transitive closure of the relations~$\spine_\circ \equivalenceSpines \spine_\circ'$ where~$\spine_\circ'$ is obtained by splitting~$X \sqcup Y$ in~$\spine_\circ$ such that~${x \not\succcurlyeq_{\surjectionSpines(\spine_\circ)} y}$ for each~$x \in X$ and~$y \in Y$.
\end{proposition}

\begin{proof}
  By \cref{prop:orderPreservingRefinementSpines}, the equivalence classes of~$\equivalenceSpines$ are order-convex in the spine poset, so that~$\equivalenceSpines$ is indeed the transitive closure of its restriction to covers of~$\spinePoset$.
  Now if~$\spine_\circ'$ is obtained by splitting~$X \sqcup Y$ in~$\spine_\circ$, then~$\spine_\circ \equivalenceSpines \spine_\circ'$ if and only if there is no~$x \in X$ and~$y \in Y$ with~${x \succcurlyeq_{\surjectionSpines(\spine_\circ)} y}$.
\end{proof}

In particular, any decorated block graph~$\decoratedGraph$ defines an equivalence relation~$\equiv_{\decoratedGraph}$ on ordered partitions (which restricts to an equivalence relation on permutations) by considering that the undecorated block graph~$\Graph$ refines the decorated block graph~$\decoratedGraph$.
This generalizes the following classical equivalence relations.

\begin{example}
  \label{exm:equivalenceRelations}
  The equivalence relation~$\equiv_{\decoratedGraph}$ on ordered partitions (or on permutations) is
  \begin{enumerate}[(i)]
    \item the \defn{trivial relation} when $\decoratedGraph$ is complete or undecorated,
    \item the various \defn{permutree relations} of~\cite{PilaudPons-permutrees} when~$\Graph$ is a path (in particular the \defn{sylvester relation} for a down decorated path, and the \defn{Cambrian relations} for up-down decorated~paths).
  \end{enumerate}
  Note that in contrast to these specific examples, the equivalence relation~$\equiv_{\decoratedGraph}$ on ordered partitions (resp.~on permutations) has no reason to be a lattice congruence of the facial weak order (resp. of the weak order).
\end{example}

We finally compare the chunk nested complexes~$\nestedComplex[\decoratedGraph_\circ]$ and~$\nestedComplex[\decoratedGraph_\bullet]$

\begin{proposition}
  \label{prop:refinementChunks}
  If~$\decoratedGraph_\circ$ refines~$\decoratedGraph_\bullet$, then
  \begin{itemize}
    \item any chunk of~$\decoratedGraph_\bullet$ is a chunk of~$\decoratedGraph_\circ$,
    \item the chunk nested complex~$\nestedComplex[\decoratedGraph_\bullet]$ contains the subcomplex of~$\nestedComplex[\decoratedGraph_\circ]$ induced by the chunks~of~$\decoratedGraph_\bullet$.
  \end{itemize}
\end{proposition}

\begin{proof}
  If~$\chunk$ is a chunk of~$\decoratedGraph_\bullet$, then~$\chunk$ and its complement form a $\decoratedGraph_\bullet$-splittable partition, thus a $\decoratedGraph_\circ$-splittable partition, so that~$\chunk$ is a chunk of~$\decoratedGraph_\circ$.
  The second point immediately follows from the definition of the compatibility relation in \cref{def:compatibleChunks}.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Links}
\label{subsec:links}

Finally, we describe the links of the chunk nested complexes.
It turns out that we have a sufficiently large family of simplicial complexes so that their links are just joins of simplicial complexes in this family.

\begin{definition}
  \label{def:subBlockGraph}
  Let~$\Maple$ be a maple tree, let~$\Graph$ be the block graph obtained by tapping~$\Maple$, and let~$X \sqcup Y = \vertexSet$ be a partition of the vertex set~$\vertexSet$ of~$\Graph$ (thus of the blue vertices of~$\Maple$).
  We denote by~$\Maple_X$ the maple tree with blue vertices~$X$ obtained by contracting all edges of~$\Maple$ incident to a vertex of~$Y$ (note that each red vertex of~$\Maple_X$ is labeled by the concatenation of the labels of the corresponding red vertices in~$\Maple$).
  We denote by~$\Graph_X$ the block graph with vertices~$X$ obtained by replacing each connected component of~$Y$ in~$\Graph$ by a clique on its neighbors in~$\Graph$.
  Note that $\Graph_X$ is obtained by tapping~$\Maple_X$.
  For a decorated maple tree~$\decoratedMaple \eqdef (\Maple, \decoration)$ and a decorated block graph~$\decoratedGraph \eqdef (\Graph, \decoration)$, we define~$\decoratedMaple_X \eqdef (\Maple_X, \decoration_X)$ and~$\decoratedGraph_X \eqdef (\Graph_X, \decoration_X)$ where~$\decoration_X$ is the restriction of~$\decoration$ to~$X$.
  See \cref{fig:linksDecoratedGraphs}.
  %
\begin{figure}
  \centerline{
  \begin{tabular}{c@{\qquad}c@{\qquad}c}
  \begin{tikzpicture}[scale=.7, baseline=20]  
    \node (1) at (-4, 4) {$\blue 1$};
    \node (4) at (-4, 2) {$\blue 4$};
    \node (a) at (-5, 4) {$\red a$};
    \node (bcdfghijk) at (-3, 3) {\red\textit{bcdfghijk}};
    \node (e) at (-5, 2) {$\red e$};
    \draw[-] (a)--(1)--(bcdfghijk)--(4)--(e); 
  \end{tikzpicture}
  &
  \begin{tikzpicture}[scale=.7, baseline=0]  
    \node (2) at (0, 4) {$\blue \updown[2]$};
    \node (5) at (-2, 2) {$\blue \up[5]$};
    \node (6) at (2, 2) {$\blue 6$};
    \node (bc) at (1, 4) {\red\textit{bc}};
    \node (ade) at (-3, 3) {\red\textit{ade}};
    \node (fjk) at (0, 2) {\red\textit{fjk}};
    \node (g) at (3, 2) {$\red g$};
    \node (hi) at (-3, 1) {\red\textit{hi}};
    \draw[-] (ade)--(5)--(hi); 
    \draw[-] (5)--(fjk)--(6)--(g); 
    \draw[-] (bc)--(2)--(fjk); 
  \end{tikzpicture}
%  &
%  \begin{tikzpicture}[scale=.7]  
%    \node (3) at (2, 4) {$\blue 3$};
%    \node (a) at (-5, 4) {$\red a$};
%    \node (abdefghijk) at (0, 4) {\red\textit{abdefghijk}};
%    \node (c) at (3, 4) {$\red c$};
%    \draw[-] (abdefghijk)--(3)--(c);
%  \end{tikzpicture}
  &
  \begin{tikzpicture}[scale=.7, baseline=-40]  
    \node (7) at (-4, 0) {$\blue \down[7]$};
    \node (8) at (0, 0) {$\blue 8$};
    \node (abcdefgh) at (-2, 0) {\red\textit{abcdefgh}};
    \node (i) at (-5, 0) {$\red i$};
    \node (jk) at (1, 0) {\red\textit{jk}};
    \draw[-] (i)--(7)--(abcdefgh)--(8)--(jk); 
  \end{tikzpicture}
%  &
%  \begin{tikzpicture}[scale=.7]  
%    \node (9) at (2, 0) {$\blue 9$};
%    \node (abcdefghij) at (0, 0) {\red\textit{abcdefghij}};
%    \node (k) at (3, 0) {$\red k$};
%    \draw[-] (abcdefghij)--(9)--(k); 
%  \end{tikzpicture}
  \end{tabular}
  }
  \caption{The decorated maple trees~$\decoratedMaple_X$ (top) and the decorated block graphs~$\decoratedGraph_X$ (bottom) obtained for the decorated maple tree~$\Maple$ and the decorated block graph~$\decoratedGraph$ of \cref{fig:mapleBlock} and for~$X = 14$, $X = 256$, and~$X = 78$.}
  \label{fig:linksDecoratedGraphs}
\end{figure} 
\end{definition}

\begin{definition}
  \label{def:insert}
  Let~$\decoratedMaple$ be a decorated maple tree and~$\decoratedGraph$ be the decorated block graph obtained by tapping~$\Maple$.
  Let~$\spine^\blossom$ be a blossoming spine on~$\decoratedGraph$, and let~$\spine^\blossom_X$ be a blossoming spine on~$\decoratedGraph_X$ for each node~$X$ of~$\spine^\blossom$.
  Note that the connected components of~$\Maple_X \ssm \Down[X]$ (resp.~of~$\Maple_X \ssm \Up[X]$) label both the incoming (resp.~outgoing) blossoms of~$\spine^\blossom_X$ and the incoming (resp.~outgoing) arcs and blossoms at~$X$ in~$\spine^\blossom$.
  We denote by~$\insertion{\spine^\blossom}{(\spine^\blossom_X)_{X \in \spine^\blossom}}$ the blossoming spine on~$\decoratedGraph$ obtained by replacing each node~$X$ of~$\spine^\blossom$ by the blossoming spine~$\spine^\blossom_X$ (and reconnecting the blossoms of~$\spine^\blossom_X$ to the arcs of~$\spine^\blossom$ according to their labels).
  \vincent{We need a picture}
\end{definition}

\begin{lemma}
  \label{lem:insert}
  The directed tree~$\insertion{\spine^\blossom}{(\spine^\blossom_X)_{X \in \spine^\blossom}}$ is indeed a blossoming spine on~$\decoratedGraph$.
\end{lemma}

\begin{proof}
  Observe first that the nodes of~$\insertion{\spine^\blossom}{(\spine^\blossom_X)_{X \in \spine^\blossom}}$ partition~$\vertexSet$ since the nodes of~$\spine^\blossom$ partition~$\vertexSet$ and the nodes of~$\spine^\blossom_X$ partition~$X$ for each node~$X$ of~$\spine^\blossom$.
  \vincent{todo}
\end{proof}

\begin{proposition}
  \label{prop:linksSpines}
  The blossoming spines on~$\decoratedGraph$ which can be contracted to a given blossoming spine~$\spine^\blossom$ on~$\decoratedGraph$ are precisely the blossoming spines~$\insertion{\spine^\blossom}{(\spine^\blossom_X)_{X \in \spine^\blossom}}$ for all choices of a blossoming spine~$\spine^\blossom_X$ on~$\decoratedGraph_X$ for each node~$X$ of~$\spine^\blossom$.
\end{proposition}

\begin{proof}
  \vincent{todo}
\end{proof}

\cref{prop:linksSpines} rephrases as follows on the spine poset of \cref{subsec:spinePoset} and on the chunk nested complex of \cref{subsec:nestedComplex}. %, and on the flip graph of \cref{subsec:flips}.

\begin{corollary}
  \label{coro:linksSpinePoset}
  The upper ideal of the spine poset~$\spinePoset$ generated by a given spine~$\spine$ is isomorphic to the Cartesian product of the spine posets~$\spinePoset[\decoratedGraph_X]$ for the nodes~$X$ of~$\spine$.
\end{corollary}

\begin{corollary}
  \label{coro:linksNestedComplex}
  The link of the face of the chunk nested complex~$\nestedComplex$ corresponding to a spine~$\spine$ is isomorphic to the join of the chunk nested complexes~$\nestedComplex[\decoratedGraph_X]$ for the nodes~$X$ of~$\spine$.
\end{corollary}

%\begin{corollary}
%  \label{coro:linksFlipGraph}
%  The flip graph on the maximal spines on~$\decoratedGraph$ that contract to a spine~$\spine$ is isomorphic to the Cartesian product of the flip graphs on maximal spines of~$\decoratedGraph_X$ for the nodes~$X$ of~$\spine$.
%\end{corollary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Geometry: spine fans and polytopes}
\label{sec:geometry}

We denote by~$(\b{e}_v)_{v \in \vertexSet}$ the standard basis of~$\R^{\vertexSet}$.
We denote by~$\one_X \eqdef \sum_{x \in X} \b{e}_x$ the characteristic vector of a subset~$X \subseteq \vertexSet$, and write just~$\one$ for~$\one_{\vertexSet}$.
%We consider the hyperplane
%\[
%\Hyp \eqdef \bigset{\b{z} \in \R^{\vertexSet}}{\dotprod{\one}{\b{z}} = \weight_{\vertexSet}}.
%\]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Spine fan}
\label{subsec:spineFan}

%We first recall some observations on the braid arrangement (see \eg \cite{Postnikov, PostnikovReinerWilliams}) and on graphical arrangements.
%
Recall that a (polyhedral) \defn{cone} is the positive span of a finite set of vectors, or equivalently the intersection of a finite set of linear halfspaces.
The \defn{faces} of a cone are its intersections with its supporting linear hyperplanes.
A (polyhedral) \defn{fan}~$\c{F}$ is a collection of polyhedral cones closed under faces (if~$\polytope{C}$ is a face of~$\polytope{C'}$, then~$\polytope{C'} \in \c{F} \Rightarrow \polytope{C'} \in \c{F}$) and intersecting along faces (any two cones of~$\c{F}$ intersect along a face of both).
The \defn{rays} of~$\c{F}$ are its dimension~$1$ cones, and the \defn{regions} of~$\c{F}$ are its inclusion maximal cones.
The fan~$\c{F}$ is \defn{essential} when its inclusion minimal cone is the origin, \defn{complete} when its cones cover the space, and \defn{simplicial} when all its cones are simplicial (generated by linearly independent vectors).
A fan~$\c{F}_\circ$ \defn{refines} a fan~$\c{F}_\bullet$ (and~$\c{F}_\bullet$ \defn{coarsens}~$\c{F}_\circ$) when any cone of~$\c{F}_\circ$ is contained in a cone of~$\c{F}_\bullet$.

In this paper, all the fans live in the hyperplane~${\Hyp[0] \eqdef \bigset{\b{z} \in \R^{\vertexSet}}{\dotprod{\one}{\b{z}} = 0}}$ of~$\R^{\vertexSet}$.
Recall from \cref{def:spinePreorder1} that a spine~$\spine$ corresponds to a spine preposet~$\preccurlyeq_{\spine}$ defined by~$x \preccurlyeq_{\spine} y$ if and only if there is a directed path in~$\spine$ joining the node containing~$x$ to the node containing~$y$ in~$\spine$ (in particular, $x \equiv_{\spine} y$ when $x,y \in \vertexSet$ belong to the same node of~$\spine$).

%We next consider two very classical examples of fans.
%
%\begin{example}
%  \label{exm:braidFan}
%  The \defn{braid arrangement} is the collection of hyperplanes~$\set{\b{x} \in \R^{\vertexSet}}{x_u = x_v}$ for all~$u \ne v \in \vertexSet$.
%  Since this arrangement is not essential (all its hyperplanes contain the line generated by~$\one$), we consider its intersection with the hyperplane~${\Hyp[0] \eqdef \bigset{\b{x} \in \R^{\vertexSet}}{\dotprod{\one}{\b{x}} = 0}}$.
%  This intersection defines the \defn{braid fan}~$\braidFan$.
%  Each surjection~$\pi : \vertexSet \to [k+1]$ corresponds to a $k$-dimensional cone~$\normalCone(\pi) \eqdef \set{\b{x} \in \Hyp[0]}{x_u \le x_v \text{ iff } \pi(u) \le \pi(v)}$ of~$\braidFan$.
%  In particular, the regions of~$\braidFan$ correspond to bijections~$\vertexSet \to [|\vertexSet|]$ and the rays of~$\braidFan$ correspond to proper subsets of~$\varnothing \ne X \ne \vertexSet$.
%  \vincent{Not sure if we want surjections or ordered partitions here.}
%%More generally, we associate to an acyclic oriented graph~$H$ whose nodes partition~$\vertexSet$ the cone~$\normalCone(H) \eqdef \set{\b{x} \in \Hyp[0]}{x_u \le x_v \text{ for all } u \preccurlyeq_H v}$, where~$u \preccurlyeq_H v$ means that there is a directed path in~$H$ from the node containing~$u$ to the node containing~$v$ (in particular, ~$u =_H v$ if~$u$ and~$v$ belong to the same node of~$H$).
%%Recall that a \defn{preposet} on~$\vertexSet$ is a reflexive and transitive binary relation~$R \subsetea \vertexSet \times \vertexSet$.
%%An equivalence relation is a symmetric preposet, and a poset if an antisymmetric preposet.
%%Any preposet~$R$ decomposes into an equivalence relation~$\equiv_R \eqdef \set{(u,v) \in R}{(v,u) \in R}$ together with a poset structure~${\prec_R \eqdef \, R/\!\equiv_R}$ on the equivalence classes of~$\equiv_R$.
%%Let~$H$ be an acyclic oriented graph~$H$ whose nodes partition~$\vertexSet$.
%%For two vertices~$u,v \in \vertexSet$, we write~$u \preccurlyeq_H v$ if there is a directed path in~$H$ from the node containing~$u$ to the node containing~$v$ (in particular, ~$u =_H v$ if~$u$ and~$v$ belong to the same node of~$H$).
%%We associate to~$H$ the two cones
%%\[
%%  \normalCone(H) \eqdef \set{\b{x} \in \Hyp[0]}{x_u \le x_v \text{ for all } u \preccurlyeq_H v}
%%  \quad\text{and}\quad
%%  \primalCone(H) \eqdef \cone\set{\b{e}_u - \b{e}_v}{\text{for all } u \preccurlyeq_H v}.
%%\]
%%Note that these two cones are polar to each other.
%\end{example}
%
%\vincent{We could introduce here the sylvester fan. But it would be a repetition with the spine fan. Not sure.}
%%\begin{example}
%%  \label{exm:sylvesterFan}
%%  \vincent{Todo}
%%\end{example}
%
%\begin{example}
%  \label{exm:graphicalFan}
%  The \defn{graphical arrangement} of~$\Graph$ is the collections of hyperplanes~$\set{\b{x} \in \R^{\vertexSet}}{x_u = x_v}$ for all~$\{u,v\} \in \edgeSet$.
%  Its intersection with the hyperplane~$\Hyp[0]$ defines the \defn{graphical fan}~$\graphicalFan$.
%  The cones of~$\graphicalFan$ correspond to the pairs~$(p,o)$ where~$p$ is a partition of~$\vertexSet$ into connected subgraphs, and~$o$ is an acyclic orientation of the quotient graph~$\Graph/p$.
%  In particular, the regions of~$\graphicalFan$ correspond to the acyclic orientations of~$\Graph$.
%\end{example}
%
%We consider the following fan which is sandwiched between the braid fan and the graphical fan.

\begin{definition}
  \label{def:spineFan}
  For a spine~$\spine$, we denote by~$\normalCone(\spine)$ the cone of~$\Hyp[0]$ defined by the inequalities~${z_u \le z_v}$ for all~$x \preccurlyeq_{\spine} y$.
  The \defn{spine fan}~$\spineFan$ is the collection of cones~$\normalCone(\spine)$ for all spines~$\spine$ on~$\decoratedGraph$.  
\end{definition}

\begin{proposition}
  \label{prop:spineFan}
  The spine fan~$\spineFan$ is a complete simplicial fan on~$\Hyp[0]$.
\end{proposition}

\begin{proof}
  Since each spine~$\spine$ on~$\decoratedGraph$ is a directed tree, the cone~$\normalCone(\spine)$ is simplicial, and its faces are the cones~$\normalCone(\spine')$ for all spines~$\spine'$ obtained by repeated arc contractions in~$\spine$. % (in other words, for all spines in the lower ideal of the spine poset~$\spinePoset$ generated by~$\spine$).
  We thus just need to prove that the cones~$\normalCone(\spine)$ properly intersect and cover~$\Hyp[0]$, or equivalently, that the relative interiors of the cones~$\normalCone(\spine)$ partition~$\Hyp[0]$.
  This is known when~$\decoratedGraph$ is undecorated as the spine fan actually coincides with the classical braid fan, see \cref{exm:spineFans}\,(i).
  It thus follows from \cref{thm:alternativeDescriptionRefinementSpines} for arbitrary decorated graphs, since~$\preccurlyeq_{\spine_\circ} \supseteq \preccurlyeq_{\spine_\bullet}$ if and only if~$\normalCone(\spine_\circ) \subseteq \normalCone(\spine_\bullet)$.
\end{proof}

\begin{corollary} 
   The chunk nested complex~$\nestedComplex$ is a simplicial sphere.
\end{corollary}

%\begin{proposition}
%  \label{prop:fanSandwich}
%  The spine fan~$\spineFan$ coarsens the braid fan~$\braidFan$ and refines the graphical fan~$\graphicalFan$.
%\end{proposition}
%
%\begin{proof}
%  This immediately follows from \cref{subsec:surjectionMaps}.
%\end{proof}

%\begin{example}
%  \label{exm:braidFanGraphicalFan}
%  The spine fan~$\spineFan$ recovers the braid fan~$\braidFan$ of \cref{exm:braidFan} and the graphical fan~$\graphicalFan$ of \cref{exm:graphicalFan} in the following two extreme situations:
%  \begin{itemize}
%    \item if~$\Down[\vertexSet] = \Up[\vertexSet] = \varnothing$, then the spine fan~$\spineFan$ is the braid fan~$\braidFan$,
%    \item if~$\Down[\vertexSet] = \Up[\vertexSet] = \vertexSet$, then the spine fan~$\spineFan$ is the graphical fan~$\graphicalFan$.
%  \end{itemize}
%\end{example}

\begin{example}
  \label{exm:spineFans}
  For instance, the spine fan is:
  \begin{enumerate}[(i)]
    \item the \defn{braid fan}~$\braidFan$ when~$\decoratedGraph$ is complete or undecorated. It is the fan defined from the classical \defn{braid arrangement} of the hyperplanes~$\set{\b{z} \in \R^{\vertexSet}}{z_x = z_y}$ for all vertices~$x \ne y \in \vertexSet$. It has a $k$-dimensional cone~$\normalCone(\pi) \eqdef \set{\b{z} \in \Hyp[0]}{z_x \le z_y \iff \pi(x) \le \pi(y)}$ for each surjection~$\pi : \vertexSet \to [k+1]$. In particular, the regions of~$\braidFan$ correspond to bijections~${\vertexSet \to [|\vertexSet|]}$ and the rays of~$\braidFan$ correspond to proper subsets of~$\varnothing \ne X \ne \vertexSet$.
    \item the \defn{nested fan} of~$\Graph$ studied in~\cite{CarrDevadoss, Zelevinsky} when~$\decoratedGraph$ is down decorated (in particular the classical \defn{sylvester fan} when~$\decoratedGraph$ is a down decorated path).
    \item the \defn{graphical fan}~$\graphicalFan$ when~$\decoratedGraph$ is fully decorated (in particular the \defn{coordinate fan} when~$\decoratedGraph$ is a fully decorated tree). It is the fan defined from the \defn{graphical arrangement} of the hyperplanes~$\set{\b{z} \in \R^{\vertexSet}}{z_x = z_y}$ for all edges~$\{x, y\} \in \vertexSet$. The cones of~$\graphicalFan$ correspond to the pairs~$(p,o)$ where~$p$ is a partition of~$\vertexSet$ into connected subgraphs, and~$o$ is an acyclic orientation of the quotient graph~$\Graph/p$. In particular, the regions of~$\graphicalFan$ correspond to the acyclic orientations of~$\Graph$.
    \item the various \defn{permutree fans} of~\cite{PilaudPons-permutrees} when~$\Graph$ is a path (in particular the various type~$A$ \defn{Cambrian fans} for up-down decorated paths).
  \end{enumerate}
\end{example}

\begin{remark}
  \label{rem:irrelevantDecorationsSpineFans}
  Using the notations of \cref{rem:irrelevantDecorations}, note that the spine fans on~$\decoratedGraph$, on $\decoratedGraph^\star$ and on~$\decoratedGraph^\#$ are precisely the same.
\end{remark}

\begin{proposition}
  \label{prop:refinementSpineFan}
  If~$\decoratedGraph_\circ$ refines~$\decoratedGraph_\bullet$, the spine fan~$\spineFan[\decoratedGraph_\circ]$ refines the spine fan~$\spineFan[\decoratedGraph_\bullet]$.
  In particular, the spine fan~$\spineFan$ coarsens the braid fan~$\braidFan$ and refines the graphical fan~$\graphicalFan$.
\end{proposition}

\begin{proof}
  Follows from \cref{thm:alternativeDescriptionRefinementSpines} since~${\preccurlyeq_{\spine_\circ}} \supseteq {\preccurlyeq_{\spine_\bullet}}$ if and only if~$\normalCone(\spine_\circ) \subseteq \normalCone(\spine_\bullet)$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Spine polytope}
\label{subsec:spinePolytope}

Recall that a \defn{polytope}~$\polytope{P}$ is the convex hull of a finite set of points, or equivalently a bounded intersection of a finite set of affine halfspaces.
The \defn{faces} of~$\polytope{P}$ are its intersections with its supporting affine hyperplanes.
The \defn{vertices} of~$\polytope{P}$ are its dimension~$0$ faces, and the \defn{facets} of~$\polytope{P}$ are its codimension~$1$ faces.
The \defn{normal cone} of a face~$\polytope{F}$ of~$\polytope{P}$ is the cone of all linear functions whose maximum over~$\polytope{P}$ is attained precisely on~$\polytope{F}$.
The \defn{normal fan} of~$\polytope{P}$ is the fan formed by the normal cones of all the faces of~$\polytope{P}$.
All our polytopes are parametrized by a weight function, which does not change their combinatorics but provides more freedom for their geometry.

\begin{definition}
  \label{def:weight}
  For a set~$X$, we denote by~$\monombinom{X}$ the set of~$\binom{|X|+1}{2}$ subsets of~$X$ of size $1$ or~$2$.
  We fix a \defn{weight}~$\weight_p > 0$ for all~$p \in \monombinom{\vertexSet}$, and we define~$\weight_X \eqdef \sum_{p \in \monombinom{X}} \weight_p$ for any subset~$X$ of~$\vertexSet$.
\end{definition}

%We next consider two very classical examples of polytopes.
%
%\begin{example}
%  \label{exm:permutahedron}
%  The \defn{permutahedron}~$\Perm$ is the polytope defined equivalently as
%  \begin{itemize}
%%    \item the convex hull of the points~$\sum_{u,v \in \vertexSet} \delta_{\sigma(u) \le \sigma(v)} \weight_{uv} \b{e}_v$ for all bijections~$\sigma: \vertexSet \to [|\vertexSet|]$,
%    \item the convex hull of the points~$\point[\sigma] \eqdef \sum_{p \in \monombinom{\vertexSet}} \weight_p \b{e}_{\max_\sigma(p)}$ for all bijections~$\sigma: \vertexSet \to [|\vertexSet|]$,
%    \item the intersection of the affine hyperplane~$\Hyp \eqdef \bigset{\b{x} \in \R^{\vertexSet}}{\dotprod{\one}{\b{x}} = \weight_{\vertexSet}}$ with the affine halfspaces~$\HS_X \eqdef \bigset{\b{x} \in \R^{\vertexSet}}{\dotprod{\one_X}{\b{x}} \ge \weight_X}$ for all proper subsets~$\varnothing \ne X \subsetneq \vertexSet$,
%    \item the Minkowski sum~$\sum_{p \in \monombinom{\vertexSet}} \weight_p \triangle_p$, where~$\triangle_p \eqdef \conv\set{\b{e}_v}{v \in p}$.
%  \end{itemize}
%  The braid fan~$\braidFan$ is the normal fan of the permutahedron~$\Perm$.
%  Note that the barycenter of~$\Perm$ is the point~$\b{0}^\weight \eqdef \sum_{p \in \monombinom{\vertexSet}} \frac{\weight_p}{|p|} \one_p$.
%\end{example}
%
%\vincent{We could introduce here the graph associahedron. But it would be a repetition with the spine fan. Not sure.}
%\begin{example}
%  \label{exm:associahedron}
%  The \defn{graph associahedron}~$\Asso$ is the polytope defined equivalently as
%  \vincent{todo}
%  \begin{itemize}
%    \item the convex hull of the points~$\point[{\spine[T]}] \eqdef \dots$,
%    \item the intersection of the affine hyperplane~$\Hyp \eqdef \bigset{\b{x} \in \R^{\vertexSet}}{\dotprod{\one}{\b{x}} = \weight_{\vertexSet}}$ with the affine halfspaces~$\HS_X \eqdef \bigset{\b{x} \in \R^{\vertexSet}}{\dotprod{\one_X}{\b{x}} \ge \weight_X}$ for all proper subsets~$\varnothing \ne X \subsetneq \vertexSet$ which induce a connected subgraph of~$\Graph$,
%    \item the Minkowski sum~$\sum_{X} \weight_X \triangle_X$, where~$\triangle_X \eqdef \conv\set{\b{e}_u}{u \in X}$.
%  \end{itemize}
%  The sylvester fan~$\sylvesterFan$ is the normal fan of the associahedron~$\Asso$.
%\end{example}
%
%\begin{example}
%  \label{exm:graphicalZonotope}
%  The \defn{graphical zonotope}~$\Zono$ is the polytope defined as...
%  The graphical fan~$\graphicalFan$ is the normal fan of the graphical zonotope~$\Zono$.
%  \vincent{todo. Be careful with the translation part...}
%\end{example}
%
%We consider the following polytope which is sandwiched between the permutahedron and the graphical zonotope.

\begin{definition}
  \vincent{We could even delete $\Pi(\spine)$ and use~$\monombinom{\vertexSet}$ and notations~$\peaks[(\spine,p)]$ instead...}
  For a maximal spine~$\spine$ on~$\decoratedGraph$, we denote by~$\Pi(\spine)$ the set of (undirected and simple) paths joining two (possibly identical) nodes of~$\spine$.
  For a path~$\pi \in \Pi(\spine)$, we denote by
  \begin{itemize}
    \item $\boundary$ the set of endpoints of~$\pi$, % and $\weight_\pi$ the weight~$\weight_{\boundary}$, 
    \item $\peaks$ (resp.~$\valleys$) the set of \defn{peaks} (resp.~\defn{valleys}) of~$\pi$, \ie nodes~$u$ of~$\pi$ where no outgoing (resp. incoming) arc of~$u$ is used by~$\pi$.
  \end{itemize}
\end{definition}

\begin{theorem}
  \label{thm:permutreehedra}
  For any weight matrix~$\weight$, the spine fan~$\spineFan$ is the normal fan of the \defn{spine polytope}~$\Spin$ defined irredundantly and equivalently as
  \begin{enumerate}[(i)]
    \item the convex hull of the points~$\point \eqdef \sum_{\pi \in \Pi(\spine)} \weight_{\boundary} \big( \one_{\peaks} - \one_{\valleys \ssm \boundary} \big)$ for all maximal spines~$\spine$~on~$\decoratedGraph$,
    \item the intersection of the affine hyperplane~$\Hyp \eqdef \bigset{\b{z} \in \R^{\vertexSet}}{\dotprod{\one}{\b{z}} = \weight_{\vertexSet}}$ with the affine halfspaces~$\HS_{\chunk} \eqdef \bigset{\b{z} \in \R^{\vertexSet}}{\dotprod{\one_{\chunk}}{\b{z}} \ge \weight_{\chunk}}$ for all chunks~$\chunk$ of~$\decoratedGraph$.
%    \item the intersection of the hyperplane~$\Hyp$ with the halfspaces~$\HS_{\chunk}$ for all chunks of~$\decoratedGraph$.
  \end{enumerate}
\end{theorem}

\begin{figure}
  \centerline{
  \scalebox{.7}{
  \begin{tikzpicture}[xscale=4, yscale=4]
    \node (NN) at (0,0) {\input{pathNN}};
    \node (NU) at (-.5,1) {\input{pathNU}};
    \node (ND) at (-1.5,1) {\input{pathND}};
    \node (NB) at (-2.5,2) {\input{pathNB}};
    \node (UN) at (1.5,1) {\input{pathUN}};
    \node (UU) at (1.5,2) {\input{pathUU}};
    \node (UD) at (-.5,2) {\input{pathUD}};
    \node (UB) at (-.5,3) {\input{pathUB}};
    \node (DN) at (.5,1) {\input{pathDN}};
    \node (DU) at (.5,2) {\input{pathDU}};
    \node (DD) at (-1.5,2) {\input{pathDD}};
    \node (DB) at (-1.5,3) {\input{pathDB}};
    \node (BN) at (2.5,2) {\input{pathBN}};
    \node (BU) at (1.5,3) {\input{pathBU}};
    \node (BD) at (.5,3) {\input{pathBD}};
    \node (BB) at (0,4) {\input{pathBB}};
    \draw (NN.north)--(NU.south);
    \draw (NN.north)--(ND.south);
    \draw (NN.north)--(UN.south);
    \draw (NN.north)--(DN.south);
    \draw (NU.north)--(NB.south);
    \draw (NU.north)--(UU.south);
    \draw (NU.north)--(DU.south);
    \draw (ND.north)--(NB.south);
    \draw (ND.north)--(UD.south);
    \draw (ND.north)--(DD.south);
    \draw (UN.north)--(BN.south);
    \draw (UN.north)--(UU.south);
    \draw (UN.north)--(UD.south);
    \draw (DN.north)--(BN.south);
    \draw (DN.north)--(DU.south);
    \draw (DN.north)--(DD.south);
    \draw (NB.north)--(UB.south);
    \draw (NB.north)--(DB.south);
    \draw (BN.north)--(BU.south);
    \draw (BN.north)--(BD.south);
    \draw (UU.north)--(UB.south);
    \draw (UU.north)--(BU.south);
    \draw (UD.north)--(UB.south);
    \draw (UD.north)--(BD.south);
    \draw (DU.north)--(DB.south);
    \draw (DU.north)--(BU.south);
    \draw (DD.north)--(DB.south);
    \draw (DD.north)--(BD.south);
    \draw (UB.north)--(BB.south);
    \draw (DB.north)--(BB.south);
    \draw (BU.north)--(BB.south);
    \draw (BD.north)--(BB.south);
  \end{tikzpicture}
  }}
  \caption{The spine polytopes of the path. Figure adapted from~\cite[Fig.~16]{PilaudPons-permutrees}.}
  \label{fig:spinePolytopesPath}
\end{figure} 

\begin{figure}
  \centerline{
  \begin{tabular}{c@{}c@{\quad}c@{}c}
    \input{pathNN} &
    \input{pathNU} &
    \input{pathND} &
    \input{pathNB} \\[1.5cm]
    \input{pathUN} &
    \input{pathUU} &
    \input{pathUD} &
    \input{pathUB} \\[1.5cm]
    \input{pathDN} &
    \input{pathDU} &
    \input{pathDD} &
    \input{pathDB} \\[1.5cm]
    \input{pathBN} &
    \input{pathBU} &
    \input{pathBD} &
    \input{pathBB}
  \end{tabular}
  }
  \caption{The spine polytopes of the path.}
  \label{fig:spinePolytopesPath}
\end{figure} 

\begin{figure}
  \centerline{
  \begin{tabular}{c@{}c@{\quad}c@{\hspace{-1cm}}c}
    \input{star1} &
    \input{star2} &
    \input{star3} &
    \input{star4}
  \end{tabular}
  }
  \caption{The spine polytopes of the star.}
  \label{fig:spinePolytopesStar}
\end{figure} 

Our proof of \cref{thm:permutreehedra} is based on the following result of C.~Hohlweg, C.~Lange, and H.~Thomas~\cite{HohlwegLangeThomas}.

\begin{theorem}[\protect{\cite[Thm.~4.1]{HohlwegLangeThomas}}]
  \label{thm:HohlwegLangeThomas}
  Given an essential complete simplicial fan~$\c{F}$ in~$\R^d$, consider a point~$\b{a}_C$ of~$\R^d$ for each chamber~$C$ of~$\c{F}$ and a halfspace~$\HS[]_\rho$ of~$\R^d$ for each ray~$\rho$ of~$\c{F}$ supported by a hyperplane~$\Hyp[]_\rho$ orthogonal to~$\rho$.
  If 
  \begin{itemize}
%    \item for each ray~$\rho$, the halfspace~$\HS[]_\rho$ contains the origin and is supported by a hyperplane~$\Hyp[]_\rho$ orthogonal to~$\rho$,
    \item for each ray~$\rho$ in a chamber~$C$, the point $\b{a}_C$ is contained in the hyperplane~$\Hyp[]_\rho$, and
    \item for each pair~$C,C'$ of adjacent chambers of~$\c{F}$, the vector~$\b{a}_C - \b{a}_{C'}$ points from~$C'$ to~$C$,
  \end{itemize}
  then the descriptions
  \[
    \conv\set{\b{a}_C}{C \text{ chamber of } \c{F}}
    \qquad\text{and}\qquad
    \bigcap_{\rho \text{ ray of } \c{F}} \HS[]_\rho
  \]
  are irredundant and define the same polytope whose normal fan is~$\c{F}$.
  \qed
\end{theorem}

Our next two lemmas prove that the two conditions of \cref{thm:HohlwegLangeThomas} are fulfilled by the points and halspaces of \cref{thm:permutreehedra}.

\begin{lemma}
  \label{lem:vertexFacetIncidences}
  We have~$\dotprod{\one}{\point} = \weight_{\vertexSet}$ and $\dotprod{\one_{\so[\gamma]}}{\point} = \weight_{\so[\gamma]}$ for all arcs~$\gamma$ of~$\spine$.
\end{lemma}

\begin{proof}
  Along any path~$\pi$, the peaks and valleys alternate, so that~$\dotprod{\one}{\one_{\peaks} - \one_{\valleys \ssm \boundary}} = 1$.
  This shows that~$\dotprod{\one}{\point} = \sum_{\pi \in \Pi(\spine)} \weight_{\boundary} = \weight_{\vertexSet}$ since any two vertices of~$\vertexSet$ are connected by precisely one simple path in~$\spine$.
  
  Consider now an arc~$\gamma$ of~$\spine$.
  Again, the peaks and valleys alternate along any path~$\pi$.
  Moreover, if~$\pi$ contains~$\gamma$, then the closest node to~$\gamma$ in~$\peaks \cup \valleys$ in~$\so[\gamma]$ (resp.~in~$\ta[\gamma]$) is a valley (resp.~a peak).
  Hence, $\dotprod{\one_{\so[\gamma]}}{\one_{\peaks} - \one_{\valleys \ssm \boundary}} = 1$ if~$\gamma$ is included in~$\so[\gamma]$ and~$0$ otherwise.
  We conclude that~$\dotprod{\one_{\so[\gamma]}}{\point} = \sum_{\pi \in \Pi(\spine), \; \boundary \subseteq \so[\gamma]} \weight_{\boundary} = \weight_{\vertexSet}$ since any two vertices of~$\so[\gamma]$ are connected by precisely one simple path in~$\spine$.
\end{proof}

\begin{lemma}
  \label{lem:flipDifference}
  If~$\spine$ and~$\spine'$ are two maximal spines on~$\decoratedGraph$ such that~$\spine'$ is obtained from~$\spine$ by flipping an arc joining node~$x$ to node~$y$, then the difference~$\point[\spine] - \point[\spine']$ is a positive multiple of~$\b{e}_x - \b{e}_y$.
\end{lemma}

\begin{proof}
  Let~$A_x$ (resp.~$B_x$) denote the union of the source (resp.~target) sets of the arcs which are incoming to~$x$ (resp.~outgoing from~$x$) in both~$\spine$ and~$\spine'$, and define similarly~$A_y$ (resp.~$B_y$).
  Let~$u,v \in \vertexSet$ and denote by~$\pi$ (resp.~$\pi'$) the path in~$\spine$ (resp.~$\spine'$) joining~$u$ to~$v$.
  Observe that the paths~$\pi$ and~$\pi'$ have the same peaks and valleys, except if
  \begin{itemize}
    \item $u \in A_x$ and~$v \in \{y\} \cup A_y$, then $x \in \peaks[\pi'] \ssm \peaks[\pi]$ while~$y \in \peaks[\pi] \ssm \peaks[\pi']$,
    \item $u \in A_x$ and~$v \in B_y$, then $x \in \peaks[\pi'] \ssm \peaks[\pi]$ while~$y \in \valleys[\pi'] \ssm \valleys[\pi]$,
    \item $u \in \{x\} \cup B_x$ and~$v \in \{y\} \cup A_y$, then $x \in \valleys[\pi] \ssm \valleys[\pi']$ while~$y \in \peaks[\pi] \ssm \peaks[\pi']$,
    \item $u \in \{x\} \cup B_x$ and~$v \in B_y$, then $x \in \valleys[\pi] \ssm \valleys[\pi']$ while~$y \in \valleys[\pi'] \ssm \valleys[\pi]$.
  \end{itemize}
  We thus obtain that
  \(
    \point[\spine] - \point[\spine'] = \weight_{X \times Y} (\b{e}_x - \b{e}_y)
  \)
  where~$\weight_{X \times Y}$ denotes the sum of the weights of the pairs formed by an element of~$X \eqdef \{x\} \cup A_x \cup B_x$ and an element of~$Y \eqdef \{y\} \cup A_y \cup B_y$.
  Finally, we observe that~$\weight_{X \times Y} \ge \weight_{\{x,y\}} > 0$ by our positivity assumption on the weight function.
\end{proof}

\begin{proof}[Proof of \cref{thm:permutreehedra}]
  For the spine polytope of \cref{thm:permutreehedra}, the conditions of \cref{thm:HohlwegLangeThomas} are guarantied by~\cref{lem:vertexFacetIncidences,lem:flipDifference}.
  It follows that the spine polytope~$\Spin$ realizes the chunk nested complex~$\nestedComplex$ and that its normal fan is the spine fan~$\spineFan$.
\end{proof}

%\begin{example}
%  \label{exm:permutahedronGraphicalZonotope}
%  The spine polytope~$\Spin$ recovers the permutahedron~$\Perm$ of \cref{exm:permutahedron} and the graphical zonotope~$\Zono$ of \cref{exm:graphicalZonotope} in the following two extreme situations:
%  \begin{itemize}
%    \item if~$\Down[\vertexSet] = \Up[\vertexSet] = \varnothing$, then the spine polytope~$\Spin$ is the permutahedron~$\Perm$,
%    \item if~$\Down[\vertexSet] = \Up[\vertexSet] = \vertexSet$, then the spine polytope~$\Spin$ is the graphical zonotope~$\Zono$.
%  \end{itemize}
%\end{example}

\begin{example}
  \label{exm:spinePolytopes}
  For instance, the spine polytope is:
  \begin{enumerate}[(i)]
    \item the classical \defn{permutahedron}~$\Perm$ when~$\decoratedGraph$ is complete or undecorated.
    \item the \defn{graph associahedron} of~$\Graph$ studied in~\cite{CarrDevadoss, Devadoss, Postnikov, FeichtnerSturmfels, Zelevinsky, Pilaud-removahedra} when~$\decoratedGraph$ is down decorated (in particular the classical \defn{associahedron} of~\cite{ShniderSternberg, Loday} when~$\decoratedGraph$ is a down decorated~path).
    \item the \defn{graphical zonotope}~$\Zono$ when~$\decoratedGraph$ is fully decorated (in particular a \defn{parallelepiped} when~$\decoratedGraph$ is a fully decorated tree).
    \item the various \defn{permutreehedra} of~\cite{PilaudPons-permutrees} when~$\Graph$ is a path (in particular the various \defn{associahedra} of~\cite{HohlwegLange, LangePilaud} for up-down decorated paths).
  \end{enumerate}
\vincent{toy example and low-dimensional examples.}
\end{example}

\begin{remark}
  \label{rem:irrelevantDecorationsSpinePolytopes}
  Using the notations of \cref{rem:irrelevantDecorations}, note that the spine polytopes on~$\decoratedGraph$, on $\decoratedGraph^\star$ and on~$\decoratedGraph^\#$ are precisely the same.
\end{remark}

\begin{proposition}
  \label{prop:refinementSpinePolytopes}
  If~$\decoratedGraph_\circ$ refines~$\decoratedGraph_\bullet$, then all facet inequalities of~$\Spin[\decoratedGraph_\bullet]$ are facet inequalities of~$\Spin[\decoratedGraph_\circ]$.
  In particular, the spine polytope~$\Spin$ contains the permutahedron~$\Perm$ and is contained in the graphical zonotope~$\Zono$.
\end{proposition}

\begin{proof}
  By \cref{prop:refinementChunks}, all chunks of~$\decoratedGraph_\bullet$ are chunks of~$\decoratedGraph_\circ$, so that the facet defining inequalities of~$\Spin[\decoratedGraph_\bullet]$ are facet inequalities of~$\Spin[\decoratedGraph_\circ]$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Further geometric properties}
\label{subsec:furtherGeometricProperties}

\subsubsection{Faces}

\begin{proposition}
  \label{prop:faces}
  Any face of the spine polytope~$\Spin$ is a Cartesian product of spine polytopes.
  \vincent{Is it true here or only in the next section?}
\end{proposition}

\begin{proof}
  \vincent{todo}
\end{proof}

\subsubsection{Spine poset as orientation of the spine polytope}

\subsubsection{Parallel facets}

\subsubsection{Common vertices}

\subsubsection{Isometry classes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Loday's weights}
\label{subsec:Loday}

\begin{definition}
  \label{def:LodayWeights}
  Let~$\Maple$ be a maple tree with blue vertices~$\vertexSet$ and red vertices~$\cliqueSet$.
  Fix~$\theta_w > 0$ for~$w \in \cliqueSet$.
  The \defn{$\theta$-weights} are defined by~$\weight_{x,y} = \big( \sum_s \theta_s \big) \cdot \big( \sum_t \theta_t \big)$ where the first (resp.~second) sum ranges over all neighbors~$s$ of~$x$ (resp.~$t$ of~$y$) in~$\Maple$ which are not on the induced path joining~$x$ to~$y$.
  \vincent{This formulation is slightly incorrect.}
\end{definition}

\vincent{Here, the transformation~$\decoratedGraph^\#$ of \cref{rem:irrelevantDecorations} also needs to modify~$\theta$ additively.}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Algebra: dioperad structure}
\label{sec:algebra}

\vincent{Restriction}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Recollections}

Let $C$ be a set. 

\begin{definition} A $C$-colored $(\mathbb{S},\mathbb{S})$-module is a family of $(\mathbb{S}_k,\mathbb{S}_l)$-modules $\dioperad(c_1,\ldots,c_k;c_1',\ldots,c_l')$, indexed by the ordered pairs of non-empty ordered sequences $c_1,\ldots,c_k$ and $c_1',\ldots,c_l'$ of elements of $C$.
\end{definition}

\begin{definition}[Dioperad]
A $C$-colored dioperad is a $C$-colored $(\mathbb{S},\mathbb{S})$-module $\dioperad$ together with partial compositions 
\[
\prescript{}{j}{\circ}^{}_i : \dioperad(c_1,\ldots,c_k;d_1,\ldots,d_l) \otimes \dioperad(c_1',\ldots,c_p';d_1',\ldots,d_q') 
\]
\[
\longrightarrow \dioperad(c_1,\ldots,c_{i-1},c_1',\ldots,c_p',c_{i+1},\ldots c_k;d_1,\ldots,d_{j-1},d_1',\ldots,d_q',d_{j+1},\ldots,d_l)
\]
whenever $c_i=d_j'$, and units $id_x \in \dioperad(x;x)$ which satisfy appropriate unity, equivariance and associativity axioms, see \cite[Def.~11.18]{YauJohnson15}. 
\end{definition}

\guillaume{Equivalently, a dioperad is a monoid in ..., or an algebra over the monad of directed trees... }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Dioperadic structures}

In this section, every time we say maple tree, we mean a maple tree $\Maple$ with the following extra data:
\begin{enumerate}
  \item Half-edges attached to the red vertices of $\Maple$ such that every red vertex has valency at least 2;
  \item A planar structure, and the choice of a root half-edge, such that the set of half-edges, as well as the set of (half-)edges attached to a given red vertex, inherits the canonical clockwise total order.
\end{enumerate}
The blue vertex set $V$ inherits a natural numbering by $1,\ldots,|\vertexSet|$, obtained by starting at the root and going around $\Maple$ in the clockwise direction, numbering a vertex the first time we see it. 
We will consider only blossoming spines on $\Maple$, and refer to them as spines. 

\begin{definition}[Block]
  Let $\decoratedMaple$ be a decorated maple tree, with blue vertex set $\vertexSet$. 
  \vincent{We have to change maple tree to decorated maple trees.}
  A \emph{block} $B$ of $\Maple$ is a (possibly empty) node of a spine $S$ on $\Maple$ which has been cut off from $\Maple$. \guillaume{dessin} 
  \vincent{Are these blocks or chunks or something else?}
\end{definition}

Note that the same block can be obtained from different spines. 
For an incoming or outgoing arc $\gamma$ of $B$, we define $\so[\gamma]$ and $\ta[\gamma]$ to be the source and targets sets of $\gamma$ in any spine $S$ from which $B$ is obtained (this is independent of the choice of $S$ \guillaume{justifier?}). 
We denote the set of incoming (resp. outgoing) edges of $B$ by $i(B)$ (resp. $o(B)$).  
In the case where $B$ is empty, we set $i(B)=o(B)$. 

Let $C$ be the set of ordered pairs of subsets of $V$ which form a partition of $V$.
We consider the following $C$-colored collection:

\[
\dioperad_{\decoratedMaple}(x_1,\ldots,x_k;y_1,\ldots,y_l)=
\mathbb{K}\left\{
\begin{array}{cl}
\text{Block } B \text{ of } \Maple \text{ with two bijections }  \\
\sigma : [k] \to i(B) \text{ and } \tau : [l] \to o(B) \text{ such that }\\
x_i=(\so[\sigma(i)],\ta[\sigma(i)]) \text{ and } y_j=(\so[\tau(j)],\ta[\tau(j)]) \text{ for all } i,j  
\end{array} 
\right\} 
\]
Precomposition of $\sigma$ and $\tau$ with other permutations makes $\dioperad_{\decoratedMaple}$ into a $(\mathbb{S},\mathbb{S})$-module. 

\begin{lemma}
  Each space $\dioperad_{\decoratedMaple}(x_1,\ldots,x_k;y_1,\ldots,y_l)$ is either zero or one-dimensional. 
\end{lemma}
\vincent{The space $\dioperad_{\decoratedMaple}(x_1,\ldots,x_k;y_1,\ldots,y_l)$ is one-dimensional if $x_i \negDisjoint x_{i'}$, $y_j \posDisjoint y_{j'}$ and~$x_i \subseteq y_j$ for any~$i \ne i' \in [k]$ and $j \ne j' \in [\ell]$, and zero-dimensional otherwise.}

\begin{proof} This follows from the definition of spine. \guillaume{justifier}
\end{proof}

\begin{definition}
Let $\sigma : [k] \to X$ and $\sigma' : [p] \to Y$ be two bijections, and let $i$ be in $[k]$. 
The \emph{partial composition} $\sigma \circ_i \sigma' : [k+p-1] \to (X \setminus \sigma(i))\sqcup Y$ of $\sigma$ and $\sigma'$ is the bijection
\[
\sigma \circ_i \sigma' (s)\coloneqq \left\{
\begin{array}{cll}
  \sigma(s) & \text{if}\  s<i \\
  \sigma'(s-i+1) & \text{if}\ i\leq s \leq i+p-1 \\
  \sigma(s-p+1)  & \text{if}\ i+p\leq s \leq k+p-1 \ .
\end{array} 
\right. 
\]
\end{definition}

\begin{definition}[Partial composition]
Let $x_1,\ldots,x_k,x_1',\ldots,x_p',y_1,\ldots,y_l,y_1',\ldots,y_q'$ be colors of $C$ and suppose that there exists an $i \in [k]$ and a $j \in [q]$ such that $x_i=y_j'$. 
We define the \emph{partial composition map}
\[\prescript{}{j}{\circ}^{}_i \ \  : \ \  
\dioperad_{\decoratedMaple}(x_1,\ldots,x_k;y_1,\ldots,y_l) \otimes \dioperad_{\decoratedMaple}(x_1',\ldots,x_p';y_1',\ldots,y_q') \]
\[\longrightarrow \dioperad_{\decoratedMaple}(x_1,\ldots,x_{i-1},x_1',\ldots,x_p',x_{i+1},\ldots,x_k;y_1,\ldots,y_{j-1},y_1',\ldots,y_q',y_{j+1},\ldots,y_l)\]
by sending the generators $(B,\sigma, \tau)$ and $(B',\sigma',\tau')$ to the block $B \prescript{}{j}{\circ}^{}_i B'$ equipped with the bijections $\sigma \circ_i \sigma'$ and $\tau \circ_j \tau'$.
This block is defined as follows.  
Let $S$ (resp. $S'$) be a spine on $\Maple$ which contains $B$ (resp. $B'$), and let $\gamma$ (resp. $\gamma'$) be the incoming arc such that $(\so[\gamma],\ta[\gamma])=x_i=y_j'=(\so[\gamma'],\ta[\gamma'])$. 
By the definition of the spine poset, there is a sequence of arcs contractions and node splitting transforming $S$ or $S'$ into a new spine $S''$ which has an arc $\gamma''$ with its source part equal to the source part of $\gamma'$ in $S'$, and its target part equal to the target part $\gamma$ in $S$. 
Now, contracting the arc $\gamma''$ in $S''$, we obtain a spine and a new block made up of the two nodes $B$ and $B'$, that we denote by $B \prescript{}{j}{\circ}^{}_i B'$.
\guillaume{well-defined?}
\end{definition}

Observe that the generators of the spaces $\dioperad_{\decoratedMaple}(x;x), x \in C$ are units for this partial composition.

\begin{proposition} 
\label{prop:dioperadstructure}
  For any maple tree $\Maple$, the preceding partial compositions and units endow the $(\mathbb{S},\mathbb{S})$-module $\dioperad_{\decoratedMaple}$ with a $C$-colored dioperad structure.
\end{proposition}

\begin{proof}
The unity and equivariance axioms are straightforward to verify. 
The associativity axioms are also satisfied, since the order in which edge contractions are performed in a spine is not important.
\guillaume{plus de d\'etails?}
\end{proof}

\begin{definition}[Extended maple tree]
  An \emph{extended maple tree} is a maple tree whose red vertices are decorated by commutative words made up of both letters ($a,b,c,\ldots$) and blue vertex labels ($\up[1],\down[2],\updown[3],4,\ldots$). 
\end{definition}

\begin{definition}[Extended source and target]
  For a spine $S$ on an extended maple tree, and $\gamma$ an arc of $S$, we include in the sets $\so[\gamma]$ and $\ta[\gamma]$ the blue vertex sets in the labels of blossoms in the corresponding components of $S\setminus \{\gamma\}$.
\end{definition}

\begin{definition}[Contraction subtree] 
Let $\Maple$ be a maple tree, and let $X \subset V$ be a subset of blue vertices. 
We denote by $\Maple_{/X}$ the extended maple tree obtained by removing the vertices of $X$ and contracting all the adjacent edges and red vertices to a single red vertex, decorated by both the removed vertices of $X$ and the labels of the adjacent red vertices. 
\guillaume{dessin}
\end{definition}

A non-trivial block $B$ of a maple tree $\Maple$ can now be interpreted as a trivial spine on the extended maple tree $\Maple_{/{B^c}}$, where $B^c\coloneqq V\setminus B$ is the complement of $B$ in $V$. 

\begin{definition}[Admissible maple tree]
  Let $\Maple$ be an extended maple tree. 
  An extended maple tree $\Maple'$ is said to be \emph{$\Maple$-admissible} if it can be obtained as the contraction subtree $\Maple_{/{B^c}}$ for some block $B$ on $\Maple$. 
\end{definition}

Let $\mathfrak{C}$ be the set of pairs of commutative words in the alphabet made up of letters $a,b,c,\ldots$ and decorated numbers $\up[1],\down[2],\updown[3],4,\ldots$
Any dioperad $\dioperad_{\decoratedMaple}$ becomes a $\mathfrak{C}$-colored dioperad \guillaume{by setting many spaces to zero}.

\begin{lemma}
  Let $\Maple$ and $\Maple'$ be two extended maple trees, and suppose that there is an $\Maple'$-admissible extended maple tree $\iota(\Maple)$ which is isomorphic to $\Maple$, has the same blue vertices, and such that the label of each of its red vertex contains the label of the corresponding red vertex of $\Maple'$ as a subword. 
  This tree isomorphisms induces an inclusion of $\mathfrak{C}$-colored dioperads
  \[
    \dioperad_{\decoratedMaple} \hookrightarrow \dioperad_{M'}\ .
  \]
\end{lemma}

\begin{proof}
  A few words.
\end{proof}

Consider the colimit over the diagram made up of all such dioperad inclusions
\[ \dioperad \coloneqq \colim_{\decoratedMaple} \dioperad_{\decoratedMaple} \ . \]
This is a $\mathfrak{C}$-colored dioperad (since this category is cocomplete \guillaume{justifier!!}), where all the extended version of the same (non-extended) maple tree are identified. 
The dioperad $\dioperad$ can be seen as 

\begin{proposition}
  The colored dioperad $\dioperad$ is Koszul, and Koszul self-dual. 
\end{proposition}

\begin{proof} 
  It is enough to prove the statement for each $\dioperad_{\decoratedMaple}$ separately \guillaume{? Si oui, justifier}. 
\end{proof}

\begin{remark}
  One could also also consider the totalization \[ \dioperad \coloneqq \bigoplus_{\decoratedMaple} \dioperad_{\decoratedMaple} \] which is a dioperad colored by pairs $(\Maple,c)$ made up of a maple tree and a color of $\mathfrak{C}$. 
\end{remark}

Let $\Maple$ be a maple tree, with blue vertex set $V$. 
A \emph{composite block} $B$ of $\Maple$ is a (possibly empty) subtree of a spine $S$ on $\Maple$ which has been cut off \guillaume{dessin}. 
Note that a single composite bloc can come from different spines. 
We denote the set of incoming (resp. outgoing) blossoms of $D$ by $i(D)$ (resp. $o(D)$).  
In the case where $D$ is empty, we set $i(D)=o(D)$. 
Let $C$ be the set of ordered pairs of subsets of $V$ which form a partition of $V$.
We consider the following $C$-colored collection:

\[
\dioperad^{\infty}_{\decoratedMaple}(x_1,\ldots,x_k;y_1,\ldots,y_l)=
\mathbb{K}\left\{
\begin{array}{cl}
\text{Generalized cell } D \text{ of } \Maple \text{ with two bijections }  \\
\sigma : [k] \to i(D) \text{ and } \tau : [l] \to o(D) \text{ such that }\\
x_i=(\so[\sigma(i)],\ta[\sigma(i)]) \text{ and } y_j=(\so[\tau(j)],\ta[\tau(j)]) \text{ for all } i,j  
\end{array} 
\right\} 
\]
Precomposition of $\sigma$ and $\tau$ with other permutations makes $\dioperad_{\decoratedMaple}$ into a $(\mathbb{S},\mathbb{S})$-module.

Partial compositions and units can be defined exactly as in the case of $\dioperad_{\decoratedMaple}$. 

\begin{proposition} 
  For any maple tree $\Maple$, the preceding partial compositions and units endow the $\dioperad^{\infty}_{\decoratedMaple}$ with a $C$-colored dioperad structure.
\end{proposition}

\begin{proof}
straightforward
\end{proof}

A generalized cell $D$ of $\Maple$ can be interpreted as a spine on the maple tree obtained by contracting the complement of $D$ in $\Maple$, where [...]
Any dioperad $\dioperad^{\infty}_{\decoratedMaple}$ becomes a $\mathfrak{C}$-colored dioperad \guillaume{by setting many spaces to zero}, and the totalization \[ \dioperad_{\infty} \coloneqq \bigoplus_{\decoratedMaple} \dioperad^{\infty}_{\decoratedMaple} \] becomes a dioperad colored by pairs $(\Maple,c)$ made up of a maple tree and a color of $\mathfrak{C}$. 

\begin{remark}
Dioperad inclusion morphisms (prove that this category is cocomplete), consider the colimit $\colim_{\decoratedMaple} \dioperad^{\infty}_{\decoratedMaple}$ [...]
\end{remark}

\begin{proposition}
  The colored dioperad $\dioperad_\infty$ is free on cells. 
\end{proposition}

\begin{proof} 
Grafting cells produce generalized cells. 
There is a unique way to write a generalized cell by iterating this process, up to the dioperad associativity axioms. 
So, this dioperad is free. 
\end{proof}

Now we turn $\dioperad_\infty$ into a differential graded (dg) colored dioperad. 
The differential is the unique derivation extending the map $\partial$, defined on cells by 
\[ \partial(D, \sigma, \tau) \coloneqq - \sum_{D'} \pm (D',\sigma,\tau) \ , \] 
where the sum runs over all the spines with 2 nodes $D'$ that contain $D$. 

\begin{proposition}
The dg colored dioperad $\dioperad_\infty$ is the minimal model $\Omega \dioperad^{\as}$ of $\dioperad$. 
\end{proposition}

\begin{proof} \guillaume{!!}
\end{proof}

\begin{remark} Cyclic versions of the objects considered in this section
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Topological cellular dioperad structure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Differential graded structures}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Tensor product}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix

\section{More combinatorics}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Nestings, tubings and Forcey-Ronco substitution on graph-associahedra}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Generalized tubings}

\vincent{I am not sure that this section will stay in the final version.}

Let~$\Maple$ be a maple tree and~$\Graph = (\vertexSet, \edgeSet)$ be the block graph obtained by tapping~$\Maple$.
There are four combinatorial models for the facets of a block graph permutreehedron:
\begin{enumerate}
  \item a \defn{rank~$1$ spine} on~$\Graph$, \ie a spine on~$\Graph$ with precisely two nodes,
  \item a \defn{maple subtree} of~$\Maple$, \ie a maple tree induced by a connected subset of~$\Maple$, or equivalently a connected component of $\Maple \ssm B$ for a subset~$B$ of blue vertices of~$\Maple$,
  \item a \defn{signed tube} of~$\Graph$, \ie a pair~$(\Down[Z], \Up[Z])$ of maple subtrees of~$\Maple$ such that $\partial \Down[Z] \subseteq \Down[Y] \cap \Up[Z]$ and $\partial \Up[Z] \subseteq \Up[Y] \cap \Down[Z]$,
  \item a \defn{signed biconvex subset} of~$\Graph$, \ie a subset~$Y$ of vertices of~$\Graph$ which is positive convex and whose complement is negative convex. This is also what we called splittable partition.
\end{enumerate}
We can read the spine complex on these 4 models.









\section*{Acknowledgments}

CRM in Barcelona 

\bibliographystyle{alpha}
\bibliography{blockgraph}
\label{sec:biblio}

\end{document}