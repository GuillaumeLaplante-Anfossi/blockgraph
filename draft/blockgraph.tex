\documentclass{amsart}

\usepackage[T1]{fontenc}
\usepackage{amsmath, amsfonts, amssymb, amsthm, mathrsfs, wasysym, graphics, graphicx, xcolor, url, hyperref, hypcap, xargs, multicol, pdflscape, multirow, hvfloat, array, ae, aecompl, pifont, mathtools, a4wide, float, blkarray, overpic, nicefrac}
\usepackage[shortlabels, inline]{enumitem}%shortlabels to have same syntax as enumerate package, inline gives inline option with *
\usepackage{bbm}%allows for \mathbbm{1}
\usepackage[noabbrev,capitalise]{cleveref}
\usepackage[normalem]{ulem}
\usepackage{marginnote}
\hypersetup{colorlinks=true, citecolor=darkblue, linkcolor=darkblue}
\usepackage[all]{xy}
\usepackage{tikz}
\usepackage{tikz-cd}
%\usepackage{tkz-graph}
\usetikzlibrary{trees, decorations, decorations.pathmorphing, decorations.markings, decorations.shapes, shapes, arrows, matrix, calc, fit, intersections, patterns, angles}
\graphicspath{{figures/}{figures/diagonals/}{figures/walks/}{figures/tubes/}{figures/blocks/}}
\makeatletter\def\input@path{{figures/}}\makeatother
\usepackage{caption}
\captionsetup{width=\textwidth}
\usepackage[export]{adjustbox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% STANDARD

% theorems
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem*{theorem*}{Theorem}%[section]

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{question}[theorem]{Question}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{convention}[theorem]{Convention}

\crefname{equation}{Equation}{Equations}

% math special letters
\newcommand{\R}{\mathbb{R}} % reals
\newcommand{\Q}{\mathbb{Q}} % rationals
\newcommand{\N}{\mathbb{N}} % naturals
\newcommand{\Z}{\mathbb{Z}} % integers
\newcommand{\C}{\mathbb{C}} % complex
\newcommand{\I}{\mathbb{I}} % set of integers
\newcommand{\HH}{\mathbb{H}} % hyperplane
\newcommand{\K}{k} % field
\newcommand{\bb}[1]{{\mathbb{#1}}} % mathbb letters
\newcommand{\f}[1]{{\mathfrak{#1}}} % mathfrak letters
\renewcommand{\c}[1]{{\mathcal{#1}}} % call letters
\renewcommand{\b}[1]{{\boldsymbol{#1}}} % bold letters
\newcommand{\h}{\widehat} % hat letters

% math commands
\newcommand{\set}[2]{\left\{ #1 \;\middle|\; #2 \right\}} % set notation
\newcommand{\bigset}[2]{\big\{ #1 \;\big|\; #2 \big\}} % big set notation
\newcommand{\Bigset}[2]{\Big\{ #1 \;\Big|\; #2 \Big\}} % Big set notation
\newcommand{\setangle}[2]{\left\langle #1 \;\middle|\; #2 \right\rangle} % set notation
\newcommand{\ssm}{\smallsetminus} % small set minus
\newcommand{\dotprod}[2]{\langle \, #1 \; | \; #2 \, \rangle} % dot product
\newcommand{\bigdotprod}[2]{\big\langle \, #1 \; \big| \; #2 \, \big\rangle} % dot product
\newcommand{\symdif}{\,\triangle\,} % symmetric difference
\newcommand{\one}{\mathbbm{1}} % the all one vector
\newcommandx{\ones}[1][1=n]{\one_{#1}} % the all one vector of length n
\newcommand{\eqdef}{\mbox{\,\raisebox{0.2ex}{\scriptsize\ensuremath{\mathrm:}}\ensuremath{=}\,}} % :=
\newcommand{\defeq}{\mbox{~\ensuremath{=}\raisebox{0.2ex}{\scriptsize\ensuremath{\mathrm:}} }} % =:
\newcommand{\simplex}{\triangle} % simplex
\renewcommand{\implies}{\Rightarrow} % imply sign
\newcommand{\transpose}[1]{{#1}^T} % transpose matrix
\newcommand{\truth}[1]{\left[ #1 \right]} % truth (kronecker delta)

% operators
\DeclareMathOperator{\conv}{conv} % convex hull
\DeclareMathOperator{\vect}{vect} % linear span
\DeclareMathOperator{\cone}{cone} % cone hull

% others
\newcommand{\ie}{\textit{i.e.}~} % id est
\newcommand{\eg}{\textit{e.g.}~} % exempli gratia
\newcommand{\Eg}{\textit{E.g.}~} % exempli gratia
\newcommand{\apriori}{\textit{a priori}} % a priori
\newcommand{\viceversa}{\textit{vice versa}} % vice versa
\newcommand{\versus}{\textit{vs.}~} % versus
\newcommand{\aka}{\textit{a.k.a.}~} % also known as
\newcommand{\perse}{\textit{per se}} % per se
\newcommand{\ordinal}{\textsuperscript{th}} % th for ordinals
\newcommand{\ordinalst}{\textsuperscript{st}} % st for ordinals
\definecolor{darkblue}{rgb}{0,0,0.7} % darkblue color
\definecolor{green}{RGB}{57,181,74} % green color
\definecolor{violet}{RGB}{147,39,143} % violet color
\newcommand{\red}{\color{red}} % red command
\newcommand{\blue}{\color{blue}} % blue command
\newcommand{\orange}{\color{orange}} % orange command
\newcommand{\green}{\color{green}} % green command
\newcommand{\darkblue}{\color{darkblue}} % darkblue command
\newcommand{\defn}[1]{\textsl{\darkblue #1}} % emphasis of a definition
\newcommand{\para}[1]{\medskip\noindent\uline{\textit{#1.}}} % paragraph
\renewcommand{\topfraction}{1} % possibility to have one page of pictures
\renewcommand{\bottomfraction}{1} % possibility to have one page of pictures
\newcommand{\shade}[1]{{\color{cyan} #1}}

% marginal comments
\usepackage{todonotes}
\newcommand{\guillaume}[1]{\todo[color=orange!30]{#1 --- G.}}
\newcommand{\vincent}[1]{\todo[color=blue!30]{#1 \\ \hfill --- V.}}

% formating the part command
\makeatletter
\def\part{\@startsection{part}{1}%
\z@{.7\linespacing\@plus\linespacing}{.8\linespacing}%
{\LARGE\sffamily\centering}}
%\@addtoreset{section}{part}
\makeatother
\renewcommand{\thepart}{\Roman{part}}
%\renewcommand{\thesection}{\arabic{part}.\arabic{section}}

% formating the table of contents
\setcounter{tocdepth}{4}
\makeatletter
\def\l@section{\@tocline{1}{5pt}{0pc}{}{}}
\makeatother
\let\oldtocpart=\tocpart
\renewcommand{\tocpart}[2]{\sc\large\oldtocpart{#1}{#2}}
\let\oldtocsection=\tocsection
\renewcommand{\tocsection}[2]{\bf\oldtocsection{#1}{#2}}
\let\oldtocsubsubsection=\tocsubsubsection
\renewcommand{\tocsubsubsection}[2]{\quad\oldtocsubsubsection{#1}{#2}}

% drapeau europÃ©en
\usepackage{graphicx,calc}
\newlength\myheight
\newlength\mydepth
\settototalheight\myheight{Xygp}
\settodepth\mydepth{Xygp}
\setlength\fboxsep{0pt}
\newcommand*\inlinegraphics[1]{%
  \settototalheight\myheight{Xygp}%
  \settodepth\mydepth{Xygp}%
  \raisebox{-\mydepth}{\includegraphics[height=\myheight]{#1}}%
}

% SPECIFIC BLOCK GRAPH PERMUTREES

% COMBINATORICS

% decorations
\newcommandx{\up}[1][1=v]{\overline{#1}} 
\newcommandx{\down}[1][1=v]{\underline{#1}} 
\newcommandx{\updown}[1][1=v]{\overline{\underline{#1}}} 
% source and target
\newcommandx{\so}[1][1=i]{\textsc{s}(#1)} % source set
\newcommandx{\ta}[1][1=o]{\textsc{t}(#1)} % target set
% spines
\newcommandx{\spine}[1][1=S]{#1} % spine
\newcommandx{\spines}[1][1=G]{\mathcal{S}(#1)} % set of spines
\newcommandx{\maxspines}[1][1=G]{\mathcal{MS}(#1)} % maximal spines
% nested complex
\newcommandx{\nested}[1][1=N]{#1} % nested set
\newcommand{\negNested}{\preceq} % negative nested
\newcommand{\posNested}{\succeq} % positive nested
\newcommand{\negDisjoint}{\perp} % negative disjoint
\newcommand{\posDisjoint}{\;\top\;} % positive disjoint
\newcommand{\compl}[1]{#1{}^\textsc{c}} % complement
% maps
\newcommand{\spineToNested}{\mathsf{N}} % spine to nested set
\newcommand{\nestedToSpine}{\mathsf{S}} % nested set to spine

% GEOMETRY

% fans
\newcommandx{\Fan}[1][1=F]{\mathcal{#1}} % fan
\newcommandx{\ray}[1][1=r]{\b{#1}} % ray
\newcommandx{\rays}[1][1=R]{\b{#1}} % rays
\newcommand{\walls}{\b{W}} % walls
% polytopes
\newcommand{\polytope}[1]{\mathsf{#1}} % font polytopes
\newcommandx{\Perm}[1][1=n]{\polytope{Perm}_{#1}} % permutahedron
\newcommandx{\Asso}[2][1=n,2={}]{\polytope{Asso}^{#2}(#1)} % associahedron
\newcommandx{\Nest}[2][1=\building,2={}]{\polytope{Nest}^{#2}(#1)} % associahedron
% \newcommandx{\Zono}[2][1=n,2={}]{\mathsf{Zono}^{#2}(#1)} % zonotope

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Block graph permutreehedra}

\author{Guillaume Laplante-Anfossi}
\address[Guillaume Laplante-Anfossi]{Universit\'e Sorbonne Paris Nord, Laboratoire Analyse, G\'eom\'etrie et Applications, CNRS, UMR 7539, F-93430 Villetaneuse, France}
\email{laplante-anfossi@math.univ-paris13.fr}
\urladdr{\url{https://www.math.univ-paris13.fr/~laplante-anfossi/}}

\author{Vincent Pilaud}
\address[Vincent Pilaud]{CNRS \& LIX, \'Ecole Polytechnique, Palaiseau}
\email{vincent.pilaud@lix.polytechnique.fr}
\urladdr{\url{http://www.lix.polytechnique.fr/~pilaud/}}

%\date{\today}

\subjclass[2010]{Primary 52B11; Secondary 18M70} 

%\keywords{Polytopes...}

\thanks{The first author was supported by the European Union's Horizon 2020 research and innovation program under the Marie Sklodowska-Curie grant agreement No 754362 \inlinegraphics{EU.png}, by the Natural Sciences and Engineering Research Council of Canada (NSERC) and by the ANR-20-CE40-0016 Higher Algebra, Geometry and Topology. The second author is supported by the French ANR grants CAPPS~17\,CE40\,0018, and CHARMS~19\,CE40\,0017.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\begin{abstract}
TBC
\end{abstract}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Introduction}

Common generalization of \cite{PilaudSignedTree13,LangePilaud13,PonsPilaud18,LA21}.
It is the maximal generalization, according to \cite{Pilaud14}.

\subsection*{Conventions} We write $[n] \eqdef \{1,\ldots,n\}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Combinatorics: the spine complex}

\guillaume{Exemples a suivre tout au long du texte: 1) chemin decore 2) que des down 3) un exemple "generique" de notre cru.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Maple trees and block graphs}

\begin{definition}
  A \defn{maple tree} is a tree whose vertices are properly colored (\ie no monochromatic edge) in red and blue such that all leaves are red.
  The \defn{tapping} of a maple tree consists in replacing each red vertex by a clique on its blue neighbors.
\end{definition}

\begin{definition}
  \label{def:blockgraph}
  A \defn{block graph} is a connected graph~$G$ satisfying any of the following equivalent conditions:
  \begin{enumerate}
    \item Every biconnected component of~$G$ is a clique.
    \item Any cycle in~$G$ induces a clique.
    \item The intersection of two connected subgraphs of~$G$ is a connected subgraph of~$G$.
    \item The intersection of two paths in~$G$ induces a path in~$G$.
    \item There is a unique induced path connecting every pair of vertices.
    \item The graph~$G$ is obtained by tapping a maple tree.
  \end{enumerate}
\end{definition}

Note that a block graph is obtained by tapping different maple trees. For instance, one can arbitrarily add red leaves to the blue vertices.

For convenience, in a maple tree, we label the blue vertices by digits (or numbers) and the red vertices by letters (or words).
Consequently, in a block graph, we label the vertices by digits (or numbers) and the cliques by letters (or words).
In this paper, we consider the following additional decorations.

\begin{definition}
  A \defn{decorated} maple tree (resp.~block graph) is a maple tree where each blue vertex~$v$ (resp.~each vertex~$v$) is decorated as~$v, \up, \down$ or~$\updown$.
  For a subset~$V$ of vertices, we denote by~$\up[V]$ the set of vertices~$\up$ and~$\updown$ of~$V$, and by~$\down[V]$ the set of vertices~$\down$ and~$\updown$ of~$V$
\end{definition}

\begin{figure}
\resizebox{\linewidth}{!}{
\begin{tikzpicture}

\node (1) at (-4, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 1$};
\node (4) at (-4, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 4$};
\node (5) at (-2, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue \up[5]$};
\node (7) at (-4, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue \down[7]$};
\node (8) at (0, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 8$};
\node (9) at (2, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue \up[9]$};
\node (6) at (2, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 6$};
\node (2) at (0, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue \updown[2]$};
\node (3) at (2, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 3$};

\node (f) at (0, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red f$};
\node (d) at (-3, -20) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red d$};
\node (a) at (-5, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red a$};
\node (e) at (-5, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red e$};
\node (i) at (-5, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red i$};
\node (h) at (-3, -22) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red h$};
\node (j) at (1, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red j$};
\node (k) at (3, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red k$};
\node (g) at (3, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red g$};
\node (b) at (1, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red b$};
\node (c) at (3, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\red c$};
  
\draw[-] (a)--(1)--(d)--(4)--(e); 
\draw[-] (d)--(5)--(h)--(7)--(i); 
\draw[-] (5)--(f)--(6)--(g); 
\draw[-] (c)--(3)--(b)--(2)--(f)--(8)--(j)--(9)--(k); 

\end{tikzpicture}
\quad
\quad
\quad
\begin{tikzpicture}

  \node (1) at (-4, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 1$};
  \node (4) at (-4, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 4$};
  \node (5) at (-2, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue \up[5]$};
  \node (7) at (-4, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue \down[7]$};
  \node (8) at (0, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 8$};
  \node (9) at (2, -23) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue \up[9]$};
  \node (6) at (2, -21) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 6$};
  \node (2) at (0, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue \updown[2]$};
  \node (3) at (2, -19) [circle,draw=none,minimum size=4mm,inner sep=0.1mm]{$\blue 3$};

  \draw[-] (1)--(4)--(5)--(1); 
  \draw[-] (2)--(6)--(8)--(5); 
  \draw[-] (7)--(5)--(2)--(3); 
  \draw[-] (2)--(8)--(9); 
  \draw[-] (5)--(6); 

\end{tikzpicture}}
\caption{A decorated maple tree and its associated block graph}
\label{fig:mapleBlock}
\end{figure} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Spine poset}

\begin{definition}
%  Consider an arc~$\gamma$ in a directed tree~$\spine$ whose nodes are sets.
%  The \defn{source set}~$\so[\gamma]$ (resp.~\defn{target set}~$\ta[\gamma]$) of~$\gamma$ is the union of the nodes in the connected component of~$\spine \ssm \{\gamma\}$ containing the source (resp.~target)~of~$\gamma$.
  In a directed tree~$\spine$ whose nodes are sets,
  \begin{itemize}
    \item the \defn{source set}~$\so[\gamma]$ (resp.~\defn{target set}~$\ta[\gamma]$) of an arc~$\gamma$ is the union of the nodes in the connected component of $\spine \ssm \{\gamma\}$ containing the source (resp.~the target) of~$\gamma$,
    \item the \defn{source set}~$\so[U]$ (resp.~\defn{target set}~$\ta[U]$) of a node~$U$ is the union of~$U$ with the source sets~$\so[\alpha]$ of all incoming arcs~$\alpha$ (resp.~the target sets~$\ta[\beta]$ of all outgoing arcs~$\beta$) of~$U$~in~$\spine$.
  \end{itemize}
\end{definition}
\vincent{Where do we need the source set of a node? I don't like to have the two definitions here, it is confusing.}

%In this paper, we consider directed trees whose nodes are labeled by sets.
%With a slight abuse of notation, we still write~$\so[\gamma]$ (resp.~$\ta[\gamma]$) for the union of the labels in the source (resp.~target) set of an arc~$\gamma$.

\begin{definition}
  \label{def:spine}
  A \defn{spine} on a decorated block graph $G$ is a directed tree $\spine$ such that
  \begin{enumerate}
    \item the nodes of~$\spine$ form a partition of the vertex set of~$G$, and 
    \item at each node~$U$ of~$\spine$, the source sets $\so[\alpha]$ of the incoming arcs $\alpha$ are contained in distinct connected components of $G \ssm \down[U]$, and the target sets $\ta[\beta]$ of the outgoing arcs $\beta$ are contained in distinct connected components of $G \ssm \up[U]$.
  \end{enumerate}
  We denote by $\spines$ the set of spines on~$G$.
  \vincent{not sure we really need this notation}
  \vincent{give two examples of spines on the block graph of \cref{fig:mapleBlock}, one maximal and one not.}
\end{definition}

We now define two natural operations on spines: arc contraction and node splitting.
These operations are illustrated in \cref{fig:contractionSplitting}.

\begin{definition}
  \label{def:arccontraction}
  Let $G$ be a decorated block graph, let $\spine$ be a spine on $G$, and let~$\gamma$ be an arc of~$\spine$ with endpoints~$U$ and~$V$.
  The \defn{contraction} of~$\gamma$ in~$\spine$ is the directed tree obtained from~$\spine$ by replacing the nodes~$U$ and~$V$ by a single node~$W \eqdef U \cup V$ and attaching to~$W$ all arcs incident to either~$U$~or~$V$.
  See \cref{fig:contractionSplitting}.
\end{definition}

\begin{figure}[h!]
\centering

\begin{tikzpicture}[scale=1.6]
    
\node (N0) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.5,-0.5) {\small $U$};
\node (N1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.5,0.5) {\small $V$};

\node (o1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-1.2,0.6) {\small $\beta_1$};
\node (od) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.8,0.6) {\small $\dots$};
\node (oj) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.3,0.6) {\small $\beta_k$};

\node (oj1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,1.62) {\small $\beta_{k+1}$};
\node (ojd) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.5,1.6) {\small $\dots$};
\node (ol) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (1,1.6) {\small $\beta_\ell$};

\node (i1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-1,-1.6) {\small $\alpha_1$};
\node (id) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.5,-1.6) {\small $\dots$};
\node (im) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,-1.6) {\small $\alpha_i$};

\node (im1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.3,-0.62) {\small $\alpha_{i+1}$};
\node (imd) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.8,-0.6) {\small $\dots$};
\node (ik) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (1.2,-0.6) {\small $\alpha_j$};

\draw[->] (N0)--(o1); 
\draw[->] (N0)--(od);
\draw[->] (N0)--(oj);
  
\draw[->] (N0)--(N1) node[midway,left] {$\gamma$} ; 
\draw[->] (N1)--(oj1); 
\draw[->] (N1)--(ojd);
\draw[->] (N1)--(ol);

\draw[->] (i1)--(N0);
\draw[->] (id)--(N0);
\draw[->] (im)--(N0); 

\draw[->] (im1)--(N1); 
\draw[->] (imd)--(N1);
\draw[->] (ik)--(N1);

\end{tikzpicture}
\quad 
\quad 
\resizebox{0.1\linewidth}{!}{
  \raisebox{5.5em}{
  \begin{tikzpicture}
    \draw[->] (0,0)--(1,0); 
    \draw[->] (1,-0.2)--(0,-0.2); 
  \end{tikzpicture}}}
\quad 
\quad
\raisebox{1.5em}{
\begin{tikzpicture}[scale=1.2]
    
  \node (N1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,0) {\small $U \cup V$};
  
  
  \node (oj1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.6,1.5) {\small $\beta_1$};
  \node (ojd) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,1.5) {\small $\dots$};
  \node (ol) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.6,1.5) {\small $\beta_\ell$};
  
  
  \node (im1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.6,-1.5) {\small $\alpha_1$};
  \node (imd) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,-1.5) {\small $\dots$};
  \node (ik) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.6,-1.5) {\small $\alpha_j$};
  
  
  \draw[->] (N1)--(oj1); 
  \draw[->] (N1)--(ojd);
  \draw[->] (N1)--(ol);
  
  \draw[->] (im1)--(N1); 
  \draw[->] (imd)--(N1);
  \draw[->] (ik)--(N1);
  

\end{tikzpicture}}
\caption{Contraction and splitting on spines.}
\label{fig:contractionSplitting}
\end{figure} 

\begin{proposition}
  \label{prop:arccontraction}
  The contraction of any arc in any spine on~$G$ is a spine on~$G$.
\end{proposition}

\begin{proof} 
  Let $\spine'$ be a directed tree obtained by contracting an arc $\gamma$ with endpoints~$U$ and~$V$ in a spine $\spine$ on~$G$.
  We clearly just need to prove the local condition of \cref{def:spine} around the node~$W \eqdef U \cup V$ of~$\spine'$.
  We give the argument for the incoming arcs; the argument for the outgoing arcs is symmetric. 

  To prove that the source set~$\so[\alpha]$ of each incoming arc~$\alpha$ of~$W$ is contained in a connected component of~$G \ssm \down[W]$, we distinguish two cases:
  \begin{itemize}
    \item If~$\alpha$ is an incoming arc of~$U$ in~$\spine$, then its source set~$\so[\alpha]$ is contained in a connected component $C_1$ of $G \ssm \down[U]$ and also in a connected component $C_2$ of $G \ssm \down[V]$. Thus, it is in $C_1 \cap C_2$. By \cref{def:blockgraph}, the subgraph induced by the vertices of $C_1 \cap C_2$ is a connected component of $(G \ssm \down[U]) \cap (G \ssm \down[V]) = G \ssm \down[W]$.
    \item If~$\alpha$ is an incoming arc of~$V$ in~$\spine$, then its source set $\so[\alpha]$ is in a connected component of $G \ssm \down[V]$ that does not contain $U$, hence in a connected component of $G \ssm \down[W]$.
  \end{itemize}

  To prove that the source sets~$\so[\alpha]$ and~$\so[\alpha']$ of two distinct incoming arcs~$\alpha$ and~$\alpha'$ of~$W$ are contained in two distinct connected components of~$G \ssm \down[W]$, we distinguish two cases:
  \begin{itemize}
    \item If~$\alpha$ and~$\alpha'$ are both incoming arcs of~$U$ (resp.~of~$V$) in~$\spine$, then their source sets~$\so[\alpha]$ and~$\so[\alpha']$ live in two distinct connected components of $G \ssm \down[U]$ (resp.~of~$G \ssm \down[V]$), hence in two distinct connected components of $G\ssm \down[W]$.
    \item If~$\alpha$ is an incoming arc of~$U$ in~$\spine$ while~$\alpha'$ is an incoming arc of~$V$ in~$\spine$, then their source sets~$\so[\alpha] \subset \so[\gamma]$ and~$\so[\alpha']$ live in two distinct connected components of $G \ssm \down[V]$, hence in two distinct connected components of $G\ssm \down[W]$.
    \qedhere
  \end{itemize}
\end{proof}

To define the reverse operation of node splitting, we first need the following notion.

\begin{definition}
  \label{def:splittable}
  Let~$G$ be a decorated block graph, and let~$W$ be a subset of vertices of~$G$.
  A partition~$U \sqcup V = W$ is \defn{splittable} if~$U \ne \varnothing$ is contained in a connected component of~$G \ssm \down[V]$ and $V \ne \varnothing$ is contained in a connected component of~$G \ssm \up[U]$.
\end{definition}

\begin{proposition}
  \label{prop:splittablePartitions}
  Let $G$ be a decorated block graph. Any subset $W$ of vertices of~$G$ with $|W| \ge 2$ admits a splittable partition.
\end{proposition}

\begin{proof} 
  Consider a spanning tree~$T$ of~$G$, and an edge~$e$ of~$T$ such that both connected components~$X$ and~$Y$ of~$T \ssm \{e\}$ intersect~$W$.
  Let~$U \eqdef W \cap X$ and~$V \eqdef W \cap Y$.
  Then~$U \ne \varnothing$ is contained in a connected component of~$T \ssm Y$, thus in a connected component of~$G \ssm \down[V]$ (since~$T \subseteq G$ and~$\down[V] \subseteq Y$).
  Similarly $V \ne \varnothing$ is contained in a connected component of~$T \ssm X$, thus in a connected component of~$G \ssm \up[U]$.
\end{proof}

\begin{definition}
  \label{def:vertexsplitting} 
  Let $G$ be a decorated block graph, let $\spine$ be a spine on $G$, let~$W$ be a node of~$\spine$, and let~$U \sqcup V = W$ be a splittable partition of~$W$.
  The \defn{splitting} of~$U \sqcup V$ in~$\spine$ is the directed tree obtained from~$\spine$ by replacing the node~$W$ by an arc~$\gamma$ connecting a node~$U$ to a node~$V$,~and
  \begin{itemize}
    \item connecting each incoming arc~$\alpha$ of~$W$ to~$U$ if its source set~$\so[\alpha]$ is contained in a connected component of $G \ssm \down[W]$ adjacent to $\down[U]$ and to~$V$ otherwise, 
    \item connecting each outgoing arc~$\beta$ of~$W$ to~$V$ if its target set~$\ta[\beta]$ is contained in a connected component of $G \ssm \up[W]$ adjacent to $\up[V]$ and to~$U$ otherwise.
  \end{itemize}
  See \cref{fig:contractionSplitting}.
\end{definition}

\begin{proposition}
  \label{prop:vertexsplitting} 
  The splitting of any splittable partition in any spine on~$G$ is a spine on~$G$.
\end{proposition}

%\begin{remark}
%  The following proof is "formal", i.e. it doesn't use the fact that $G$ is a block graph. 
%\end{remark}

\begin{proof}
  Let~$\spine'$ be a directed tree obtained by splitting a splittable partition~$U \sqcup V = W$ of a node~$W$ in a spine $\spine$ on~$G$.
  We clearly just need to prove the local condition of \cref{def:spine} around the nodes~$U$ and~$V$ of~$\spine'$.
  We give the argument for~$U$; the argument for~$V$ is symmetric.
  
  We start with the incoming arcs of~$U$.
  First, each incoming arc~$\alpha$ of~$U$ is an incoming arc of~$W$, hence~$\so[\alpha]$ is contained in a connected component of~$G \ssm \down[W]$, hence in a connected component of~$G \ssm \down[U]$.
  Moreover, any two distinct incoming arcs~$\alpha$ and~$\alpha'$ of~$U$ are distinct incoming arcs of~$W$. Thus~$\so[\alpha]$ and~$\so[\alpha']$ are contained in distinct connected components of~$G \ssm \down[W]$, hence in distinct connected components of~$G \ssm \down[U]$, since~$U$ is contained in a connected component of~$G \ssm \down[V]$.

  We now consider the outgoing arcs of~$U$.
  To prove that the target set of each outgoing arc~$\beta$ of~$U$ is contained in a connected component of~$G \ssm \up[U]$, we distinguish two cases:
  \begin{itemize}
    \item If~$\beta \ne \gamma$, then~$\beta$ is an outgoing arc of~$W$, hence~$\ta[\beta]$ is contained in a connected component of~$G \ssm \up[W]$, hence in a connected component of~$G \ssm \up[U]$.
    \item If~$\beta = \gamma$, then~$\ta[\gamma]$ is the union of~$V$ with~$\so[\alpha']$ for all incoming arcs~$\alpha'$ of~$V$ and~$\ta[\beta']$ for all outgoing arcs~$\beta'$ of~$V$. We next prove that all these sets are contained in the same connected component of~$G \ssm \up[U]$.
    \begin{itemize}
      \item By \cref{def:vertexsplitting}, $V$ is contained in a connected component~$C$ of~$G \ssm \up[U]$. 
      \item Consider an incoming arc~$\alpha'$ of~$V$. The set~$\so[\alpha']$ is contained in a connected component~$D$ of~$G \ssm \down[W]$, and in a connected component~$E$ of~$G \ssm \down[V]$, with~$D \subseteq E$. By \cref{def:vertexsplitting}, $D$ is not adjacent to~$\down[U]$. By \cref{def:splittable}, $E$ is thus disjoint from~$U$. This implies on the one hand that~$D$ is disjoint from~$\up[U]$, thus connected in~$G \ssm \up[U]$, and on the other hand that~$D$ is adjacent to~$\down[V]$, hence contained in~$C$. 
      \item Consider an outgoing arc~$\beta'$ of~$V$. By \cref{def:vertexsplitting}, the set $\ta[\beta']$ is contained in a connected component of~$G \ssm \up[W]$ adjacent to~$V$, hence $\ta[\beta']$ is contained in~$C$.
    \end{itemize}
  \end{itemize}
  To prove that the target sets of two distinct outgoing arcs~$\beta$ and~$\beta'$ of~$U$ are contained in two distinct connected components of~$G \ssm \up[U]$, we distinguish two cases:
  \begin{itemize}
  \item Assume that~$\beta$ and~$\beta'$ are both distinct from~$\gamma$. Let~$C$ be the connected component of~$G \ssm \up[U]$ containing~$V$, and let~$D$ and~$D'$ (resp.~$E$ and~$E'$) the connected components of $G \ssm \up[W]$ (resp.~$G \ssm \up[U]$) containing~$\ta[\beta]$ and $\ta[\beta']$. By \cref{def:vertexsplitting}, $D$ and~$D'$ are not adjacent to~$\up[V]$. By \cref{def:splittable}, $E$ and~$E'$ are thus disjoint from~$V$. This implies that~$E = D$ and~$E' = D'$ are distinct.
  \item Assume that~$\beta' = \gamma$. As before, the connected component of~$G \ssm \up[U]$ containing~$\ta[\beta]$ is disjoint from~$V$, thus is distinct from that containing~$\ta[\gamma]$.
  \qedhere
  \end{itemize}
\end{proof}

\begin{proposition}
  \label{prop:contractionSplitting}
  Arc contraction and node splitting are inverse operations.
\end{proposition}

\begin{proof}
  It is clear that if~$\spine'$ is the splitting of~$U \sqcup V$ in~$\spine$, then~$\spine$ is the contraction of the arc joining~$U$ to~$V$ in~$\spine'$.
  Conversely, if~$\spine$ is the contraction of an arc joining~$U$ to~$V$ in~$\spine'$, then the partition~$U \sqcup V$ is splittable by \cref{def:spine}, and~$\spine'$ is the splitting of~$U \sqcup V$~in~$\spine$.
\end{proof}

\begin{definition}
  The \defn{spine poset} of~$G$ is the poset on spines on~$G$ defined by~$\spine \le \spine'$ if and only if~$\spine$ is obtained from~$\spine'$ by arc contractions, or equivalently~$\spine'$ is obtained from~$\spine$ by node~splittings.
\end{definition}

\begin{corollary} 
  The spine poset is graded by the number of nodes.
  Hence, the cover relations of the spine poset are precisely given by arc contractions, or equivalently node splittings.
  Moreover,
  \begin{itemize}
    \item the unique rank $0$ (\ie minimal) element is the spine with a single node, 
    \item the rank~$1$ elements are the spines with precisely two nodes, 
    \item the corank~$1$ elements are the spines where the nodes are all singletons except one pair,
    \item the corank~$0$ (\ie maximal) elements are the spines where the nodes are all singletons.
  \end{itemize}
\end{corollary}

\begin{remark}
  In the spine poset:
  \begin{itemize}
    \item a spine with~$a$ arcs covers~$a$ spines, and is larger than precisely $\binom{a}{b}$ spines with~$b$ arcs,
    \item a spine with~$k$ nodes of cardinality~$n_1, \dots, n_k$ is covered by at least~$2^{|\set{i \in [k]}{n_i \ge 2}|}$ and at most~$\prod_{i \in [k]} 2^{n_i}-2$ spines. In particular, a corank~$1$ spine is covered by precisely $2$ maximal~spines.
  \end{itemize}
\end{remark}

\begin{remark}
  All the results in this section hold if and only if $G$ is a block graph. 
  \vincent{Not the right place...}
\end{remark}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Nested complex}

\vincent{Do we want to say that the spine complex is a simplicial poset, which we want to prove is flag?}
% We denote by~$\compl{B} \eqdef V_G \ssm B$ the complement of a subset~$B$ of~$V_G$.

\begin{definition}
  \label{def:block}
  A \defn{block} of~$G$ is a subset~$B$ of vertices of~$G$ such that~$B$ and its complement~$V_G \ssm B$ forms a splittable partition of the vertex set~$V_G$ (see \cref{def:splittable}).
%  A \defn{block} of~$G$ is a subset~$B$ of~$V_G$ such that $B \ne \varnothing$ is contained in a connected component of~$G \ssm \down[\compl{B}]$ and $\compl{B} \ne \varnothing$ is contained in a connected component of~$G \ssm \up[B]$.
%  In other words, $B$ and its complement~$\compl{B}$ forms a splittable partition of~$V_G$ (see \cref{def:splittable}).
\end{definition}

\begin{definition}
  \label{def:compatibleBlocks}
%  A \defn{block} of~$G$ is a subset~$B$ of vertices of~$G$ such that~$B$ and its complement~$V_G \ssm B$ forms a splittable partition of the vertex set of~$G$ (see \cref{def:splittable}).
  %~$B \ne \varnothing$ is contained in a connected component of~$G \ssm \compl{B}$ and $\compl{B} \ne \varnothing$ is contained in a connected component of~$G \ssm B$.
%  Two blocks~$B$ and~$B'$ are \defn{compatible} if any of the following conditions hold:
%  \begin{itemize}
%    \item $B \subseteq B'$,
%    \item $B \supseteq B'$,
%    \item $B \cap B' = \varnothing$ and $B \cup B'$ is not a block,
%    \item $\compl{B} \cup \compl{B'} = \varnothing$ and~$B \cap B'$ is not a block.
%  \end{itemize}
  Let~$B$ and~$B'$ be two blocks of~$G$.
  We write:
  \begin{itemize}
    \item $B \negDisjoint B'$ if $B \cap B' = \varnothing$ and $B \cup B'$ is not a block of~$G$,
    \item $B \posDisjoint B'$ if $B \cup B' = V_G$ and~$B \cap B'$ is not a block of~$G$.
  \end{itemize}
  We say that~$B$ and~$B'$ are \defn{compatible} if $B \subseteq B'$, or $B \supseteq B'$, or $B \negDisjoint B'$ or $B \posDisjoint B'$.
  We call \defn{nested set} on~$G$ a set of pairwise compatible blocks of~$G$.
\end{definition}

\begin{definition}
  \label{def:spineComplex}
  The \defn{nested complex} of~$G$ is the simplicial complex on the blocks of~$G$ whose simplices are nested sets on~$G$.
  In other words, it is the clique complex of the compatibility relation on blocks of~$G$.
\end{definition}

%\begin{lemma}
%  \label{lem:arcBlock}
%  The source set~$\so[\gamma]$ of an arc~$\gamma$ of a spine~$\spine$ on~$G$ is a block of~$G$.
%\end{lemma}
%
%\begin{proof}
%  Let~$\spine'$ be the rank~$1$ spine on~$G$ obtained by contracting all arcs in~$\spine$ except~$\gamma$.
%  By \cref{prop:contractionSplitting}, $\spine$ is obtained from the rank~$0$ spine by a node splitting.
%  This implies that the partition~$\so[\gamma] \sqcup \ta[\gamma]$ is splittable.
%\end{proof}
%
%\begin{lemma}
%  \label{lem:compatibleArcBlocks}
%  For two arcs~$\gamma$ and~$\gamma'$ of a spine~$\spine$ on~$G$, the blocks~$\so[\gamma]$ and~$\so[\gamma']$ of~$G$ are compatible.
%\end{lemma}
%
%\begin{proof}
%  Since the spine~$\spine$ is a tree, there is a unique path~$\pi$ joining~$\gamma$ to~$\gamma'$ in~$\spine$.
%  If $\pi$ connects the target of~$\gamma$ to the source of~$\gamma'$, then~$\so[\gamma] \subseteq \so[\gamma']$, and \viceversa.
%  If $\pi$ connects the sources of~$\gamma$ and~$\gamma'$, then $\so[\gamma] \negDisjoint \so[\gamma]'$.
%  Indeed, there is at least one node~$U$ of~$\spine$ where~$\pi$ has two incoming arcs~$\alpha, \alpha'$.
%  By \cref{def:spine}, $\so[\alpha]$ and~$\so[\alpha']$ belong to two distinct connected components of~$G \ssm \down[U]$.
%  Hence, we obtain that~$\so[\gamma] \subseteq \so[\alpha]$ and~$\so[\gamma] \subseteq \so[\alpha']$ belong to distinct connected components of~$G \ssm \down[U]$ hence of~$G \ssm \down[\compl{(\so[\gamma] \cup \so[\alpha'])}]$.
%  Similarly, if $\pi$ connects the targets of~$\gamma$ and~$\gamma'$, then $\so[\gamma] \posDisjoint \so[\gamma]'$.
%  See \cref{fig:sourceSetsCompatible}.
%  \vincent{borrow picture...}
%\end{proof}
%
%\begin{corollary}
%  Any spine on~$G$ defines a nested set on~$G$.
%\end{corollary}

\begin{proposition}
  \label{prop:spineToNested}
  The map~$\spineToNested$ defined by~$\spineToNested(\spine) \eqdef \set{\so[\gamma]}{\gamma \text{ arc of } \spine}$ defines a ranked bijection from the spine poset to the face poset of the nested complex.
\end{proposition}

\begin{proof}
  We prove that the map~$\spineToNested$ is well-defined, injective and surjective.
  
  \para{Well-defined}
  Observe that for any spine~$\spine$ on~$G$:
  \begin{itemize}
    \item For any arc~$\gamma$ of~$\spine$, the source set~$\so[\gamma]$ is a block of~$G$. 
    Indeed, consider the rank~$1$ spine~$\spine'$ on~$G$ obtained by contracting all arcs in~$\spine$ except~$\gamma$. 
    By \cref{prop:contractionSplitting}, $\spine$ is obtained from the rank~$0$ spine by a node splitting. 
    Hence, the partition~$\so[\gamma] \sqcup \ta[\gamma]$ is splittable.
    \item For any two arcs~$\gamma$ and~$\gamma'$ of~$\spine$, the blocks~$\so[\gamma]$ and~$\so[\gamma']$ of~$G$ are compatible. 
    Indeed, since the spine~$\spine$ is a tree, there is a unique path~$\pi$ joining~$\gamma$ to~$\gamma'$ in~$\spine$.
    As illustrated in \cref{fig:sourceSetsCompatible}, we observe that:
    \vincent{borrow picture...}
    \begin{itemize}
      \item If $\pi$ connects the target of~$\gamma$ to the source of~$\gamma'$, then~$\so[\gamma] \subseteq \so[\gamma']$.
      \item If $\pi$ connects the source of~$\gamma$ to the target of~$\gamma'$, then~$\so[\gamma] \supseteq \so[\gamma']$.
      \item If $\pi$ connects the sources of~$\gamma$ and~$\gamma'$, then $\so[\gamma] \negDisjoint \so[\gamma]'$.
      Indeed, there is at least one node~$U$ of~$\spine$ where~$\pi$ has two incoming arcs~$\alpha, \alpha'$.
      By \cref{def:spine}, $\so[\alpha]$ and~$\so[\alpha']$ belong to two distinct connected components of~$G \ssm \down[U]$.
      Hence, we obtain that~$\so[\gamma] \subseteq \so[\alpha]$ and~$\so[\gamma] \subseteq \so[\alpha']$ belong to distinct connected components of~$G \ssm \down[U]$ hence of~$G \ssm \down[\compl{(\so[\gamma] \cup \so[\alpha'])}]$.
      \item Similarly, if $\pi$ connects the targets of~$\gamma$ and~$\gamma'$, then $\so[\gamma] \posDisjoint \so[\gamma]'$.
    \end{itemize}
  \end{itemize}

  \para{Injective}
  To see the injectivity of~$\spineToNested$, we prove that we can reconstruct a spine~$\spine$ from the source sets of its arcs.
  First the the nodes of~$\spine$ are the equivalence classes under the relation~$v \equiv w$ if there is no arc~$\gamma$ of~$\spine$ such that~$|\{v,w\} \cap \so[\gamma]| = 1$.
  Second, the leaves of~$\spine$ correspond to the source sets containing either only one or all but one node of~$\spine$. 
  We can then delete one leaf~$\ell$ of~$\spine$, and reconstruct by induction the tree~$\spine \ssm \{\ell\}$. 
  Finally the only possible vertex of~$\spine \ssm \{\ell\}$ to which the leaf~$\ell$ can be glued is the unique vertex which is in the intersection of all source sets~$B$ of~$\spine \ssm \{\ell\}$ such that~$B \cup \ell$ is a source set of~$\spine$, but not in the union of all source sets~$B$ of~$\spine \ssm \{\ell\}$ such that~$B \cup \ell$ is not a source set of~$\spine$.

  \para{Surjective}
  To see the surjectivity of~$\spineToNested$, we prove that for any nested set~$\nested$ on~$G$,
\begin{enumerate}[(a)]
\item there exists a spine~$\spine$ on~$G$ such that~$\spineToNested(\spine) = \nested$, and
\item for any block~$B$ of~$G$ compatible with all blocks of~$\nested$, there exists a node~$U$ of~$\spine$ such that the partition~$U = (U \cap B) \sqcup (U \ssm B)$ is splittable (see \cref{def:splittable}).
\end{enumerate}
  These properties are proved by induction on the size of~$\nested$.  
  To initialize, observe that the rank~$0$ spine (with a single node~$V_G$) is sent to the empty nested set for which Property~(b) above holds by \cref{def:block}.

  Assume now that these properties hold for a given nested set~$\nested$ and consider a bigger nested set~$\nested' \eqdef \nested \cup \{B\}$.
  Let~$\spine$ be the spine such that~$\spineToNested(\spine) = \nested$ and let~$U$ be a node of~$\spine$ such that the partition~$U = (U \cap B) \sqcup (U \ssm B)$ is splittable.
  Let~$\spine'$ denote the spine obtained by the splitting of~$(U \cap B) \sqcup (U \ssm B)$ in~$\spine$.
  We claim that $\spine$ satisfies Properties (a) and (b) above.
  
  Consider first an incoming arc~$\alpha$ of~$U$ in~$\spine$.
  Since~$B$ is compatible with~$\so[\alpha]$, and both~$U \cap B$ and~$U \ssm B$ are non-empty, we obtain that~$\so[\alpha] \subseteq B$ or~$\so[\alpha] \negDisjoint B$.
  Moreover, by \cref{def:vertexsplitting}, the arc~$\alpha$ is connected to the node~$U \cap B$ of~$\spine'$ if~$\so[\alpha] \subseteq B$, and to the node~$U \ssm B$ of~$\spine'$ if~$\so[\alpha] \negDisjoint B$.
  Similarly, for any outgoing arc~$\beta$ of~$U$ in~$\spine$, we have~$\so[\beta] \supseteq B$ or~$\so[\alpha] \posDisjoint B$, and the arc~$\beta$ is connected to the node~$U \ssm B$ of~$\spine'$ if~$\so[\beta] \supseteq B$, and to the node~$U \cap B$ of~$\spine'$ if~$\so[\beta] \posDisjoint B$.
  In particular, we have~$\so[\alpha] \subseteq B$ for each incoming arc~$\alpha$ of~$U \cap B$ in~$\spine'$, and~$\ta[\beta] \subseteq B$ for each outgoing arc~$\beta$ of~$U \cap B$ in~$\spine'$ (since~$\so[\beta] \posDisjoint B$ implies $\so[\beta] \cup B = V_G$ hence $\ta[\beta] = V_G \ssm \so[\beta] \subseteq B$).
  We thus obtain that~$\so[\gamma] \subseteq B$, and similarly that~$\ta[\gamma] \subseteq V_G \ssm B$, from which we conclude that $\so[\gamma] = B$.
  Since~$\spine'$ is obtained by splitting a node of~$\spine$ into an arc~$\gamma$, we have~$\spineToNested(\spine') = \spineToNested(\spine) \cup \{\so[\gamma]\} = N \cup \{B\} = N '$.

  Consider now another block~$B'$ of~$G$ compatible with all blocks of~$N'$.
  Since~$B'$ is compatible with~$N \subseteq N'$, there is a node~$U'$ of~$\spine$ such that the partition~$U' = (U' \cap B') \sqcup (U' \ssm B')$ is splittable.
  If~$U \ne U'$, then~$U'$ is still a node of~$\spine'$ so that there is nothing to prove.
  If~$U = U'$, then the node~$U \cap B$ of~$\spine'$ suits if~$B \supseteq B'$ or~$B \negDisjoint B'$, while the node~$U \ssm B$ of~$\spine'$  suits if~$B \subseteq B'$ or~$B \posDisjoint B'$.
  \vincent{Check that, maybe add a sentence...}
\end{proof}

\begin{remark}
  \label{rem:nestedToSpine}
  From the proof of \cref{prop:spineToNested}, we can give a direct description of the inverse map~$\nestedToSpine$ of the map~$\spineToNested$.
  Namely, consider a nested set~$N$ and two blocks~$B, B'$ of~$N$, and let~$\gamma, \gamma'$ denote the arcs of~$\spine \eqdef \nestedToSpine(N)$ such that~$\so[\gamma] = B$ and~$\so[\gamma'] = B'$.
  Then
  \begin{enumerate}[(i)]
    \item the target of~$\gamma$ and the source of~$\gamma'$ coincide iff~$B \subseteq B'$ and~$\nexists \, B'' \in \nested$ with~$B \subseteq B'' \subseteq B'$ or~$B \negDisjoint B'' \posDisjoint B'$,
    \item the targets of~$\gamma$ and~$\gamma'$ coincide iff~$B \negDisjoint B'$ and~$\nexists \, B'' \in \nested$ with~$B \subseteq B'' \negDisjoint B'$ or~${B \negDisjoint B'' \supseteq B'}$,
\item the sources of~$\gamma$ and~$\gamma'$ coincide iff~$B \posDisjoint B'$ and~$\nexists \, B'' \in \nested$ with~$B \posDisjoint B'' \subseteq B'$ or~${B \supseteq B'' \posDisjoint B'}$.
\end{enumerate}
This gives a description of the vertices of the spine~$\nestedToSpine(\nested)$ in terms of equivalence classes of blocks of~$\nested$ (by the relations above). It also gives a direct definition of the directed graph underlying~$\nestedToSpine(\nested)$ as a quotient of a collection of disjoint arcs labeled by~$\nested$ by identification of some of their endpoints. Finally, each node of~$\nestedToSpine(\nested)$ with incoming arcs~$A$ and outgoing arcs~$B$ is given by
\[
\bigg( \bigcap_{\beta \in B} \so[\beta] \bigg) \ssm \bigg( \bigcup_{\alpha \in A} \so[\alpha] \bigg) = V_G \ssm \bigg( \bigcup_{\alpha \in A} \so[\alpha] \cup \bigcup_{\beta \in B} \ta[\beta] \bigg).
\]
\end{remark}

\begin{corollary}
  The nested complex is pure and flag simplicial complex.
\end{corollary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Flips and flip poset}

\begin{definition}
  Let $G$ be a decorated block graph and let $\spine$ be a maximal spine on~$G$.
  Consider two vertices $U = \{u\}$ and $V = \{v\}$ of $\spine$ related by an arc $\gamma$. 
  Let $\alpha$ be the incoming arc of $U$ such that~$\so[\alpha]$ and~$V$ are contained in the same connected component of $G \ssm \down[U]$, and let $\beta$ be the outgoing arc of $V$ such that~$\ta[\beta]$ and~$U$ are contained in the same connected component of $G \ssm \up[V]$.
  We define $\spine'$ to be the spine obtained from $\spine$ by reversing the orientation of~$\gamma$, grafting the arc~$\alpha$ to~$V$ and the arc~$\beta$ to~$U$.
  We say that $\spine'$ is obtained from $\spine$ by \defn{flipping} the arc~$\gamma$. 
\end{definition}

\begin{figure}[h!]
\begin{tikzpicture}[scale=1.6]
    
\node (N0) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.5,-0.5) {\small $U$};
\node (N1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.5,0.5) {\small $V$};
    
\node (o1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-1.2,0.6) {\small $\beta_1$};
\node (od) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.8,0.6) {\small $\dots$};
\node (oj) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.3,0.6) {\small $\beta_k$};
    
\node (oj1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,1.62) {\small $\beta_{k+1}$};
\node (ojd) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.5,1.6) {\small $\dots$};
\node (ol) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (1,1.6) {\small $\beta_\ell$};

\node (2) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (1.5,1.6) {\small $\boldsymbol{\beta}$};

\node (1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-1.5,-1.6) {\small $\boldsymbol{\alpha}$};
    
\node (i1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-1,-1.6) {\small $\alpha_1$};
\node (id) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.5,-1.6) {\small $\dots$};
\node (im) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,-1.6) {\small $\alpha_i$};
    
\node (im1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.3,-0.62) {\small $\alpha_{i+1}$};
\node (imd) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.8,-0.6) {\small $\dots$};
\node (ik) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (1.2,-0.6) {\small $\alpha_j$};

\draw[->,thick] (1)--(N0); 
\draw[->,thick] (N1)--(2); 
    
\draw[->] (N0)--(o1); 
\draw[->] (N0)--(od);
\draw[->] (N0)--(oj);
      
\draw[->] (N0)--(N1) node[midway,left] {$\gamma$} ; 
\draw[->] (N1)--(oj1); 
\draw[->] (N1)--(ojd);
\draw[->] (N1)--(ol);
    
\draw[->] (i1)--(N0);
\draw[->] (id)--(N0);
\draw[->] (im)--(N0); 
    
\draw[->] (im1)--(N1); 
\draw[->] (imd)--(N1);
\draw[->] (ik)--(N1);
    
\end{tikzpicture}
\resizebox{0.1\linewidth}{!}{
\raisebox{5.5em}{
\begin{tikzpicture}
    \draw[->] (0,0)--(1,0); 
\end{tikzpicture}}}
\quad
\begin{tikzpicture}[scale=1.6]
    
\node (N0) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.5,0.5) {\small $U$};
\node (N1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.5,-0.5) {\small $V$};
      
\node (o1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-1,1.6) {\small $\beta_1$};
\node (od) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.5,1.6) {\small $\dots$};
\node (oj) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,1.6) {\small $\beta_k$};
      
\node (oj1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.3,0.62) {\small $\beta_{k+1}$};
\node (ojd) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.8,0.6) {\small $\dots$};
\node (ol) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (1.2,0.6) {\small $\beta_\ell$};

      
\node (i1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-1.2,-0.6) {\small $\alpha_1$};
\node (id) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.8,-0.6) {\small $\dots$};
\node (im) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-0.3,-0.6) {\small $\alpha_i$};
      
\node (im1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0,-1.62) {\small $\alpha_{i+1}$};
\node (imd) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (0.5,-1.6) {\small $\dots$};
\node (ik) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (1,-1.6) {\small $\alpha_j$};

\node (2) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (-1.5,1.6) {\small $\boldsymbol{\beta}$};

\node (1) [circle,draw=none,minimum size=4mm,inner sep=0.1mm] at (1.5,-1.6) {\small $\boldsymbol{\alpha}$};

\draw[->,thick] (1)--(N1); 
\draw[->,thick] (N0)--(2); 
      
\draw[->] (N0)--(o1); 
\draw[->] (N0)--(od);
\draw[->] (N0)--(oj);
        
\draw[->] (N1)--(N0) node[midway,right] {$\gamma$} ; 
\draw[->] (N1)--(oj1); 
\draw[->] (N1)--(ojd);
\draw[->] (N1)--(ol);
      
\draw[->] (i1)--(N0);
\draw[->] (id)--(N0);
\draw[->] (im)--(N0); 
      
\draw[->] (im1)--(N1); 
\draw[->] (imd)--(N1);
\draw[->] (ik)--(N1);
\end{tikzpicture}
\caption{A spine flip.}
\end{figure}

The fact that $\spine'$ is indeed a spine is immediate from the definitions. Contracting $\gamma$ in either $\spine$ or $\spine'$, we obtain the same spine $\spine''$. 

\begin{lemma} 
  \label{lemma:coveringpair} 
  The spines~$\spine$ and $\spine'$ are the only spines covering $\spine''$ in the spine poset.
\end{lemma}

\begin{proof}
  This follows from \cref{prop:vertexsplitting}.
\end{proof}
  
\begin{corollary} 
   The nested complex of~$G$ is a closed pseudo-manifold. 
\end{corollary}

\begin{proof}
  TBC
\end{proof}
  
\begin{definition}[Flip poset] 
  For $\spine$ and $\spine'$ two maximal spines, we say that $\spine \preccurlyeq \spine'$ if and only if $\spine'$ is obtained from $\spine$ by a flip. 
\end{definition}

\begin{remark}
  The question of whether or not the flip poset $(\maxspines,\preccurlyeq)$ is a lattice is a difficult question. It depends on the decoration of $G$. We know that if $G$ is a path, it is always the case \cite{PonsPilaud18}, for $G$ a block graph it is generally not true. See \cite{BarnardMcConville18}. \guillaume{Nos calculs?; donner un exemple, un contre-exemple}
\end{remark}
  
\begin{definition}[Flip graph] 
  The \defn{flip graph} is the Hasse diagram of the flip poset. 
\end{definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Blossoming spines}

In the next section, we aim at describing a natural surjection from the ordered partitions (resp.~the permutations) of the vertex set of~$G$ to the spines (resp.~the maximal spines) on~$G$.
For this, it is convenient to add further information to a spine on~$G$.
Here, we need to manipulate both the vertices and the cliques of~$G$, thus we consider a maple tree~$M$ corresponding to the block graph~$G$.

\begin{definition}
  \label{def:blossomingTree}
  A \defn{directed blossoming tree} is a directed tree~$\spine$ with additional \defn{blossoms} (either incoming or outgoing) which are half-arcs.
  A \defn{cut} of a directed blossoming tree~$\spine$ is a subset~$\Gamma$ of arcs and blossoms of~$\spine$ such that any directed path joining an incoming blossom of~$\spine$ to an outgoing blossom of~$\spine$ contains precisely one element of~$\Gamma$.
  When the nodes of~$\spine$ are sets, the \defn{source set}~$\so[\Gamma]$ (resp.~\defn{target set}~$\ta[\Gamma]$) of~$\Gamma$ is the union of the nodes of all connected components of~$\spine \ssm \Gamma$ which contain the source (resp.~target) of at least one arc of~$\Gamma$.
  For instance, the set of incoming (resp.~outgoing) blossoms is a cut of~$\spine$ whose source (resp.~target) set is empty and whose target (resp.~source) set is the union of the nodes of~$\spine$.
\end{definition}

%  A \defn{sweep sequence} of~$\spine$ is a sequence~$\Gamma_0, \dots, \Gamma_p$ of cuts of~$\spine$ such that $\Gamma_0$ is the cut formed by all incoming blossoms of~$\spine$ while $\Gamma_p$ is the cut formed by all outgoing blossoms of~$\spine$, and for all~$i \in [p]$, there is a node~$U_i$ of~$\spine$ such that~$\Gamma_{i-1} \ssm \so[U_i] = \Gamma_i \ssm \ta[U_i]$.

\begin{definition}
  \label{def:blossomingSpine}
  Let~$M$ be a maple tree with red vertex set~$R$ and blue vertex set~$B$, and~$G$ be the block graph obtained by tapping~$M$.
  The \defn{blossoming} of a spine~$\spine$ on~$G$ is the directed blossoming tree obtained from~$\spine$ by
  \begin{enumerate}[(i)]
    \item labeling each arc~$\gamma$ of~$\spine$ by the red vertices of the intersection of the connected component of~$\smash{M \ssm \up[{\so[\gamma]}]}$ containing~$\ta[\gamma]$ with the connected component of~$\smash{M \ssm \down[{\ta[\gamma]}]}$ containing~$\so[\gamma]$,
    \item adding at each node~$U$ of~$\spine$ an incoming (resp.~outgoing) blossom labeled by the the red vertices of~$C$ for each connected component~$C$ of~$M \ssm \down[{\ta[U]}]$ (resp.~of~$M \ssm \up[{\so[U]}]$) adjacent to~$U$ such that there is no incoming arc~$\alpha$ (resp.~outgoing arc~$\beta$) of~$U$ with~$\so[\alpha]$ (resp.~$\ta[\beta]$) contained in~$C$.
  \end{enumerate}
  We call \defn{blossoming spines} of~$M$ the blossomings of the spines of~$G$.
  \vincent{give two examples of blossoming spines on the examples of spines given before.}
\end{definition}

%\begin{lemma}
%  \label{lem:connectedComponents}
%  Let~$M$ be a maple tree with red vertices~$R$ and blue vertices~$B$, and let~$\spine$ be a blossoming spine on~$M$.
%  Then the labels of the incoming (resp.~outgoing) blossoms of~$S$ are precisely the intersections of~$R$ with the connected components of~${M \ssm \down[B]}$ (resp.~of~${M \ssm \up[B]}$).
%\end{lemma}
%
%\begin{proof}
%  \vincent{todo}
%\end{proof}

\begin{proposition}
  \label{prop:blossomingSpine}
  Let~$M$ be a maple tree with red vertices~$R$ and blue vertices~$B$, and let~$\spine$ be a blossoming spine on~$M$.
  For any cut~$\Gamma$ of~$\spine$, the labels of the arcs and blossoms of~$\Gamma$ are precisely the intersections of~$R$ with the connected components  of~$\smash{M \ssm \big( \up[{\so[\Gamma]}] \cup \down[{\ta[\Gamma]}] \big)}$.
\end{proposition}

\begin{proof}
  \vincent{Not clear how to argue that properly...}
%  We first prove the result for the cut~$\Gamma$ of~$\spine$ given by all incoming blossoms of~$\spine$.
%  \vincent{todo}
%  Let~$\Gamma$ and~$\Gamma'$ be two cuts of~$\spine$ which differ by sweeping a node~$U$ of~$\spine$, meaning that $\Gamma \ssm \alpha(U) = \Gamma' \ssm \beta(U)$ where~$\alpha(U)$ and~$\beta(U)$ respectively denote the incoming and outgoing arcs of~$U$.
%  \vincent{todo}
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}[h!]
\begin{tikzpicture}
  \node (0) at (0, 0) {$\updown[2] \up[5] 6$};
  \node (1) at (-3, 1) {$ade$};
  \node (2) at (-1, 1) {$hi$};
  \node (3) at (1, 1) {$fgjk$};
  \node (4) at (3, 1) {$bc$};
  \node (5) at (3, 3) {$bc$};
  \node (6) at (1.5, 3) {$k$};
  \node (7) at (0.5, 3) {$fgj$};
  \node (8) at (-1, 3) {$hi$};
  \node (9) at (-3, 3) {$ade$};
  \node (10) at (1, 2) {$\up[9]$};
  \node (11) at (-3, 2) {$14$};
  \node (12) at (-1, -1) {$adefghijk$};
  \node (13) at (1, -1) {$bc$};
  \node (14) at (-1, -2) {$\down[7] 8$};
  \node (15) at (1, -2) {$3$};
  \node (16) at (-2, -3) {$adefghjk$};
  \node (17) at (0, -3) {$i$};
  \node (18) at (1, -3) {$bc$};
  \draw[->] (18)--(15);
  \draw[->] (17)--(14);
  \draw[->] (16)--(14);
  \draw[->] (15)--(13);
  \draw[->] (14)--(12);
  \draw[->] (13)--(0);
  \draw[->] (12)--(0);
  \draw[->] (0)--(1);
  \draw[->] (0)--(2);
  \draw[->] (0)--(3);
  \draw[->] (0)--(4);
  \draw[->] (1)--(11);
  \draw[->] (2)--(8);
  \draw[->] (3)--(10);
  \draw[->] (4)--(5);
  \draw[->] (11)--(9);
  \draw[->] (10)--(7);
  \draw[->] (10)--(6);
  \draw[dotted] (-5,-3)--(16)--(17)--(18)--(5,-3);
  \draw[dashed] (-5,-2)--(14)--(15)--(5,-2);
  \draw[dotted] (-5,-1)--(12)--(13)--(5,-1);
  \draw[dashed] (-5,0)--(0)--(5,0);
  \draw[dotted] (-5,1)--(1)--(2)--(3)--(4)--(5,1);
  \draw[dashed] (-5,2)--(11)--(10)--(5,2);
  \draw[dotted] (-5,3)--(9)--(8)--(7)--(6)--(5)--(5,3);
  \node (20) at (5.5, -3) {$\down[2] \down[7]$};
  \node (21) at (5.5, -2) {$\down[2]$};
  \node (22) at (5.5, -1) {$\down[2]$};
  \node (23) at (5.5, 0) {};
  \node (24) at (5.5, 1) {$\up[2] \up[5]$};
  \node (25) at (5.5, 2) {$\up[2] \up[5]$};
  \node (26) at (5.5, 3) {$\up[2] \up[5] \up[9]$};
\end{tikzpicture}
\caption{A blossoming spine on the maple tree of \cref{fig:mapleBlock}, reconstructed from $\pi = 3 \down[7] 8 | \updown[2] \up[5] 6 | 149$.}
\label{fig:blossoming spine}
\end{figure}

\subsection{Surjection maps}

Recall that an \defn{ordered partition} of a set~$B$ is a (ordered) sequence~$\pi \eqdef \pi_1 | \dots | \pi_p$ of non-empty (unordered) subsets of~$B$ which form a partition of~$B$.

%\begin{definition}
%  \label{def:sweepingAlgorithm}
%  Let~$M$ be a maple tree with red vertices~$R$ and blue vertices~$B$.
%  The \defn{sweeping algorithm} is a procedure that maps an ordered partition~$\pi \eqdef \pi_1 | \dots | \pi_p$ of~$B$ into a blossoming spine~$\spine(\pi)$ on~$M$.
%  It follows a sweep sequence~$\Gamma_0, \dots \Gamma_p$ of~$\spine(\pi)$ and constructs~$\spine(\pi)$ by maintaining before step~$i$ the blossoming forest induced by the nodes of~$\spine(\pi)$ contained in~$\pi_1 \cup \dots \cup \pi_{i-1}$.
%  The iterative procedure is as follows:
%  \begin{itemize}
%    \item start with the cut~$\Gamma_0$ formed by an incoming blossom labeled~$R \cap C$ for each connected component~$C$ of~$M \ssm \down[B]$,
%    \item at step~$i$:
%      \begin{itemize}
%        \item create a node~$U$ for each non-empty intersection of~$\pi_i$ with a connected component of~$M \ssm (\up[\pi_1] \cup \dots \cup \up[\pi_{i-1}] \cup \down[\pi_{i+1}] \cup \dots \cup \down[\pi_p])$,
%        \item attach as incoming arcs of~$U$ the outgoing blossoms of~$\Gamma_{i-1}$ whose labels are adjacent to~$U$ in~$M$,
%        \item create at~$U$ one outgoing blossom labeled by~$R \cap C$ for each connected component~$C$ of~$M \ssm (\up[\pi_1] \cup \dots \cup \up[\pi_i] \cup \down[\pi_{i+1}] \cup \dots \cup \down[\pi_p])$,
%        \item define the new cut~$\Gamma_i$.
%      \end{itemize}
%    \item end with the cut~$\Gamma_p$ with an outgoing blossom for each connected component of~$M \ssm \up[B]$.
%  \end{itemize}
%  \vincent{improve that}
%\end{definition}

\begin{definition}
  \label{def:surjection}
  Let~$M$ be a maple tree with red vertices~$R$ and blue vertices~$B$.
  For an ordered partition~$\pi \eqdef \pi_1 | \dots | \pi_p$ of~$B$, we construct a blossoming spine~$\spine(\pi)$ on~$M$ in four steps:
  \begin{itemize}[wide, labelwidth=!, labelindent=5pt]
    \item \textbf{construct}
    \begin{itemize}[wide, labelwidth=!, labelindent=10pt]
      \item an arc~$\alpha^i_Y$ for each $0 \le i \le p$ and each component~$Y$ of~$M \ssm (\up[\pi_1] \cup \dots \cup \up[\pi_i] \cup \down[\pi_{i+1}] \cup \dots \cup \down[\pi_p])$,
      \item a node~$n^i_X$ for each $1 \le i \le p$ and each component~$X$ of~$M \ssm (\up[\pi_1] \cup \dots \cup \up[\pi_{i-1}] \cup \down[\pi_{i+1}] \cup \dots \cup \down[\pi_p])$,
    \end{itemize}
    \item \textbf{attach} the arcs~$\alpha^{i-1}_X$ (resp.~$\alpha^i_X$) with~$X \subseteq Y$ as incoming (resp.~outgoing)~arcs of the node~$n^i_Y$,
    \item \textbf{relabel} the arc~$\alpha^i_X$ with~$X \cap R$ and the node~$\alpha^i_Y$ with~$Y \cap \pi_i$,
    \item \textbf{contract} into a single arc any path of arcs passing through nodes with empty~labels.
  \end{itemize}
\end{definition}

\begin{proposition}
  \label{prop:surjection}
  For any ordered partition~$\pi \eqdef \pi_1 | \dots | \pi_p$, the directed graph~$\spine(\pi)$ constructed in \cref{def:surjection} is a blossoming spine on~$M$.
  Moreover, $\pi$ is an extension of~$\spine(\pi)$.
  \vincent{explain}
\end{proposition}

\begin{remark}
  The construction of \cref{def:surjection} can also be seen as a sweeping algorithm.
  \vincent{todo}
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Geometry: block graph permutreehedra}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Algebra: operad structure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix

\section{More combinatorics}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Nestings, tubings and Forcey-Ronco substitution on graph-associahedra}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Generalized tubings}

\vincent{I am not sure that this section will stay in the final version.}

Let~$M$ be a maple tree and~$G = (V,E)$ be the block graph obtained by tapping~$M$.
There are four combinatorial models for the facets of a block graph permutreehedron:
\begin{enumerate}
  \item a \defn{rank~$1$ spine} on~$G$, \ie a spine on~$G$ with precisely two nodes,
  \item a \defn{maple subtree} of~$M$, \ie a maple tree induced by a connected subset of~$M$, or equivalently a connected component of $M \ssm B$ for a subset~$B$ of blue vertices of~$M$,
  \item a \defn{signed tube} of~$G$, \ie a pair~$(\down[W], \up[W])$ of maple subtrees of~$M$ such that $\partial \down[W] \subseteq \down[V] \cap \up[W]$ and $\partial \up[W] \subseteq \up[V] \cap \down[W]$,
  \item a \defn{signed biconvex subset} of~$G$, \ie a subset~$V$ of vertices of~$G$ which is positive convex and whose complement is negative convex. This is also what we called splittable partition.
\end{enumerate}
We can read the spine complex on these 4 models.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Geometric properties of block graph permutreehedra}







\section*{Acknowledgments}

CRM in Barcelona 

\bibliographystyle{alpha}
\bibliography{blockgraph}
\label{sec:biblio}

\end{document}